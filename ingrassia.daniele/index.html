<!doctype html>
<html>
<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="shortcut icon" href="img/favicon.ico"> 
	<link rel="stylesheet" href="css/vendor/fluidbox.min.css">
	<link rel="stylesheet" href="css/main.css">

	<script type="text/javascript" src="js/jsc3d_ie.min.js"></script>
	<script type="text/javascript" src="js/jsc3d.min.js"></script>
    <script type="text/javascript" src="js/jsc3d.webgl.js"></script>

	<title>FabAcademy 2015</title>

</head>
<body>

	<header>
	</header>

	<div id="content">

		<section class="intro">

			<a id="profile_photo" href="javascript:ReplaceContentInContainer('middle',document.getElementById('about').innerHTML,'about')" ><img class="images-default" src="img/daniele_ingrassia.jpeg" alt="Daniele Ingrassia"></a>
			<h2 class="col-2">Hello, I'm <span class="nl"> <a href="javascript:ReplaceContentInContainer('middle',document.getElementById('about').innerHTML,'about')"><span class="redones">Daniele Ingrassia</span></a></span></h2>
			<p></p><p> Welcome to my repository!<br>
			Here you can find my works @<a href="http://www.fabacademy.org/"><span sytle="font-weight:bold;" class="redones">FabAcademy 2015</span></a>.
			</p>
		
		</section>

		<section class="row">
			<div id="links" class="col-full">
				<h2>  
					<a id="fp" href="javascript:ReplaceContentInContainer('middle',document.getElementById('final_project').innerHTML,'final_project')">Final Project</a>
					<a id="ex" href="javascript:ReplaceContentInContainer('middle',document.getElementById('exercises').innerHTML,'exercises');">Assignments</a>
					<a id="ab" href="javascript:ReplaceContentInContainer('middle',document.getElementById('about').innerHTML,'about')">About</a>
					<a id="co" href="javascript:ReplaceContentInContainer('middle',document.getElementById('contact').innerHTML,'contact')">Contact</a>
				</h2>
			</div>
		</section>

		<section id= "about" class="row">
			<div class="photo-grid">				
				<p>
				I won’t hide behind the work that I am doing or the studies that I have done in the past.<span class="redones"> I’m a dreamer.</span> In my personal way of thinking this means that I always try to reach very difficult and often untrusted objectives that put me in a <span class="redones">constant challenge</span> with myself and that quickly change my cognition of what I am capable of.
				</p>
				<img class="images" src="img/moto.jpg">
				<img class="images" src="img/car.jpeg">
				<ul class="lists">
				<li>So, here are some of the things I had fun to do with:</li>
				<li><span class="redones">disassembling a car</span> in order to make a dune buggy </li>
				<li><span class="redones">building a motorcycle</span> with pieces taken from junkyard</li>
				<li>inventing a new kind of hybrid <span class="redones">recommendation and profiling system</span> used in the official mobile app of <a href="http://www.universiadetrentino.org/"><span class="redones-link">WU2013</span></a></li>
				<li>inventing an automatic <span class="redones">topic recognition system</span> that is capable to analyze free text</li>
				<li>making an <a href="https://www.youtube.com/watch?v=I93_ldjfg0w"><span class="redones-link">Android controlled car</span></a> with a toy car, a netbook motherboard and Arduino</li>
				</ul>
				<img class="images" src="img/graph.jpg">
				<img class="images" src="img/Practionist_Agent.jpg"></a>
			

				<ul class="lists">
				<li>Having said this, here are some details on "<span class="redones">normal</span>" things:</li>
				<li>I’m a qualified technician in electrotechnics</li>
				<li>I’m an Information Technology engineer</li>
				<li>I work since the end of 2012 as a junior researcher at <a href="https://is3.eng.it/is-home/"><span class="redones-link">IS3 Lab</span></a> of <a href="http://www.eng.it/"><span class="redones-link">Engineering Ingegneria Informatica</span></a></li>
				<li>I’m specialized in <span class="redones">A.I.</span>, specifically in <a href="http://practionist.eng.it/"><span class="redones-link">PRACTical reasONIng sySTems</span></a> and recommender systems</li>
				</ul>
				<ul></ul>
			</div>
		</section>

		<section id= "final_project" class="row">
			<div class="photo-grid">
				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project1').innerHTML,'project1')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">1 Concept</span></a>
				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project2').innerHTML,'project2')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">2 Electronics: flight controller experimentations</span></a>

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project3').innerHTML,'project3')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">3 Applications and Implications</span></a>

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project4').innerHTML,'project4')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">4.1 CAD design & 3D print: quadcopter foots</span></a>

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project5').innerHTML,'project5')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">4.2 Electronics: flight controller</span></a>
 	
				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project6').innerHTML,'project6')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">4.3 AAVOID v1: teamwork</span></a>

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project7').innerHTML,'project7')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">4.4 Returning Solo: cooperation considerations</span></a>

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project8').innerHTML,'project8')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">5.1 CAD design, 3D print & laser cutting: new frame, foots & supports</span></a>

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project9').innerHTML,'project9')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">5.2 Electronics: dual satshakit board</span></a>

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project10').innerHTML,'project10')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">5.3 AAVOID v2: assembly & tests</span></a>

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project11').innerHTML,'project11')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">6.1 Electronics: dual sathakit board improvements</span></a>

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project12').innerHTML,'project12')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">6.2 CAD design & laser cutting: sonar supports</span></a>

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project13').innerHTML,'project13')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">6.3 Input devices: sonars tests</span></a>

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project14').innerHTML,'project14')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">6.4 Embedded programming: AutoPilot development & tests</span></a>

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project15').innerHTML,'project15')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">6.5: Application programming: a "Thing" of an IoT system?</span></a>	

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project0').innerHTML,'project0')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">7 AAVOID v3: final results</span></a>

			</div>
		</section>	

		<section id= "contact" class="row">
			<div class="photo-grid">
				<p>Gmail and Google+: <a href="https://plus.google.com/115164644362254413966/posts"><span class="redones-link">ingrassiada@gmail.com</span></a><br>
				Linkedin: <a href="http://it.linkedin.com/in/danieleingrassia"><span class="redones-link">Daniele Ingrassia</span></a>
				</p>
			</div>
		</section>

		<section id= "week1" >
			<div class="weeks">
				<p>
				During this week I've learned about <span class="redones">principles and practices, project management</span>.
				<br>
				<br>
				Digital fabrication is not new to me as I've already watched some videos about it and the Neil's speeches, but I'm really excited about the course that is starting. Digital fabrication, as a lot of other things that we then discover, is inspired by nature. But, what here is making the difference, is the fact that we are talking about one of the best feature that nature has built-in: <span class="redones">self-reproduction</span>. I was thinking about computer's CPU and memory as organizers of electrons via small quantified amounts of electricity, and due to this I was imagining a program as an ordered bunch of electrons groups. When I learned about digital fabrication this point of view became obsolete as we are now at the next step:  <span class="redones">a piece of code does not just describe a thing, it's a thing itself. </span>
				</p><br>

				<p>If you want to know more about my final project, you can read more here: <a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project1').innerHTML,'project1')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">AAVOID concept</span></a>.</p>

				<p>Do you like this  <span class="redones">site</span>?</p>
				<br>
				<p>
				Even if I'm a IT engineer, I'm not familiar with <span class="redones">web development</span> because I often work with backend's services and components. So I like the fact I had the opportunity to study a bit of this kind of things. I prefer big fonts to help readability, and I don't like pages full of text or little details, I just want to put only the things that are strictly needed and nothing else. The same strategy I will use for additional web components. Also, if you don't want to read all the text, you can just <span class="redones">follow the red words</span> to understand the main keywords and topics of the page you are looking at.
				To edit <span class="redones">HTML</span> and <span class="redones">CSS</span> Massimo suggested us to use <span class="redones">Brackets</span>. I tried Brackets a bit, but I quickly discovered that I wasn't familiar with the text colors of the Brackets' themes. Also I missed the document text preview on the right side. So I ended up with <span class="redones">Sublime</span>, a lightweight HTML editor that we use sometimes at work.</p>
				<p>Here is a comparison of the two editors:</p><br>
				<img class="images-default" src="img/editors.jpeg" style="size=80%" alt="editors">
				<p><br>To effectively test in locale my web pages I used the web server <span class="redones">nginx</span>. 
				Via APT I easily installed nginx:</p>
				<p><pre class="prettyprint lang-bash">sudo apt-get install nginx</pre></p>
				<p>Then I changed its document root with the path of my directory inside my local git FabAcademy repository. To do this I edited the nginx configuration file of the default site:</p>
				<p><pre class="prettyprint lang-bash">sudo nano /etc/nginx/sites-enabled/deafult</pre></p>
				<p> and replaced the line:</p>
				<p><pre class="prettyprint lang-bash">root /usr/share/nginx/html;</pre></p>
				<p>with:</p>
				<p><pre class="prettyprint lang-bash">root /home/satsha/git/FabAcademy2015-Opendot/ingrassia.daniele;</pre></p>
				<p>In the nginx configuration file this line is inside the server block, so this path is considered the starting point of all the locations (url paths) of this server block. In this case only the default location "/" was present. I also changed the <span class="redones">port</span> of the default server block from 8080 to 8081, because I may already have other services on the 8080:</p>
				<p><pre class="prettyprint lang-bash">listen 8081 default_server;</pre></p>
				<p>Then, file saved and back on bash, I started nginx with:</p>
				<p><pre class="prettyprint lang-bash">sudo service nginx start</pre></p>
				<p>And at</p>
				<p><pre class="prettyprint lang-bash">http://127.0.0.1:8081</pre></p>
				<p>browser successfully showed me my test index.html:</p>
				<img class="images-default" src="img/test_index.jpeg" alt="editors">
				<p>At this point I was ready to start with HTML and CSS development. First I headed to <a href="http://www.w3schools.com/"><span class="redones-link">W3Schools</span></a> to revise the <span class="redones">structure</span> of a web page and some of the HTML tags that Massimo teached us about:</p>


				<p><pre class="prettyprint lang-html">&lthtml&gt &lt!-- define an HTML document --&gt<br> &lthead&gt &lt!-- document's meta data --&gt<br>  &lttitle&gtTitle of the document&lt/title&gt<br> &lt/head&gt<br> &ltbody&gt &lt!-- document's content --&gt<br>  &ltsection&gt &lt!-- section --&gt<br>   &ltdiv&gt &lt!-- division --&gt<br>    &ltp&gtsome text&lt/p&gt &lt!-- paragraph --&gt<br>    &lta href="http://www.fabacademy.org"&gt&lt/a&gt &lt!--hyperlink--&gt<br>    &ltimg src="image.jpg"&gt&lt/img&gt &lt!--image--&gt<br>    &ltul&gtList title &lt!-- unordered list --&gt<br>     &ltli&gtlist item&lt/li&gt &lt!--list item--&gt<br>   &lt/ul&gt<br>   &lt/div&gt<br>  &lt/section&gt<br> &lt/body&gt<br>&lt/html&gt</pre></p>


				<p>Then I analyzed how to <span class="redones">reference</span> a specific HTML tag:</p>
				<p><pre class="prettyprint lang-html">&ltp id="id1" class="class1"&gtsome text&lt/p&gt &lt!-- paragraph --&gt</pre></p>				
				<p>The difference between <span class="redones">id</span> and <span class="redones">class</span> is that id identifies only one object, while a class identifies a group of objects. Here it is how to reference these identifiers inside <span class="redones">CSS</span>:</p>
				<p><pre class="prettyprint lang-html">body{} /* apply style inside body tag */<br>.class1 {} /* apply style on all the object that belong t class1 */<br>#id1 {} /* apply style on all the object with id id1 */</pre></p>

				<br>
				<p>What about <span class="redones">git</span>?</p><br>
				<p>We often use git at work, so I'm not new of this kind of <span class="redones">distributed version control</span>. However I was happy (when I was able of!) to help my fellow students whenever they needed. To sync with our intermediate <span class="redones">repository</span> and <span class="redones">push</span> my modifications I followed these steps.
				</p>
				<p>First I cloned the repository locally:</p>
				<p><pre class="prettyprint lang-bash">git clone https://github.com/opendot/FabAcademy2015-Opendot.git</pre></p>
				<p>Then I added my site inside my own folder, and added it and its files to <span class="redones">virtual index</span>:</p>
				<p><pre class="prettyprint lang-bash">git add -A .</pre></p>
				<p>With the modifications inside virtual index, I can now <span class="redones">commit</span> to my local repository:</p>
				<p><pre class="prettyprint lang-bash">git commit -m "first commit of daniele ingrassia's website"</pre></p>
				<p>Just before pushing I <span class="redones">pull</span>ed, so I'm sure that if anybody in the meanwhile made any push I get his modifications:</p><p><pre class="prettyprint lang-bash">git pull origin master</pre></p>
				<p>So I pushed my modifications on the remote repository:</p>
				<pre class="prettyprint lang-bash">git push origin master</pre></p>

			</div>
		</section>

		<section id= "week2" class="row">
			<div class="photo-grid">
				<p>This week I've learned about <span class="redones">computer-aided design</span>.</p>
				<br>
				<br>
				<p>Apart from a few and simple experiments with Blender, I've never used <span class="redones">CAD</span> or <span class="redones">rendering</span> software. At the beginning of the week, Massimo told us that we would have talked only about a subset of the long list of the software presented in MIT lecture. So, I've first started with installing such software, and, since I'm on Linux, I could not install all of them directly, but I had to use my Windows virtual machine. Here is a table with the main features of the software Massimo introduced us:</p>
				 
				 <table border="1" style="width:100%; text-align:center;">
  					
  					<tr>
    				<td>Name</td>
    				<td>Dim.</td>
    				<td>Used for</td>
  					<td>OS</td>
  					<td>License</td>
  					<td>Notes</td>
  					</tr>

  					<tr>
    				<td><span class="redones">Gimp</span></td>
    				<td>2D</td>
    				<td>bitmap images</td>
  					<td>multi</td>
  					<td>LGPL/GPL</td>
  					<td>Photoshop free clone</td>
  					</tr>

  					<td><span class="redones">Inkscape</span></td>
    				<td>2D</td>
    				<td>vector graphics</td>
  					<td>multi</td>
  					<td>GPL</td>
  					<td>Vetcors' control points</span></td>
  					</tr>

  					<td><span class="redones">QCad</span></td>
    				<td>2D</td>
    				<td>CAD</td>
  					<td>multi</td>
  					<td>GPL</td>
  					<td>Very easy</td>
  					</tr>

  					<td><span class="redones">DraftSight</span></td>
    				<td>2D</td>
    				<td>CAD</td>
  					<td>mac/linux</td>
  					<td>freeware</td>
  					<td>Autocad clone</td>
  					</tr>

  					 <td><span class="redones">FreeCad</span></td>
    				<td>2D/3D</td>
    				<td>CAD</td>
  					<td>multi</td>
  					<td>LGPL</td>
  					<td>It's a beta</td>
  					</tr>

  					<td><span class="redones">Blender</span></td>
    				<td>3D</td>
    				<td>3D modeling</td>
  					<td>multi</td>
  					<td>GPL</td>
  					<td>Good for meshes</td>
  					</tr>

  					<td><span class="redones">Rhino</span></td>
    				<td>3D</td>
    				<td>3D modeling/CAD</td>
  					<td>win/mac</td>
  					<td>proprietary</td>
  					<td>Good for NURBS</td>
  					</tr>
				</table> 
				 <p><br><span class="redones">Inkscape</span> was one of the first software that I tried out. It was very easy to learn and in short time I was able to easily manage how to use the vectors' control points:</p>
  				 <img class="images-default" src="img/inkscape.jpeg">
  				 <p>After some use of Inkscape I thought that it wasn't the right choice for designing something precise, like the drone I want to build or a part of it. If I need to 3D print parts, or to measure distance between points, the best is to use a 2D/3D CAD software. Accordingly to this I  decided to try <span class="redones">FreeCad</span>. FreedCad was very good, and also relatively easy to me. The problem was that FreeCad is a beta, and I experienced some errors and chrashes in the middle of the work that made me consider this software not a reliable choice. I also briefly tried <span class="redones">QCad</span>, but after FreedCad it seemed to be too simple for the scope I had. The lastest software in the Massimo's list that is specialized in 2D CAD is <span class="redones">DraftSight</span>. Since it's a clone of the famous Autocad, and therefore inherits its commands, I felt comfortable with DraftSight both at the beginning and then when I tried to use more advanced commands. I decided to use DraftSight for <span class="redones">2D technical drawing</span>.</p>
				
  				 <p>Here is the design of the drone's <span class="redones">frame</span> and its dimensions, made with DraftSight(<a href="drawings/frame2D.dwg"><span class="redones-link" >download</span></a>):<br></p>
  				 <img class="images-default" src="img/frame2D_web.gif">
  				 <p><br>Furthermore, because of the special <span class="redones">assembly</span>  feature the drones have, I also tried to design the <span class="redones">cubic frame</span>(<a href="drawings/cubic_frame2D.dwg"><span class="redones-link" >download</span></a>):<br><br></p>
				 <img class="images-default" src="img/cage2D_web.gif">
				 <p><br>When I saw these drawings clompleted, I could not wait to see them <span class="redones">rendered in 3D</span>! As a strategy I was thinking about exporting the 2D technical drawings I made to svg format, and then doing an import in  <span class="redones">Blender</span>. At the first usages of Blender I was advantaged by the little experiences of the past. But then it was a nightmare: I get lost in countless commands that Blender has and also I encountered some bugs of the boolean modifier. So, as a last chance for 3D I tried <span class="redones">Rhino</span> three months trial in the Windows virtual machine. Despite a non easy start, and after some difficulties, I really appreciated Rhino. So taken further by the desire to render the 2D technical drawings I managed to correctly import the svg files, extruded the surfaces, and reached the goal to decently render them, with the compliance of the dimensions!</p>
				 <p>So, here you can see the surfaces just before <span class="redones">extrusion</span>:<br><br></p>
				 <img class="images-default" src="img/planar_surfaces.png">
				 <p>Here is the final 3D rendering of the frame(<a href="drawings/frame3D.rar"><span class="redones-link">download</span></a>):<br><br></p>
				 <img stile="size:70%" src="img/frame3D_web.jpg">
				 <p><br>And here is the 3D rendering of the cubic frame(<a href="drawings/cubic_frame3D.rar"><span class="redones-link">download</span></a>):<br><br></p>
				 <img class="images-default" src="img/cage3D_web.jpg">
				 <p><br> Finally you can <span class="redones">play</span> with last one:</p>
			</div>
		</section>

		<section id= "week3" class="row">
			<div class="photo-grid">
				<p>In this week we've talked about <span class="redones">computer-controlled cutting</span>.</p>
				<ul class="lists">
				<li>There are different <span class="redones">cutting techniques</span>, of which the main ones are:</li>
				<li><span class="redones">Vinyl cutting</span>, cheap and simple cutting technology, can cut soft materials like paper and vinyl</li>
				<li><span class="redones">Laser cutting</span>, one of the most spread technologies, can cut materials like wood, PMMA and engrave metals</li>
				<li><span class="redones">Water jet cutting</span>, expensive technology that can cut hard materials like marbles and metals</li>
				</ul>

				<p>Some <span class="redones">principal facts</span> that are needed to know about cutting techniques are relative on how they work. One of these regards the cut: because it has a non zero width, it will destroy thin strips of material around itself. So if we need to cut something in a very precise way, we have to estimate this value to obtain the exact dimensions we want. The width of a cut is called <span class="redones">kerf</span>. Another one is that, even if we get a two dimensional cut, we can combine several cuts to assembly 3D objects and shapes. This can be done, for example, with <span class="redones">joints</span> in order to make a box, or cutting several <span class="redones">layers</span> of different dimensions and stacking them up. An important thing to know about laser is that the shape of a laser cut is not perfectly straight but tends to be a <span class="redones">cone</span>. This effect is more evident by cutting thicker materials.</p> 

				<p>After Wednesday's lecture and Thursday's theory lesson we had the opportunity to see our <span class="redones">laser cutter</span> (a GCC Laser Pro) in action. As first experiment we made some simple cuts on a 3mm scrap piece of plywood. There were alot of details to memorize on how to use this (or in general a) laser cutter, so I decided to write here a brief <span class="redones">step by step guide</span>:</p>				
				<p><span class="redones">1.</span> remove any material already present on the cutting grid
				<br><span class="redones">2.</span> remove any leavings remained in the cutting grid, or below it
				<br><span class="redones">3.</span> place new material on the cutting grid
				<br><span class="redones">4.</span> check if the material is bent (for example wood) and attempt to lock it in order to minimize bending
				<br><span class="redones">5.</span> turn on the laser cutter
				<br><span class="redones">6.</span> calibrate Z axis (height of laser lens) if the previous cut was made with different material
				<br><span class="redones">7.</span> manually place the lens in a desired point, if you want to use a custom starting point
				<br><span class="redones">8.</span> close the protective lid
				<br><span class="redones">9.</span> turn on the filtering system for the material you want to work with
				<br><span class="redones">10.</span> go to PC and open the file you want to print
				<br><span class="redones">11.</span> if necessary assign different layers to different parts of the drawing
				<br><span class="redones">12.</span> put settings for each layer (mainly power, speed values and check vector, raster and air) if needed
				<br><span class="redones">13.</span> put other settings like print area and home position
				<br><span class="redones">14.</span> optionally do a test on a small square of material to check if settings are ok
				<br><span class="redones">15.</span> hit print button
				<br><span class="redones">16.</span> go to the machine's display and select the file to print
				<br><span class="redones">17.</span> start cutting by pressing start button
				<br><span class="redones">18.</span> turn off the laser cutter and filtering system at the end of the cut </p>

				<p>After this first experiment, together with Simone Boasso and Mattia Ciurnelli, we tried to <span class="redones">measure the kerf</span> of our laser cutter. To do this we cutted another 3mm scrap piece of plywood as follows:</p>
				<img class="images-default" src="img/week3/kerf_test.jpg">
				<p>Then we obtained the kerf with the formula shown in the following picture:</p>
				<img class="images-default" src="img/week3/kerf.jpg">
				<p>Settings of the driver were: power 100% and speed 10%. The resulting kerf is <span class="redones">0.12mm</span>. Kerf depends on speed and power of the laser beam and by thickness and type of material. In fact, these values are only a starting point useful to estimate future kerfs for the same or similar conditions.</p>
				<p>Another interesting test made by me and Simone Boasso, was about trying to find the best combination of sizes in order to obtain <span class="redones">wood joints</span>, that will firmly block each other when fitted together. To do this test we made the following drawing(<a href="drawings/week3/joints_test.rar"><span class="redones-link">download</span></a>):</p> 

				<img class="images-default" src="img/week3/joints_file.jpg">

				<p>Where the numbers identify the exact <span class="redones">size of the holes or of the fillings</span>, accordingly with the piece on which they are printed on. We decided to use the kerf measured before, as the single step to increase or decrease the sizes. The first attempt to cut this drawing onto a 6mm plywood has <span class="redones">failed to cut</span> all with settings of power 100% and speed 5%:</p>
				<img class="images-default" src="img/week3/first_joints_cut.jpg">
				<img class="images-default" src="img/week3/second_joints_cut.jpg">

				<p>The second try was successful as we lowered speed to 3.4%. Here is the video of our successful cut:</p>

				<iframe  src="//player.vimeo.com/video/119747304" width="700" height="450" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe> <p>

				<p><br>You can also notice, as you already seen in the drawing, that with that cut we also tried to <span class="redones">engrave some raster and vector</span> numbers, for these we used the settings of power 100% and speed 80%. Furthermore, to improve precision, we made these engravings before the cuts, to be sure that wood was not moved before. The last part of the test was about to try every <span class="redones">permutation of joints</span> with the pieces we've made:</p>
				<iframe  src="//player.vimeo.com/video/119747305" width="700" height="450" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe> <p>
				
				<p><br>We also tried to test the wood joints with one of the pieces flipped. This because we want to test how much the cuts made by the laser tend to be a cone. Finally the best permutation for a wood joint was the <span class="redones">filling of 10.12mm with the hole of 9.64mm</span>.</p>

				<p>For my personal experimentations with laser cutting I was thinking about to make an <span class="redones">adjustable notebook stand</span>. I wanted to make this because my notebook often warms up very quickly, forcing me to put something below it to help cooling. The main idea is to realize a rectangular top, perforated for the most to help notebook breathing and supported by two lateral pieces, specially shaped to hold the rectangular top and allow some inclination.</p>

				<ul class="lists">
				<li>Starting from this idea, I made the following <span class="redones">considerations</span>:</li>
				<li>rectangular top must be capable to <span class="redones">support different sizes</span>, so I measured different notebooks from 10" to 17"</li>
				<li>to avoid any future warping I preferred to use 8mm plywood</li>
				<li>lateral pieces must allow breathing to the air intakes on all sides, as well allow to use all sides' connections</li>
				<li>this notebook stand can be used also as <span class="redones">reading desk</span>, so I can use an higher inclination for the last regulation</li>
				<li>plywood offers good sliding friction to the notebook</li>
				<li>I don't take kerf in consideration because of with 8mm plywood and fillings of centimeters the joints will be solid</li>
				<li>one of the joints must be capable of <span class="redones">rotation</span>, so I need to cut a little cylinder around it to help rotation</li>
				<li>as a reinforcement I need to put another piece below the rectangular top, this piece must not bother spaces</li>
				<li>I want the possibility to pass the cables through the rectangular top</li>
				<li>the rectangular top is most stressed longitudinally, so I designed it more resistant on that (irregular circumference)</li>
				<li>to avoid falling of smaller notebook I can fill the central part of rectangular top with two X shaped wood strips</li>
				<li>to reinforce all I can cut some little wood indentations and put there some <span class="redones">o-rings</span></li>
				<li>I want to change inclination of the rectangular top without disassembling all</li>
				<li>the space below the rectangular top can be used to place a power supply, an external hard disk etc.</li>
				</ul>

				<p>Here is the original <span class="redones">drawing</span> of the notebook stand(<a href="drawings/week3/notebook_stand_quote.rar"><span class="redones-link">download</span></a>):</p>
				<img class="images-default" src="img/week3/notebook_stand_quote.gif">
				<p>And here is the drawing just before print to <span class="redones">optimize spaces</span> and the quantity of wood used:</p>
				<img class="images-default" src="img/week3/notebook_stand.gif">
				<p>The settings for my cut were: power 100% and speed 1.4%. This is our laser cutter while <span class="redones">cutting</span> the notebook stand:</p>
				<img class="images-default" src="img/week3/during.jpg">
				<p>And finally here are the <span class="redones">results</span>, all the pieces that constitute the notebook stand:</p>
				<img class="images-default" src="img/week3/disassembled.jpg">
				
				<p>The notebook stand is <span class="redones">solid</span>, easy to assemble/disassemble, it doesn't require complete disassemble to <span class="redones">change inclination</span> and can be safely used also without o-rings. The following pictures show the item assembled, used in different <span class="redones">configurations with and without o-rings</span>.</p>

				<img class="images-default" src="img/week3/front_empty.jpg">
				<img class="images-default" src="img/week3/side_all.jpg">
				<img class="images-default" src="img/week3/side_front.jpg">
				<img class="images-default" src="img/week3/side_back.jpg">
				<img class="images-default" src="img/week3/side.jpg">
				<img class="images-default" src="img/week3/front.jpg">
				<img class="images-default" src="img/week3/back.jpg">
				
				<p>Here is a video about <span class="redones">inclination change</span> without disassembling:</p>
				<iframe  src="//player.vimeo.com/video/120469898" width="700" height="450" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe> <p>

				<p><br>Another kind of computer controlled cutting we have to experiment with was <span class="redones">vinyl cutter</span>. So, in order to test out this technique, I used <span class="redones">Inkscape</span> to drawn the following <span class="redones">svg</span>:</p>
				<img class="images-default" src="drawings/week3/satshakit_inside.svg">
				<p>An then I used <span class="redones">Cut Studio</span> to prepare the file for cutting. In particular, this softare will take only few file formats, in which there isn't svg, so I had to transform my svg in jpg via <span class="redones">Gimp</span>. Once imported my drawings into Cut Studio, I needed to extract its contours:</p>
				<img class="images-default" src="img/week3/cut_studio.png">

				<p>Before print, I put the vinyl roll into the machine, a <span class="redones">Roland GX-240</span>. At this point I was ready to print:</p>
				<img class="images-default" src="img/week3/roland.jpg">
				<p>This is the vinyl roll with drawings cut on it:</p>
				<img class="images-default" src="img/week3/just_printed.jpg">
				<p>After checking if the print was ok, I started to manually detach it from the roll, and attach it on the back of my notebook:</p>

				<img class="images-default" src="img/week3/start_detaching.jpg">
				<img class="images-default" src="img/week3/start_attaching.jpg">
				<p>To be able to mantain letter spacing and alignment, I used a piece of <span class="redones">scotch tape</span>:</p>
				<img class="images-default" src="img/week3/scotch_detach.jpg">
				<img class="images-default" src="img/week3/scotch_attach.jpg">
				<p>So here are final results of experimentations with vinyl cutter:</p>
				<img class="images-default" src="img/week3/vinyl_final1.jpg">
				<img class="images-default" src="img/week3/vinyl_final2.jpg">

				<p>Here you can download the svg I used for vinyl cutter: <a href="drawings/week3/satshakit_inside.svg"><span class="redones-link">satshakit_inside</span></a>.</p>

			</div>
		</section>

		<section id= "week4" class="row">
			<div class="photo-grid">
				<p>During this week we've talked about <span class="redones">electronics production</span>.</p>
				
				<p>To demonstrate what we've learned, we had to make a <span class="redones">FabISP</span>. A FabISP is a simple <span class="redones">In System Programmer</span> useful for us as an exrcise in soldering and as a starting point in reading a schematic but also to directly work with <span class="redones">smd</span> electronic components. We will use this FabISP to program the boards that we will make along the FabAcademy.</p>

				<p>The first step in order to make this FabISP, is to print the board. Thanks to some experimentations made by our fellow student Enrico Bassi, we can now use a <span class="redones">laser cutter machine</span> to engrave and cut, in a more precisely way, <span class="redones">FR-1</span> sheets. Our laser cutter features two different kind of laser beams, <span class="redones">CO2 and fiber</span>. We used fiber laser to engrave and completely remove copper from the FR-1 surface, and C02 laser to cut the board. The following pictures shows Z-axis calibration and the laser cutter ready to print FabISP board:</p> 

				<img class="images-default" src="img/week4/LaserZ.jpg">
				<img class="images-default" src="img/week4/LaserPRE.jpg">

				<p>And here is a video showing fiber laser while engraving FR-1 copper surface:</p>

				<iframe src="https://player.vimeo.com/video/122442831" width="700" height="450" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
				
				<p>However, fiber laser need to go through the engraved surface different times, to be sure that all the copper was removed. This happens also if we use almost all the laser power. In fact, whitin some results, is possible to observe some thin copper lines inside engraved part of the PCB. Here you can see a picture about this:</p>

				<img class="images-default" src="img/week4/lines.jpg">

				<p>Once a well-done board was ready, I started collecting and organizing components to be soldered:</p>
				<img class="images-default" src="img/week4/components.jpg">

				<p>After listening some soldering suggestions from Massimo and my fellow student Enrico Bassi, I started to solder the components on the FabISP board. The first board never made to work because <span class="redones">avrdude</span> wasn't able to recognize it. I think that this happened because it was my first smd soldering work. Here you can see the first board:</p>
				<img class="images-default" src="img/week4/FabISP.jpg">

				<p>I printed another board and started over again. For this second attempt, I also added a logo on the board. This time I was very careful with soldering: I tried to watch and test every single connection before going over. Here are some pictures of the process:</p>

				<img class="images-default" src="img/week4/ENGISP.jpg">
				<img class="images-default" src="img/week4/44POS.jpg">
				<img class="images-default" src="img/week4/44BLOCK.jpg">
				<img class="images-default" src="img/week4/44SSOL.jpg">
				<img class="images-default" src="img/week4/USBSOL.jpg">


				<p>This board was ok. Due to the lack of diodes I completed the board with diodes that respect original values (zener type of 3.3V), but aren't in smd form factor. Here is the result with non-smd diodes:</p>
				<img class="images-default" src="img/week4/ENGISP_FINAL.jpg">

				 <p>Finally some other components arrived, so I replaced non-smd diodes with smd ones. In  this process a little piece of copper path has been lost, so I was forced to manually make a bridge in order to get the ISP working. Here you see can see the final result and the console output of the <span class="redones">programming steps</span>:</p>
				
				<img class="images-default" src="img/week4/ISP_rew.jpg">

				<p><pre style="background-color: black;">
satsha@satsha-mint:~/tmp/fabISP_mac.0.8.2_firmware > make clean
rm -f main.hex main.lst main.obj main.cof main.list main.map main.eep.hex main.elf *.o usbdrv/*.o main.s usbdrv/oddebug.s usbdrv/usbdrv.s
satsha@satsha-mint:~/tmp/fabISP_mac.0.8.2_firmware > make hex
avr-gcc -Wall -Os -DF_CPU=20000000       -Iusbdrv -I. -DDEBUG_LEVEL=0 -mmcu=attiny44 -c usbdrv/usbdrv.c -o usbdrv/usbdrv.o
avr-gcc -Wall -Os -DF_CPU=20000000       -Iusbdrv -I. -DDEBUG_LEVEL=0 -mmcu=attiny44 -x assembler-with-cpp -c usbdrv/usbdrvasm.S -o usbdrv/usbdrvasm.o
avr-gcc -Wall -Os -DF_CPU=20000000       -Iusbdrv -I. -DDEBUG_LEVEL=0 -mmcu=attiny44 -c usbdrv/oddebug.c -o usbdrv/oddebug.o
avr-gcc -Wall -Os -DF_CPU=20000000       -Iusbdrv -I. -DDEBUG_LEVEL=0 -mmcu=attiny44 -c main.c -o main.o
main.c:88:13: warning: always_inline function might not be inlinable [-Wattributes]
 static void delay ( void )
             ^
avr-gcc -Wall -Os -DF_CPU=20000000       -Iusbdrv -I. -DDEBUG_LEVEL=0 -mmcu=attiny44 -o main.elf usbdrv/usbdrv.o usbdrv/usbdrvasm.o usbdrv/oddebug.o main.o
rm -f main.hex main.eep.hex
avr-objcopy -j .text -j .data -O ihex main.elf main.hex
avr-size main.hex
   text    data     bss     dec     hex filename
      0    2002       0    2002     7d2 main.hex
satsha@satsha-mint:~/tmp/fabISP_mac.0.8.2_firmware >  sudo make fuse

avrdude -c stk500v1 -P /dev/ttyACM0 -b19200 -p attiny44 -U hfuse:w:0xDF:m -U lfuse:w:0xFF:m


avrdude: AVR device initialized and ready to accept instructions


Reading | ################################################## | 100% 0.05s


avrdude: Device signature = 0x1e9207

avrdude: reading input file "0xDF"

avrdude: writing hfuse (1 bytes):


Writing | ################################################## | 100% 0.02s


avrdude: 1 bytes of hfuse written

avrdude: verifying hfuse memory against 0xDF:

avrdude: load data hfuse data from input file 0xDF:

avrdude: input file 0xDF contains 1 bytes

avrdude: reading on-chip hfuse data:


Reading | ################################################## | 100% 0.02s


avrdude: verifying ...

avrdude: 1 bytes of hfuse verified

avrdude: reading input file "0xFF"

avrdude: writing lfuse (1 bytes):


Writing | ################################################## | 100% 0.02s


avrdude: 1 bytes of lfuse written

avrdude: verifying lfuse memory against 0xFF:

avrdude: load data lfuse data from input file 0xFF:

avrdude: input file 0xFF contains 1 bytes

avrdude: reading on-chip lfuse data:


Reading | ################################################## | 100% 0.02s


avrdude: verifying ...

avrdude: 1 bytes of lfuse verified


avrdude: safemode: Fuses OK (E:FF, H:DF, L:FF)


avrdude done.  Thank you.


satsha@satsha-mint:~/tmp/fabISP_mac.0.8.2_firmware >  sudo make program

avrdude -c stk500v1 -P /dev/ttyACM0 -b19200 -p attiny44 -U flash:w:main.hex:i


avrdude: AVR device initialized and ready to accept instructions


Reading | ################################################## | 100% 0.05s


avrdude: Device signature = 0x1e9207

avrdude: NOTE: "flash" memory has been specified, an erase cycle will be performed

         To disable this feature, specify the -D option.

avrdude: erasing chip

avrdude: reading input file "main.hex"

avrdude: writing flash (1988 bytes):


Writing | ################################################## | 100% 3.40s


avrdude: 1988 bytes of flash written

avrdude: verifying flash memory against main.hex:

avrdude: load data flash data from input file main.hex:

avrdude: input file main.hex contains 1988 bytes

avrdude: reading on-chip flash data:


Reading | ################################################## | 100% 2.26s


avrdude: verifying ...

avrdude: 1988 bytes of flash verified


avrdude: safemode: Fuses OK (E:FF, H:DF, L:FF)


avrdude done.  Thank you.


avrdude -c stk500v1 -P /dev/ttyACM0 -b19200 -p attiny44 -U hfuse:w:0xDF:m -U lfuse:w:0xFF:m


avrdude: AVR device initialized and ready to accept instructions


Reading | ################################################## | 100% 0.05s


avrdude: Device signature = 0x1e9207

avrdude: reading input file "0xDF"

avrdude: writing hfuse (1 bytes):


Writing | ################################################## | 100% 0.02s


avrdude: 1 bytes of hfuse written

avrdude: verifying hfuse memory against 0xDF:

avrdude: load data hfuse data from input file 0xDF:

avrdude: input file 0xDF contains 1 bytes

avrdude: reading on-chip hfuse data:


Reading | ################################################## | 100% 0.02s


avrdude: verifying ...

avrdude: 1 bytes of hfuse verified

avrdude: reading input file "0xFF"

avrdude: writing lfuse (1 bytes):


Writing | ################################################## | 100% 0.02s


avrdude: 1 bytes of lfuse written

avrdude: verifying lfuse memory against 0xFF:

avrdude: load data lfuse data from input file 0xFF:

avrdude: input file 0xFF contains 1 bytes

avrdude: reading on-chip lfuse data:


Reading | ################################################## | 100% 0.02s


avrdude: verifying ...

avrdude: 1 bytes of lfuse verified


avrdude: safemode: Fuses OK (E:FF, H:DF, L:FF)


avrdude done.  Thank you.

satsha@satsha-mint:~/tmp/fabISP_mac.0.8.2_firmware > lsusb
Bus 002 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub
Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 001 Device 004: ID 04f2:b302 Chicony Electronics Co., Ltd 
Bus 001 Device 090: ID 045e:0745 Microsoft Corp. Nano Transceiver v1.0 for Bluetooth
Bus 001 Device 003: ID 8087:07da Intel Corp. 
Bus 001 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 004 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 003 Device 043: ID 1781:0c9f Multiple Vendors USBtiny
Bus 003 Device 017: ID 0ace:1215 ZyDAS ZD1211B 802.11g
Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
			</pre></p>
				
				<p><br>As you can see from console output, I used an <a href="http://arduino.cc/en/Tutorial/ArduinoISP"><span class="redones-link">Arduino as ISP</span></a> to program the <span class="redones">Attiny44</span>. In order to do this you have to use the following parameters for avrdude in Makefile:</p>
				<p><pre style="background-color: black;">AVRDUDE = avrdude -c stk500v1 -P /dev/ttyACM0 -b19200 -p $(DEVICE)</pre></p>

				<p>Here is a picture of Arduino as ISP connected and ready to program the FabISP:</p>
				<img class="images-default" src="img/week4/flashing.jpeg">

				<p>As we couldn't accomplish in time with this weekly assignment because of the lacking of <span class="redones">CNC mill</span>, Massimo used meanwhile time to teach us <span class="redones">Python</span>. Even if I'm a IT engineer, I didn't know anything about this language except the Monty Python's name. As an experiment and to practice a bit of Python, I made a simple Python framework called <span class="redones">Internet of Arduinos</span>. From readme on my <a href="https://github.com/satshas/InternetOfArduinos"><span class="redones-link">GitHub repo<span class="redones"></a>:</p>
				<p>"Internet of Arduinos (<span class="redones">IoA</span> for friends :) is an Internet of Things Python framework where Things are Arduinos, or other MCU controlled devices. It's in a very early development stage, for now it supports basically HTTP(S) REST to Serial communication."</p>
				<p>Maybe this framework will be useful to us in order to simplify the communication between internet connected devices and our MCUs. Here is a video with an <span class="redones">example of use:</p>
				<p><iframe src="//player.vimeo.com/video/120672822" width="700" height="450" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe> </p>
				<p>Other than this I made some experiment about assembling an <a href="http://arduino.cc/en/Main/Standalone"><span class="redones-link">Arduino UNO on a breadboard</span></a> and flashing it with an <a href="http://arduino.cc/en/Tutorial/ArduinoISP"><span class="redones-link" >Arduino as ISP</span></a>. As you can already see in the video about InternetOfArduinos, the experiments were successful. So here are some pictures about this:</p>
				<img class="images-default" src="img/week4/before.jpeg">
				<img class="images-default" src="img/week4/flashing1.jpeg">
				<img class="images-default" src="img/week4/after.jpeg">

			</div>
		</section>

		<section id= "week5" class="row">
			<div class="photo-grid">
				<p>This week we've learned about <span class="redones">3D scanning and printing</span>.</p>

				<p>As first try about printing a <span class="redones">non-subtractive</span> made piece, I thought about three <span class="redones">concentric spheres</span>. This because the spheres inside the external one cannot be placed after it's printed. Therefore it will be very difficult, if not impossible, to make this with a 2D production technique, like laser cutting. I designed the spheres with Rhino (<a href="drawings/week5/spheres.rar"><span class="redones-link">download</span></a>):</p>

				<img class="images-default" src="img/week5/spheres_drawing.jpg" alt=""></p>
				<img class="images-default" src="img/week5/spheres_drawing_touch.jpg" alt=""></p>
				

				<p>To allow inside spheres to be printed without any <span class="redones">support</span> below, I placed them on a plane. I measured the diameter to be sure that they cannot exit, but also checked that if placed on the plane, they don't touch each other. After drawing was ready, I exported it as <span class="redones">STL</span> to be able to use <span class="redones">Cura</span> in order to obtain <span class="redones">G-code</span>. Our 3D printer is a <a href="http://reprap.org/wiki/Prusa_i3"><span class="redones-link">Prusa Mendel i3</span></a>. Here is a picture and a video about the first part of the printing process:</p>
				
				<img class="images-default" src="img/week5/spheres_start.jpg" alt=""></p>
				<p><iframe src="//player.vimeo.com/video/121041241" width="700" height="450" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></p>

				<p>As you can see in the previous picture, there were some <span class="redones">problems</span> about the smallest sphere, located at the center. The irregularities shown are due to the fact that the <span class="redones">below surface</span> was not enough to firmly block the sphere with the <span class="redones"> brim</span>. In fact the video shows central sphere moving while extrusor passes on it. I discovered that lateral pillars of the spheres were too <span class="redones">weak</span>, as some of them <span class="redones">broke</span> at the end of printing and when I tried to take spheres with hands. So my first try was unsuccessful, the following picture demonstrates effects of the above problems:</p>

				<img class="images-default" src="img/week5/complete_spheres.jpg" alt=""></p>
				<img class="images-default" src="img/week5/little_spheres_down.jpg" alt=""></p>

				<p>As second attempt, I tried to print again the same piece. But this time, in order to try to resolve problems related to the first try, I increased the <span class="redones">scale</span> of the spheres. This time the print seemed successful:</p>
				<img class="images-default" src="img/week5/spheres_during.jpg" alt=""></p>
				<p>But, near the end of printing piece detached from the brim, so I was forced to stop the printer. As a result, the external sphere remained without roof:</p>
				<img class="images-default" src="img/week5/spheres_no_roof.jpg" alt=""></p>

				<p>Another side effect was about <span class="redones">heat</span>, that slowly modified the printed spheres until they become a little elliptic. In fact they results larger than spheres measured in the drawing. After these attempts, and suggestion from a colleague about the difficulties to make these kind of pieces with this printer, I decided to design something else. To experiment a bit more, I implemented an easy <span class="redones">recursive algorithm</span> that generates one of the simplest fractals: <span class="redones">Koch Snowflake</span>. The algorithm (<a href="other/fractal.py"><span class="redones-link" >download<span class="redones"></a>) was implemented as a <span class="redones">Python Rhinoscript</span> and it was used to draw fractals out of a set of lines. Here is a video that shows the algorithm in action:</p>

				<p><iframe src="//player.vimeo.com/video/121136314" width="700" height="450" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></p>

				<p>Here you can see the code I wrote for this script:</p>

				<pre class="prettyprint lang-c">
# -*- coding: utf-8 -*-

'''
Created on 01/mar/2015
@author: satsha
'''

import rhinoscriptsyntax as rhino

#minimum line length
lineLength = 0.05

def recursiveFractal(curve):
    
    #stop condition of recursion
    if (rhino.CurveLength(curve)) > lineLength:
    
        #divide curve in 4 parts
        segments = rhino.DivideCurve(curve, 4)
        
        #draw construction line and rotate it
        newLine = rhino.RotateObject(rhino.AddLine(segments[1], segments[3]), segments[2], 90)
        
        #find end point of new line
        endsegments = rhino.CurveEndPoint(newLine)
        
        #clean
        rhino.DeleteObject(newLine)
        rhino.DeleteObject(curve)
        
        bufferCurves = []
        
        #draw new lines
        bufferCurves.append(rhino.AddLine(segments[0], segments[1]))
        bufferCurves.append(rhino.AddLine(segments[1], endsegments))
        bufferCurves.append(rhino.AddLine(endsegments, segments[3]))
        bufferCurves.append(rhino.AddLine(segments[3], segments[4]))
        
        #recursion on each line
        recursiveFractal(bufferCurves[0])
        recursiveFractal(bufferCurves[1])
        recursiveFractal(bufferCurves[2])
        recursiveFractal(bufferCurves[3])
    
def main():
    
    #take curves as input
    curveIds = rhino.GetObjects('curves to transform', rhino.filter.curve)
    
    #for each curve
    for i in range(len(curveIds)):
        recursiveFractal(curveIds[i])
    
if __name__ == '__main__':
    main()
				</pre>

				<p>Combining this algorithm with a cylinder what comes out is a strange piece that I called: <span class="redones">fractal tube</span>(<a href="drawings/week5/fractal_tube.rar"><span class="redones-link" >download<span class="redones"></a>):</p>

				<img class="images-default" src="img/week5/fractal_pen_holder_render.jpg" alt=""></p>

				<p>This time the print was  <span class="redones">successful</span>, there are only some minor imperfections due to retraction. You can see the results in the following pictures:</p>
				
				<img class="images-default" src="img/week5/fractal_pen_holder_side.jpg" alt=""></p>
				<img class="images-default" src="img/week5/fractal_pen_holder_up.jpg" alt=""></p>
				<img class="images-default" src="img/week5/pen_holder_real.jpg" alt=""></p>

				<p>For 3D scanning, we had the opportunity to use Xbox 360's <span class="redones">Kinect</span>. Kinect sensors and camera, mixed with the proper software, can act as a low cost but low resolution <span class="redones">3D scanner</span>. Using <span class="redones">Skanect</span> as software for capturing and mixing Kinect's data, I had decent results. The picture on the left shows the raw model obtained from Skanet and imported in <span class="redones">Blender</span>. There were some minor imperfections (on the nose) and some flying objects (bottom left). I manually corrected these, as shown in the picture on the right. Here you can download the final model: <a href="drawings/week5/scan_hq.rar"><span class="redones-link" >scan<span class="redones"></a>.</p>

				<img class="images-default" src="img/week5/scan_raw.jpeg" alt=""></p>
				<img class="images-default" src="img/week5/scan_final.jpeg" alt=""></p>

				<p>Finally you can <span class="redones">play</span> with all the models that I designed this week:</p>

			</div>
		</section>
		<section id= "week6" class="row">
			<div class="photo-grid">
				<p>During this week we've learned about <span class="redones">electronics design</span>.</p>
				<p>The objective of this week is to redraw the <span class="redones">hello-echo board</span> adding to it a LED and a button. To do this we used a PCB design software called <span class="redones">Eagle</span>. With Eagle is possible to design PCBs from two different editor that represent respectively two point of view of the PCB: <span class="redones">schematic</span> and <span class="redones">board</span>. In schematic editor we are dealing with components types and connections between them. So here we specify the <span class="redones">electrical</span> part of the PCB, where important things are components' specifications and how they are connected. Before start working with board editor, is preferable to build the complete schematic of the PCB. This because in board editor we will work with physical specifications of the PCB, and every component added in the schematic editor will be added here as well. In board editor we take care of components' displacement and of <span class="redones">traces</span> that connects them.</p>

				<p>To getting started with Eagle I created a <span class="redones">new project</span> and I added to it a new schematic:</p>
				<img class="images-default" src="img/week6/new_project.png" alt=""></p>
				<img class="images-default" src="img/week6/new_schema.png" alt=""></p>
				
				<p>Then, to be able to use some specific components, I added some FabAcademy Eagle <span class="redones">libraries</span>. Is in fact possible to create and add new components in Eagle. The components are packaged and distributed via libraries.</p>
				<img style="width:90%" class="images-default" src="img/week6/adding_libraries.png" alt=""></p>
				<p>After adding libraries I was able to find and add to the schema <span class="redones">components</span> needed for the hello-echo board.</p>
				<ul class="lists">
				<li>The components needed are:</li>
				<li><span class="redones">6-pin programming header</span> to program the board</li>
				<li><span class="redones">Attiny44A</span> microcontroller</li>
    			<li><span class="redones">FTDI header</span> for power supply and computer connection</li>
    			<li><span class="redones">20 MHz Resonator</span> external crystal clock generator, Attiny44A can work also @20Mhz</li>
    			<li><span class="redones">Capacitor</span> for a better quality input current</li>
    			<li><span class="redones">10K Resistors</span></li>
    			<li><span class="redones">Led</span> for the excerise</li>
    			<li><span class="redones">Resistor</span> to reduce led applied voltage</li>
				</ul>
				<img style="width:90%" class="images-default" src="img/week6/adding_components1.png" alt=""></p>
				<img style="width:90%" class="images-default" src="img/week6/adding_components2.png" alt=""></p>
				<p>So, here are all the components in the schematic, just before connections was drawn:</p>
				<img style="width:90%" class="images-default" src="img/week6/all_components.png" alt=""></p>
				<p>To limit the voltage applied to the led, I had to <span class="redones">calculate resistor value</span>. In order to dimension it, I read current and voltage values form its <a href="http://academy.kaziunas.com/tutorials/Datasheets/LTST-C150CKT.pdf"><span class="redones-link" >datasheet</span></a>:</p> 
				<img class="images-default" class="images-default" src="img/week6/forward_current.png" alt=""></p>
				<img class="images-default" class="images-default" src="img/week6/forward_voltage.png" alt=""></p>
				<p>Here you can see about my exercise on calculating it: </p>
				<img class="images-default" src="img/week6/led_resistance.jpg" alt=""></p>
				<p>Finally here is the complete schematic, with all components connected and the value of the led's resistor assigned to <span class="redones">499 Ohm</span> to avoid be right on the limit value of 80 Ohm:</p>
				<img style="width:90%" class="images-default" src="img/week6/completed_schema.png" alt=""></p>

				<p>Going to the board editor, it first showed a confused group of components, connected by <span class="redones">yellow wires</span>. These wires let us know what connections there are between components, but they aren't the ones that we need to print the PCB. All of these lines have to be transformed in <span class="redones">traces</span>, in order to represent the real PCB to be printed. In this case we have to made a <span class="redones">single layer</span> PCB, so all the traces must be on the same surface. The first thing to do was to put all the components inside the printed area of the limited version of Eagle. As first attempt to order traces, I tried the <span class="redones">autoroute</span> function. This function try to automatically find the best path for each trace:</p>
				<img style="width:90%" class="images-default" src="img/week6/first_autoroute.png" alt=""></p>
				<p>As you can see in the following picture, the autoroute function is not perfect, in fact some of the traces were not made:</p>
				<img style="width:90%" class="images-default" src="img/week6/after_first_autoroute.png" alt=""></p>
				<p>So, with the tutorial board in mind, I tried to replicate it via <span class="redones">manual traces editing</span>. Even if I made some minor changes at the components' displacement, the result was much pretty the same:</p>
				<img style="width:90%" class="images-default" src="img/week6/hello_board_1.png" alt=""></p>
				<p>To be ready to print the circuit, I selected only the first layer and then exported it with <span class="redones">*.png</span> image format, with settings of monochrome and 500DPI of resolution:</p>
				<img style="width:90%" class="images-default" src="img/week6/hello_board_1_layer.png" alt=""></p>
				<img style="width:90%" class="images-default" src="img/week6/hello_board_1_export.png" alt=""></p>
				<p>After that I imported the png file in <span class="redones">Inkscape</span> in order to add some text, and a red square, useful to identify the layer that will cut the board. Here is the final result:</p>
				<img class="images-default" src="img/week6/first_board_traces.jpg" alt=""></p>
				<p>Because I was not satisfied on copy the tutorial's board, I tried to make another one. To do this I redesigned manually all the trace's paths. The following pictures show the final result of my hello-board <span class="redones">personal version</span>.</p>
				<img style="width:90%" class="images-default" src="img/week6/hello_board_2.png" alt=""></p>
				<img style="width:90%" class="images-default" src="img/week6/hello_board_2_layer.png" alt=""></p>

				<img class="images-default" src="img/week6/satshas_board_traces.jpg">

				<p>Here you can find the two Eagle projects I made this week: <a href="drawings/week6/hello_board_1.rar"><span class="redones-link">hello-board</span></a>, <a href="drawings/week6/hello_board_2.rar"><span class="redones-link">personal-hello-board</span></a>.</p>
				<p>And here are also the *.svg files: <a href="drawings/week6/hello_board_1_svg.rar"><span class="redones-link" >hello-board</span></a>, <a href="drawings/week6/hello_board_2_svg.rar"><span class="redones-link" >personal-hello-board</span></a>.</p>

				<p>To make the board we used the same process that was experimented during Electronics Production: engraving pcb with a laser cutter. This is the board just after the laser cutter has finished its work:</p>
				<img class="images-default" src="img/week6/HelloEcho.jpg" alt=""></p>
				<p>Here is a pitcure of the final board, with all components soldered and tested:</p>
				<img class="images-default" src="img/week6/HelloEchoFinal.jpg" alt=""></p>
				<p>I also made a <span class="redones">smoke test</span> by connecting the board to the usb port. Luckily it was ok:</p>
				<img class="images-default" src="img/week6/HelloEchoOK.jpg" alt=""></p>

			</div>
		</section>
		<section id= "week7" class="row">
			<div class="photo-grid">
				<p>This week we dealt with <span class="redones">embedded programming</span>.</p>

				<p>To start with embedded programming, we first need to know a bit more about the microcontroller we are using, the <span class="redones">Attiny44</span>. So, even if I've read it in the previous exercise, I futher investigate its <a href="http://www.atmel.com/Images/doc8006.pdf"><span class="redones-link">datasheet</span></a> in order to find some general information about its <span class="redones">pinout</span>. As we have the version with SOIC package, we need to choose the right pinout from datasheet:</p>
				<img class="images-default" src="img/week7/attiny44_pinout.png" alt=""></p>
				<p>Also, I read about the meaning of the <span class="redones">pins' codes</span>, to better understand what I can do with them:</p>
				<img class="images-default" src="img/week7/attiny44_pindesc.png" alt=""></p>
				<p>With this information, I clearly saw how it's possible to decide where to connect microcontroller pins. This is more evident taking back the schema of my hello board, where button and led are connected to two PAx pins. In order to use these pins in our programs, we have to identify them. Here we can read that they are <span class="redones">PA7 for the LED and PA3 for the button</span>:</p>
				<img class="images-default" src="img/week7/pins_sch.png" alt=""></p>
				<p>Also, in the board schematic, we can physically identify where they are:</p>
				<img class="images-default" src="img/week7/pins_brd.png" alt=""></p>

				<p>Before starting in programming something for my hello board, I wanted to check if it was working. To do this I tried to upload the  <a href="http://academy.cba.mit.edu/classes/embedded_programming/hello.ftdi.44.echo.c"><span class="redones-link" >hello.ftdi.44.echo.c</span></a> program, found in FabAcademy embedded programming page. To compile the code, we also need the program's Makefile  <a href="http://academy.cba.mit.edu/classes/embedded_programming/hello.ftdi.44.echo.c.make"><span class="redones-link" >hello.ftdi.44.echo.c.make</span></a>. In order for this file to be read from make program, I renamed it into Makefile. At this point my computer was ready to upload the code, so I finally connected the boards, <span class="redones">FabISP and hello board</span>, together and with USB ports:</p>
				<img class="images-default" src="img/week7/ISP_P.jpg" alt=""></p>


				
				<ul class="lists">
				<li>Once ready, I read inside the Makefile which commands corresponds with my setup. I <span class="redones">successfully uploaded the program</span> with the following commands:</li>
				<li><span class="redones">make</span></li>
				<li><span class="redones">sudo make program-usbtiny-fuses</span></li>
				<li><span class="redones">sudo make program-usbtiny</span></li>
				</ul>

				 <p>Here you can see the console output of these commands:</p>

				<p><pre style="background-color: black;">
satsha@satsha-mint:~/tmp/hello/work > make
avr-objcopy -O ihex hello.ftdi.44.echo.out hello.ftdi.44.echo.c.hex;\
        avr-size --mcu=attiny44 --format=avr hello.ftdi.44.echo.out
AVR Memory Usage
----------------
Device: attiny44

Program:     758 bytes (18.5% Full)
(.text + .data + .bootloader)

Data:         64 bytes (25.0% Full)
(.data + .bss + .noinit)


satsha@satsha-mint:~/tmp/hello/work > sudo make program-usbtiny-fuses
[sudo] password for satsha: 
avr-objcopy -O ihex hello.ftdi.44.echo.out hello.ftdi.44.echo.c.hex;\
        avr-size --mcu=attiny44 --format=avr hello.ftdi.44.echo.out
AVR Memory Usage
----------------
Device: attiny44

Program:     758 bytes (18.5% Full)
(.text + .data + .bootloader)

Data:         64 bytes (25.0% Full)
(.data + .bss + .noinit)


avrdude -p t44 -P usb -c usbtiny -U lfuse:w:0x5E:m

avrdude: AVR device initialized and ready to accept instructions

Reading | ################################################## | 100% 0.00s

avrdude: Device signature = 0x1e9207
avrdude: reading input file "0x5E"
avrdude: writing lfuse (1 bytes):

Writing | ################################################## | 100% 0.00s

avrdude: 1 bytes of lfuse written
avrdude: verifying lfuse memory against 0x5E:
avrdude: load data lfuse data from input file 0x5E:
avrdude: input file 0x5E contains 1 bytes
avrdude: reading on-chip lfuse data:

Reading | ################################################## | 100% 0.00s

avrdude: verifying ...
avrdude: 1 bytes of lfuse verified

avrdude: safemode: Fuses OK (H:FF, E:DF, L:5E)

avrdude done.  Thank you.

satsha@satsha-mint:~/tmp/hello/work > sudo make program-usbtiny
avr-objcopy -O ihex hello.ftdi.44.echo.out hello.ftdi.44.echo.c.hex;\
        avr-size --mcu=attiny44 --format=avr hello.ftdi.44.echo.out
AVR Memory Usage
----------------
Device: attiny44

Program:     758 bytes (18.5% Full)
(.text + .data + .bootloader)

Data:         64 bytes (25.0% Full)
(.data + .bss + .noinit)


avrdude -p t44 -P usb -c usbtiny -U flash:w:hello.ftdi.44.echo.c.hex

avrdude: AVR device initialized and ready to accept instructions

Reading | ################################################## | 100% 0.00s

avrdude: Device signature = 0x1e9207
avrdude: NOTE: "flash" memory has been specified, an erase cycle will be performed
         To disable this feature, specify the -D option.
avrdude: erasing chip
avrdude: reading input file "hello.ftdi.44.echo.c.hex"
avrdude: input file hello.ftdi.44.echo.c.hex auto detected as Intel Hex
avrdude: writing flash (758 bytes):

Writing | ################################################## | 100% 0.76s

avrdude: 758 bytes of flash written
avrdude: verifying flash memory against hello.ftdi.44.echo.c.hex:
avrdude: load data flash data from input file hello.ftdi.44.echo.c.hex:
avrdude: input file hello.ftdi.44.echo.c.hex auto detected as Intel Hex
avrdude: input file hello.ftdi.44.echo.c.hex contains 758 bytes
avrdude: reading on-chip flash data:

Reading | ################################################## | 100% 0.90s

avrdude: verifying ...
avrdude: 758 bytes of flash verified

avrdude: safemode: Fuses OK (H:FF, E:DF, L:5E)

avrdude done.  Thank you.


				</pre></p>
	
				<p><br>Due to my previous experimentations about using an <span class="redones">Arduino as ISP</span>, I also tried to upload the same code of above with an Arduino. To do this I connected my <span class="redones">hello board with an Arduino</span>:</p>
<img class="images-default" src="img/week7/ARDU_P.jpg" alt=""></p>	
				<p>To work with an Arduino, I added the following lines to the Makefile:</p>

				<p><pre style="background-color: black;">
program-arduino: $(PROJECT).hex
	avrdude -p t44 -b19200 -P /dev/ttyACM0 -c stk500v1 -U flash:w:$(PROJECT).c.hex

program-arduino-fuses: $(PROJECT).hex
	avrdude -p t44 -b19200 -P /dev/ttyACM0 -c stk500v1 -U lfuse:w:0x5E:m
</pre></p>

				<ul class="lists">
				<li>And then used the following commands:</li>
				<li><span class="redones">make</span></li>
				<li><span class="redones">sudo make program-arduino-fuses</span></li>
				<li><span class="redones">sudo make program-arduino</span></li>
				</ul>
				<p>Here you can see that, also with an Arduino as ISP, the upload of the program was successful:</p>


	<p><pre style="background-color: black;">
satsha@satsha-mint:~/tmp/hello/work > make
avr-objcopy -O ihex hello.ftdi.44.echo.out hello.ftdi.44.echo.c.hex;\
        avr-size --mcu=attiny44 --format=avr hello.ftdi.44.echo.out
AVR Memory Usage
----------------
Device: attiny44

Program:     758 bytes (18.5% Full)
(.text + .data + .bootloader)

Data:         64 bytes (25.0% Full)
(.data + .bss + .noinit)


satsha@satsha-mint:~/tmp/hello/work > sudo make program-arduino-fuses
avr-objcopy -O ihex hello.ftdi.44.echo.out hello.ftdi.44.echo.c.hex;\
        avr-size --mcu=attiny44 --format=avr hello.ftdi.44.echo.out
AVR Memory Usage
----------------
Device: attiny44

Program:     758 bytes (18.5% Full)
(.text + .data + .bootloader)

Data:         64 bytes (25.0% Full)
(.data + .bss + .noinit)


avrdude -p t44 -b19200 -P /dev/ttyACM0 -c stk500v1 -U lfuse:w:0x5E:m

avrdude: AVR device initialized and ready to accept instructions

Reading | ################################################## | 100% 0.05s

avrdude: Device signature = 0x1e9207
avrdude: reading input file "0x5E"
avrdude: writing lfuse (1 bytes):

Writing | ################################################## | 100% 0.02s

avrdude: 1 bytes of lfuse written
avrdude: verifying lfuse memory against 0x5E:
avrdude: load data lfuse data from input file 0x5E:
avrdude: input file 0x5E contains 1 bytes
avrdude: reading on-chip lfuse data:

Reading | ################################################## | 100% 0.02s

avrdude: verifying ...
avrdude: 1 bytes of lfuse verified

avrdude: safemode: Fuses OK (H:FF, E:DF, L:5E)

avrdude done.  Thank you.

satsha@satsha-mint:~/tmp/hello/work > sudo make program-arduino
avr-objcopy -O ihex hello.ftdi.44.echo.out hello.ftdi.44.echo.c.hex;\
        avr-size --mcu=attiny44 --format=avr hello.ftdi.44.echo.out
AVR Memory Usage
----------------
Device: attiny44

Program:     758 bytes (18.5% Full)
(.text + .data + .bootloader)

Data:         64 bytes (25.0% Full)
(.data + .bss + .noinit)


avrdude -p t44 -b19200 -P /dev/ttyACM0 -c stk500v1 -U flash:w:hello.ftdi.44.echo.c.hex

avrdude: AVR device initialized and ready to accept instructions

Reading | ################################################## | 100% 0.05s

avrdude: Device signature = 0x1e9207
avrdude: NOTE: "flash" memory has been specified, an erase cycle will be performed
         To disable this feature, specify the -D option.
avrdude: erasing chip
avrdude: reading input file "hello.ftdi.44.echo.c.hex"
avrdude: input file hello.ftdi.44.echo.c.hex auto detected as Intel Hex
avrdude: writing flash (758 bytes):

Writing | ################################################## | 100% 1.28s

avrdude: 758 bytes of flash written
avrdude: verifying flash memory against hello.ftdi.44.echo.c.hex:
avrdude: load data flash data from input file hello.ftdi.44.echo.c.hex:
avrdude: input file hello.ftdi.44.echo.c.hex auto detected as Intel Hex
avrdude: input file hello.ftdi.44.echo.c.hex contains 758 bytes
avrdude: reading on-chip flash data:

Reading | ################################################## | 100% 0.79s

avrdude: verifying ...
avrdude: 758 bytes of flash verified

avrdude: safemode: Fuses OK (H:FF, E:DF, L:5E)

avrdude done.  Thank you.


	</pre></p>

				<p><br>Also, I tried to upload and compile the assembly version of hello echo <a href="http://academy.cba.mit.edu/classes/embedded_programming/hello.ftdi.44.echo.asm"><span class="redones-link">hello.ftdi.44.echo.asm</span></a>. <br>Here you can see the console output:</p>
				

<p><pre style="background-color: black;">
satsha@satsha-mint:~/tmp/hello/work_asm > make 
gavrasm hello.ftdi.44.echo.asm
+------------------------------------------------------------+
| gavrasm gerd's AVR assembler Version 3.4 (C)2014 by DG4FAC |
+------------------------------------------------------------+
Compiling Source file: hello.ftdi.44.echo.asm
-------
Pass:        1
145 lines done.

Pass 1 ok.
-------
Pass:        2
Line: 14
Warning 009: Include defs not necessary, using internal values!
  File: hello.ftdi.44.echo.asm, Line: 14
  Source line: .include "tn44def.inc"
Line: 140
Warning 004: Number of bytes on line is odd, added 00 to fit program memory!
  File: hello.ftdi.44.echo.asm, Line: 140
  Source line:          message: .db "hello.ftdi.44.echo.asm: you typed ",0
145 lines done.


60 words code, 18 words constants, total=78 =  3.8%

2 warnings!
Compilation completed, no errors. Bye, bye ...
satsha@satsha-mint:~/tmp/hello/work_asm > sudo make program-usbtiny-fuses
avrdude -p t44 -P usb -c usbtiny -U lfuse:w:0x5E:m

avrdude: AVR device initialized and ready to accept instructions 

Reading | ################################################## | 100% 0.00s

avrdude: Device signature = 0x1e9207
avrdude: reading input file "0x5E"
avrdude: writing lfuse (1 bytes):

Writing | ################################################## | 100% 0.00s

avrdude: 1 bytes of lfuse written
avrdude: verifying lfuse memory against 0x5E:
avrdude: load data lfuse data from input file 0x5E:
avrdude: input file 0x5E contains 1 bytes
avrdude: reading on-chip lfuse data:

Reading | ################################################## | 100% 0.00s

avrdude: verifying ...
avrdude: 1 bytes of lfuse verified

avrdude: safemode: Fuses OK (H:FF, E:DF, L:5E)

avrdude done.  Thank you.

satsha@satsha-mint:~/tmp/hello/work_asm > sudo make program-usbtiny
avrdude -p t44 -P usb -c usbtiny -U flash:w:hello.ftdi.44.echo.hex

avrdude: AVR device initialized and ready to accept instructions

Reading | ################################################## | 100% 0.00s

avrdude: Device signature = 0x1e9207
avrdude: NOTE: "flash" memory has been specified, an erase cycle will be performed
         To disable this feature, specify the -D option.
avrdude: erasing chip
avrdude: reading input file "hello.ftdi.44.echo.hex"
avrdude: input file hello.ftdi.44.echo.hex auto detected as Intel Hex
avrdude: writing flash (156 bytes):

Writing | ################################################## | 100% 0.20s

avrdude: 156 bytes of flash written
avrdude: verifying flash memory against hello.ftdi.44.echo.hex:
avrdude: load data flash data from input file hello.ftdi.44.echo.hex:
avrdude: input file hello.ftdi.44.echo.hex auto detected as Intel Hex
avrdude: input file hello.ftdi.44.echo.hex contains 156 bytes
avrdude: reading on-chip flash data:

Reading | ################################################## | 100% 0.22s

avrdude: verifying ...
avrdude: 156 bytes of flash verified

avrdude: safemode: Fuses OK (H:FF, E:DF, L:5E)

avrdude done.  Thank you.


</pre></p>


				<p><br>To test the hello echo program, I used a Phyton script that can be found here: <a href="http://academy.cba.mit.edu/classes/embedded_programming/term.py"><span class="redones-link">term.py</span></a>. <br>The following screenshot demonstrates the hello echo program working:</p>
				<img class="images-default" src="img/week7/ECHO_OK.png" alt=""></p>

				<p>At this point I was almost sure that my board is working and thus I can start to create a program. For the first attempt I tried to write a <span class="redones">C program</span>. I found that there is a library called <a href="http://www.atmel.com/webdoc/AVRLibcReferenceManual/index_1avr_libc_intro.html"><span class="redones-link">AVR Libc</span></a>, specifically developed to provide a subset of the standard C library <span class="redones">Libc</span>. This library supports almost <a href="http://www.atmel.com/webdoc/AVRLibcReferenceManual/index_1supp_devices.html"><span class="redones-link">all AVR devices</span></a>, and there is also a complete <a href="http://www.atmel.com/webdoc/AVRLibcReferenceManual/index.html"><span class="redones-link">reference manual</span></a> on Atmel website. As starting point I considered the <a href="http://www.atmel.com/webdoc/AVRLibcReferenceManual/group__demos.html"><span class="redones-link">demo projects tutorials</span></a>.</p>
				<p>After I studied a bit of these tutorials and read past students embedded programming exercises, I decided to create a C program that involves <span class="redones">input from a button and/or an external source, output to a led and interrupts</span>. So I ended up in making a sort of <span class="redones">led Ping Pong program </span> between an Arduino and my hello board. After a bit of thinking on it, and some inspiration coming from Massimo Menichinelli 2012 embedded programming exercise, here is the complete C program:</p>

				<p><pre class="prettyprint lang-c">
#include &ltavr/io.h&gt
#include &ltinttypes.h&gt
#include &ltutil/delay.h&gt
#include &ltavr/interrupt.h&gt

void delay_ms(uint16_t ms);
void init();
int signal_received();
void switch_led();

int led_on;

#define F_CPU 20000000UL         	     /* 20MHz crystal oscillator */

#define ARDUINO_AND_LED_PORT PORTA           /* PORTx - register for arduino and led */
#define ARDUINO_AND_BUTTON_PIN PINA          /* PINx - register for arduino input */
#define ARDUINO_BIT PA6                      /* bit for Arduino input */
#define BUTTON_BIT PA3                       /* bit for button input */

#define LED_BIT PA7                          /* bit for button input/output */
#define LED_DDR DDRA                         /* LED data direction register */

#define DEBOUNCE_TIME 5                      /* button debounce time */
#define LOCK_INPUT_TIME 5                    /* time to wait after Arduino input/time to wait after a button press */

#define set(port,pin) (port |= pin)          
#define interrupt (1 << PCIE6)               /* interrupt settings */     
#define interrupt_pin (1 << PCINT6) 	     /* interrupt settings */

//interrupt function
ISR(PCINT0_vect) {
  
    switch_led();  
  
}

//software and hardware initialization function
void init() {
  
	led_on = 0;
	  
        /* set LED pin as digital output */
        LED_DDR = _BV (LED_BIT); 

        /* turn led off */         
        ARDUINO_AND_LED_PORT |= _BV(ARDUINO_BIT);

}

int main (void){
        
  init();

  while (1){
      
    if (signal_received()){
                        
      switch_led();
                       
    }
      
  }
    
}

//simple function to stop execution of given milliseconds
void delay_ms(uint16_t ms) {
        
  while ( ms ){
        
    _delay_ms(1);
    ms--;
    
  }
  
}

//check if a signal from the butto or Arduino ha arrived
int signal_received(){
  
  /* the button is pressed when BUTTON_BIT is clear or Arduino is sending a signal when ARDUINO_BIT is clear */
  if (bit_is_clear(ARDUINO_AND_BUTTON_PIN, ARDUINO_BIT) || bit_is_clear(ARDUINO_AND_BUTTON_PIN, BUTTON_BIT)){
    
    //wait a certain time for button debounce
    delay_ms(DEBOUNCE_TIME);
    
    if (bit_is_clear(ARDUINO_AND_BUTTON_PIN, ARDUINO_BIT) || bit_is_clear(ARDUINO_AND_BUTTON_PIN, BUTTON_BIT))
      return 1;
      
  }

  return 0;

}

//if led is on switch it off and vice versa
void switch_led(){

  if(led_on){
      
    ARDUINO_AND_LED_PORT = 0b00000001;
    led_on = 0;
      
  }else{
    
    ARDUINO_AND_LED_PORT = 0b10000000; 
    led_on = 1;
      
   }
    
} </pre></p>
				<p><br>As you can see from the code, is possible to pilot the hello board's led with the button, but also with a signal from an Arduino. To test this program I also developed a simple <span class="redones">Arduino sketch</span>:</p>


				<p><pre class="prettyprint lang-c">
void setup() {
  
  pinMode(7, OUTPUT);
  pinMode(10, OUTPUT);

}

void loop() {
 
  digitalWrite(10, LOW);
  digitalWrite(7, LOW);
  
  delay(500);
  
  digitalWrite(10, HIGH);
  digitalWrite(7,HIGH);

  delay(500);

}				</pre></p>
				<p><br>Here can see a video that shows the led Ping Pong program while is working with my hello board and an Arduino:</p>
				<iframe src="https://player.vimeo.com/video/122902948" width="700" height="450" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe> <p>
				<p><br>Also, is possible to pilot the led with the button, as shown in the following video:</p>
				<iframe src="https://player.vimeo.com/video/122902949" width="700" height="450" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
				<p><br>To experiment a bit more, I tried to control my hello board's led <span class="redones">through internet</span> via a REST service. To do this I used my <span class="redones">InternetOfArduinos</span> framework (here is <a href="https://github.com/satshas/InternetOfArduinos"><span class="redones-link">GitHub repo</span></a>), the same C code of above for the hello board and the following Arduino sketch:</p>
				<p><pre class="prettyprint lang-c">
bool flag = false;

void setup()
{
  Serial.begin(9600);
  pinMode(7, OUTPUT);
}

void loop()
{

  if(Serial.available()){
    
    delay(100);
    
    while(Serial.available())
      Serial.read();
     
     Serial.println("hi, i'm arduino :)!");
  
     if(flag){
     
       flag = false;
       digitalWrite(7, HIGH);
     
     }else{
     
       flag = true;
       digitalWrite(7, LOW);
       
     }
  }
  
}			</pre></p>
			<p><br>In the following video is possible to see that I can control the hello board's led with a REST call made with a smartphone:</p>
			<iframe src="https://player.vimeo.com/video/122906315" width="750" height="450" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe> 

				<p><br>Apart from C, is also possible to use <span class="redones">Arduino IDE</span> to program our hello board. To do this we need to modify Arduino IDE as described in this tutorial: <a href="http://highlowtech.org/?p=1695"><span class="redones-link">Programming an ATtiny w/ Arduino IDE</span></a>. This tutorial has a little error about where to put attiny folder, the right place is inside Arduino IDE folder and not inside sketchbook folder. Once setted the Arduino IDE, it shows some new settings related to the Attiny MCU family:</p>
				<img class="images-default" src="img/week7/patched_ide.png" alt=""></p>	
				<p>To test coding my hello board with Arduino IDE, I modifed the Button example to have a similar behaviour of C Ping Pong when button is pressed. Here you can see the code:</p>

<p><pre class="prettyprint lang-c">
/*
  Button

 Turns on and off a light emitting diode(LED) connected to digital
 pin 13, when pressing a pushbutton attached to pin 2.


 The circuit:
 * LED attached from pin 13 to ground
 * pushbutton attached to pin 2 from +5V
 * 10K resistor attached to pin 2 from ground

 * Note: on most Arduinos there is already an LED on the board
 attached to pin 13.


 created 2005
 by DojoDave <http://www.0j0.org>
 modified 30 Aug 2011
 by Tom Igoe

 This example code is in the public domain.

 http://www.arduino.cc/en/Tutorial/Button
 */

// constants won't change. They're used here to
// set pin numbers:
const int buttonPin = 3;     // the number of the pushbutton pin
const int ledPin =  7;      // the number of the LED pin

// variables will change:
int buttonState = 0;         // variable for reading the pushbutton status
bool led_on;

void setup() {
  // initialize the LED pin as an output:
  pinMode(ledPin, OUTPUT);
  // initialize the pushbutton pin as an input:
  pinMode(buttonPin, INPUT);
  
  led_on=true;
}

void loop() {
  // read the state of the pushbutton value:
  buttonState = digitalRead(buttonPin);

  // check if the pushbutton is pressed.
  // if it is, the buttonState is HIGH:
  if (buttonState == HIGH) {
    // turn LED on:
    digitalWrite(ledPin, HIGH);
  }
  else {
    // turn LED on and off:
    if(led_on){
      
      digitalWrite(ledPin, LOW);
      led_on=false;
      delay(50);
      
    }else{
    
      digitalWrite(ledPin, HIGH);
      led_on=true;
      delay(50);
      
    }
  }
}</pre></p>

<p><br>Finally, here you can find all the code I've talked about in this week: <a href="other/code.rar"><span class="redones-link">download</span></a>.</p>

			</div>
		</section>
		<section id= "week8" class="row">
			<div class="photo-grid">
				<p>Along this week we've learned about <span class="redones">computer-controlled machining</span>.</p>

				<p>To demonstrate we dealt with CNC's intrinsic way of working, our assignment was to <span class="redones">make something big</span>. Personally, to avoid wood waste, I added to this assignment also a personal objective to build a thing that I will really use. Because of my final project, that probably will require alot of work on electronic and mechanics, I decided to make a <span class="redones">work table</span>. I will use this table to solder boards, to assembly parts and so on.</p> 


				<ul class="lists">
					<li>Here are some <span class="redones">considerations</span> I've taken into account before starting design my work table:</li>
					<li>each of us has available a single wood sheet of <span class="redones">210cm x 145cm x 1.2cm</span>
					<li>actually I live in a place where there isn't so much space, so I chosen a <span class="redones">width x depth of 75cm x 75cm</span></li>
					<li>I could use tools like screwdrivers, tongs etc , so I will create a specific <span class="redones">holed shelf</span> where I can put them</li>
					<li>I could need to put my elbows on it, so table must <span class="redones">resist to some weight</span></li>
					<li>I want to make it <span class="redones">assembly only by joints</span></li>
					<li>I will use a <span class="redones">6mm CNC bit</span></li>
				</ul>

				<p>What comes out of all of these constraints was the following drawing:</p>
				<img class="images-default" src="img/week8/screen.png">

				<p>Because of I manually drawn joints, I also made a <span class="redones">3D model</span> of the work table, in order to check if its dimensions were ok:</p>
				<img class="images-default" src="img/week8/render.jpg">
				<p>At this point I was ready to export an <span class="redones">*.dxf</span> file and to open it with <span class="redones">vCarve Pro</span>. Inside vCarve Pro we can set low level CNC settings, and export our drawings into a file format directly readable by ShopBot CNC controlling software.</p>

				<p>Here you can see some vCarve Pro screenshots that shown the settings I was using. First, I set Job Size and material thickness. We fixed wood sheet with some borderline bolts, so I set height 1cm less:</p>
				
				<img class="images-default" src="img/week8/vCarve_prop.png">
				
				<p>To optimize the cut and to left some wood for future jobs, I used <span class="redones">Nest Parts</span> feature. Here are the nest settings I was using:</p>
				<img class="images-default" src="img/week8/vCarve_nest1.png">
				<p>And here are the results of nesting:</p>
				<img class="images-default" src="img/week8/vCarve_nest2.png">

				<p>The first cuts I wanted to make were the internal ones. This because is possible that a piece will move a bit after it's cut, so if it contains <span class="redones">internal cuts</span>, these will move as well. So I selected all the internals cuts:</p>
				<img class="images-default" src="img/week8/vCarve_int1.png">
				<p>And I applied to them the following settings:</p>
				<img class="images-default" src="img/week8/vCarve_int2.png">
				<p>As you can see, I set <span class="redones">Inside / Left</span> as Machine Vectors, because of these cuts were internal. Finally, for the internal cuts, I wanted to see the preview:</p>
				<img class="images-default" src="img/week8/vCarve_int3.jpg">

				<p>Similar procedure I followed for the <span class="redones">external cuts</span>, with the difference that this time the Machine Vectors setting were <span class="redones">Outside / Right</span>:</p>

				<img class="images-default" src="img/week8/vCarve_ext1.png">
				<img class="images-default" src="img/week8/vCarve_ext2.png">
				<img class="images-default" src="img/week8/vCarve_ext3.jpg">

				<p>Before starting cuts, I used the ShobBot controlling software to reset X and Y axis and to calibrate Z axis:</p>
				<img class="images-default" src="img/week8/sharebot.jpg">

				
				<p>Here you can see a video about our ShopBot starting to do internal cuts:</p>
				<iframe src="https://player.vimeo.com/video/123101274" width="700" height="450" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>

				<p>And here is shown that the Job Size and Nest Parts <span class="redones">Border Gap</span> were ok:</p>
				<iframe src="https://player.vimeo.com/video/123101276" width="700" height="450" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>

				<p>Here is the table, quickly assembled just after it has been cut:</p>
				<img class="images-default" src="img/week8/table_first.jpg">


				<p>To refine table's wood I used some sand paper. Here are some pictures about the <span class="redones">final result</span>:</p>
				<img class="images-default" src="img/week8/table_front.jpg">
				<img class="images-default" src="img/week8/table_back.jpg">
				<img class="images-default" src="img/week8/table_left.jpg">
				<img class="images-default" src="img/week8/table_right.jpg">
				<img class="images-default" src="img/week8/table_eng.jpg">
				<img class="images-default" src="img/week8/table_pra.jpg">
				
				<p>Here are some detailed pictures about the quality of the joints:</p>
				<img class="images-default" src="img/week8/table_holes.jpg">
				<img class="images-default" src="img/week8/table_inc1.jpg">
				<img class="images-default" src="img/week8/table_inc2.jpg">
				<img class="images-default" src="img/week8/table_inc3.jpg">
				<img class="images-default" src="img/week8/table_inc4.jpg">

				<p>Also, some tabs caused <span class="redones">little imperfections</span> while I was detaching pieces, maybe next time I will reduce tabs size and their quantity:</p>
				<img class="images-default" src="img/week8/table_tab1.jpg">
				<img class="images-default" src="img/week8/table_tab2.jpg">

				<p>At the end I also made a <span class="redones">load test</span> with myself on the table, that luckily was <span class="redones">successful</span>:</p>
				<iframe src="https://player.vimeo.com/video/123137722" width="700" height="450" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>

				<p><br>And my fellow student <span class="redones">PieLuigi de Palo</span> made a time-lapse video:</p>
				<iframe width="700" height="450" src="https://www.youtube.com/embed/Uvtn-7FNFI4" frameborder="0" allowfullscreen></iframe>

				<p><br>Here you can download the drawing of the <a href="drawings/week8/work_table.3dm.rar"><span class="redones-link">work table</span></a>. Or, if just want to see on the fly the 3D model, here it is:</p>

			</div>
		</section>
		<section id= "week9" class="row">
			<div class="photo-grid">
				<p>In this week we've talked about <span class="redones">molding and casting</span>.</p>

				<p>For this assignment I decided to make a cross composed by <span class="redones">golden spiral</span>. First I drawn a golden spiral with <span class="redones">golden ratio</span>:</p>


				<img class="images-default" src="img/week9/spiral1.jpg">
				<img class="images-default" src="img/week9/spiral2.jpg">

				<p>Then, in order to transform it in a 3D shape, I drawn two circumferences at the begin and the end of the spiral:</p>
				<img class="images-default" src="img/week9/spiral3.jpg">

				<p>To get a 3D shape I used the command <span class="redones">Sweep1</span> of Rhino:</p>
				<img class="images-default" src="img/week9/spiral4.png">

				<p>To create the complete cross I simply copied at 90° degree single spirals:</p>
				<img class="images-default" src="img/week9/object.jpg">

				<p>After completing the cross I was ready to designed the mold. I drawn, accordingly with our <span class="redones">wax block</span>, the mold for silicon rubber. Here you can see wax block with two holes ready to insert half of the cross:</p>
				<img class="images-default" src="img/week9/mold1.jpg">
				<p>And here you can see the final model ready to be CNC'ed:</p>
				<img class="images-default" src="img/week9/mold2.png">
				<p>To check if the model was ok, I also tried to put the mold's faces in front each other. As shown in the following pictures, the faces dimensions were ok:</p>
				<img class="images-default" src="img/week9/mold3.png">
				<img class="images-margin-auto" src="img/week9/mold4.jpg">

				<p>Due to some problems to the FabLab mini CNC mill, I tried to use a trashed piece of solid wood with the <span class="redones">ShopBot CNC</span> and a <span class="redones">3mm end mill</span>. Of course I scaled my 3D model in order to be fully cut with the 3mm end mill. Here you can see a video about ShopBot CNC while it's working the piece:</p>

				<iframe width="700" height="450" src="https://www.youtube.com/embed/LOwo2QMlYEM" frameborder="0" allowfullscreen></iframe>

				<p><br>The result was very good, considering the size of the ShopBot. Here you can see the CNC'ed spirals, with applied some <span class="redones">wood coating</span>:</p>
				<img class="images-default" src="img/week9/wood_spirals.jpg">
				<p>I applied some wood coating in order to obtain a better finishing surface. At this point of the process I was ready to <span class="redones">cast the silicon rubber</span>. Before starting casting, I prepared all the things I needed:</p>
				<img class="images-default" src="img/week9/before_start.jpg">
				
				<p>Also, I put some <span class="redones">nails and a bolt</span>, needed to insert the silicon rubber and to get out the air at the end of the spirals.</p>
				<img class="images-default" src="img/week9/nails.jpg">

				<p>Using Rhino I measured the <span class="redones">volume</span>, so I was able to know how much silicon rubber and catalyst I needed. I used <span class="redones">Smooth-Sil 940 silicon rubber</span>, suitable for food-related applications. This silicon rubber has the pot life of <span class="redones">30 minutes and a curing time of 24h</span>. The first step was to weigh silicon rubber:</p>
				<img class="images-default" src="img/week9/silicon_rubber.jpg">
				<p>Then to add the right quantity of catalyst to be sure that all the silicon rubber will be catalysed:</p>
				<img class="images-default" src="img/week9/catalyst.jpg">
				<p>At this point I checked the clock for the pot life, and then I started to slowly blend silicon rubber with the catalyst:</p>
				<img class="images-default" src="img/week9/blend.jpg">
				<p>After a while the <span class="redones">color of the silicon rubber changed</span> from white to an uniform pink, fact that indicates it was fully mixed with the catalyst:</p>
				<img class="images-default" src="img/week9/blended.jpg">
				
				<p>So I started to slowly and carefully cast silicon rubber into the mold:</p>
				
				<img class="images-default" src="img/week9/start_drop.jpg">
				<p>I casted it very slowly, and never changing the contact place of the silicon rubber with the wood. This to avoid as much as possible <span class="redones">bubble airs</span> while the casting process was done. The following pictures shows silicon rubber slowly filling the mold:</p>
				<img class="images-default" src="img/week9/after_drop.jpg">
				<p>Again to avoid bubble airs, and after all silicon rubber was casted, we used a drill with a oblique nail to tremble the mold. Here you can see a video about:</p>
				<iframe width="700" height="450" src="https://www.youtube.com/embed/mcPf8KQ3wr8" frameborder="0" allowfullscreen></iframe>
				<p><br>So here it's the mold with the silicon rubber waiting for <span class="redones">24 hours</span>:</p>
				<img class="images-default" src="img/week9/after_drop_complete.jpg">
				<p>And this what's happened when I tried to remove the silicon rubber:</p>
				<img class="images-default" src="img/week9/first_detach.jpg">
				<p>The capability to <span class="redones">reproduce details</span> of this kind of silicon is very good. As an example it was capable also to get inside into a very thin wood notch:</p>
				<img class="images-default" src="img/week9/particular.jpg">
				<p>So finally here is the silicon rubber mold ready to be used:</p>
				<img class="images-default" src="img/week9/after_ok.jpg">
				<p>A closer look shown me that a little, superficial, area of the silicon rubber <span class="redones">was not correctly catalysed</span>:</p>
				<img class="images-default" src="img/week9/dont_solidify.jpg">
				<p>Due I wasn't have the chance to redo the silicon rubber mold, I was thinking about passing with light sand paper into the final object, in order to reduce the evidence of this little defect. So I started to assembly the silicon rubber mold:</p>
				
				<img class="images-default" src="img/week9/mold_open.jpg">
				<img class="images-default" src="img/week9/closed_mold.jpg">

				<p>I needed also to <span class="redones">compress the mold</span> to be sure that no resin will come out of it. So I used two <span class="redones">flat pieces of wood</span>:</p>
				<img class="images-default" src="img/week9/block.jpg">
				<p>And blocked all with several pieces of electrical scotch tape:</p>
				<img class="images-default" src="img/week9/block_before.jpg">
				<img class="images-default" src="img/week9/fix_block.jpg">

				<p>The first attempt was made with <span class="redones">Smooth Cast Color-Match 325</span>. This resin has a very short <span class="redones">pot life of 2.5 minutes, and a curing time of 10 minutes</span>. As you can see from the following pictures I had two problems. One was that in the short pot life I didn't correctly mixed resin parts. This cause that the final object will never fully solidify. Also, it remained a little bit transparent:</p>
				<img class="images-default" src="img/week9/result_mixed1.jpg">
				<p>The other problem was relative about a <span class="redones">big bubble air</span>, just under the hole for inserting the resin:</p>
				<img class="images-default" src="img/week9/result_mixed.jpg">
				<p>My second attempt was made with <span class="redones">Smooth Cast Color-Match 305</span>, that has a <span class="redones">pot life of 7 minutes and a curing time of 30 minutes</span>. This time I correctly mixed the resin parts, but, even if I tried to <span class="redones">inject the resin more slowly</span>, another air bubble was there:</p>
				<img class="images-default" src="img/week9/result2.jpg">
				<p>As third attempt, again with 305, I tried to <span class="redones">enlarge the the hole for inserting the resin</span>. In this way I avoid the big air bubble at the center, but some other small bubbles were there:</p>
				<img class="images-default" src="img/week9/result3.jpg">
				<p>For my last attempt I tried to put some <span class="redones">gray dye</span> to 305, and to <span class="redones"> insert a nail in the resin filling hole</span> after the resin was casted. This time I get a decent result:</p>
				<img class="images-default" src="img/week9/final_before.jpg">
				<p>So I used some sand paper, to refine the piece and to remove the little defect I talked about before:</p>
				<img class="images-default" src="img/week9/minor.jpg">
				<p>Here you can see the final version of the casted spirals:</p>	
				<img class="images-default" src="img/week9/final1.jpg">
				
				<p>As little experiment I tried also to put inside the resin one of the my failed attempt to solder the ATMega2560, here you can see a picture of that, before the resin was totally catalysed:</p>	

				<img class="images-default" src="img/week9/2560.jpg">

				<p>Here you can find the model of the mold: <a href="drawings/week9/spirals.rar"><span class="redones-link">spirals</span></a>, and here you can <span class="redones">play</span> with the model:</p>

			</div>
		</section>
		<section id= "week10" class="row">
			<div class="photo-grid">
				<p>Along this week we've learned about <span class="redones">input devices</span>.</p>
				
				<p>To start with this assignment, first I tried to make the <span class="redones">Fabkit</span>. I was thinking about using Fabkit and its compatibility with a patched Arduino IDE, as starting board to use some sensors. In order to make Fabkit, I followed the official FabAcademy tutorial posted by Massimo: <a href="http://fabacademy.org/archives/2015/doc/projects/fabkit-0.4.html"><span class="redones-link" >A newer Fabkit</span></a>.</p>

				<p>Despite several difficulties I had in soldering Fabkit, here is the Fabkit soldered:</p>
				<img class="images-default" src="img/week10/fabkit.jpg">

				<p>I managed to successfully upload the Arduino bootloader and some examples sketch like Blink one. However I was <span class="redones">not satisfied by Fabkit</span>. This mainly because you <span class="redones">need to patch your Arduino IDE</span> in order to make it work with Fabkit, and also it differ from original Arduino because of the clock of 8Mhz instead of 16Mhz. Furthermore, there are other differences with original Arduino, like using a resonator instead of a crystal. So after a while I decided <span class="redones">to design my own board</span>, with these differences as the main improvements that my new board can have. This board could be also useful for my final project, as a <span class="redones">first prototype of flight controller</span>.</p>

				<p>I made <span class="redones">several attemtps (5 dead boards!)</span>, before, Thursday night, I was able to made first <span class="redones">working board</span>. I called this board <span class="redones">satshakit</span>. As some of my fellow students had difficulties with Fabkit, they tried to make this prototype board. The board was very appreciated that some of my fellow students made it for their exercises, or use it as a starting point for their final projects. Thus I decided to do this documentation, if anyone wants to try it. I also started a <a href="https://github.com/satshas/satshakit"><span class="redones-link" >Github repo</span></a>.</p>

				<p>Here is a screenshot about <span class="redones">satshakit schematic</span>:</p>

				<img class="images-default" src="img/week10/satshakit_schematic.png">

				<p>And here is a screenshot about <span class="redones">satshakit board</span>:</p>

				<img class="images-default" src="img/week10/satshakit_board.png">

				<p>As we use the Trotec laser cutter machine, here is satshakit inkscape file ready to be printed:</p>

				<img class="images-default" src="img/week10/satshakit_print.png">

				<p>So here is <span class="redones">first satshakit</span> board that worked without problems:</p>

				<img class="images-default" src="img/week10/first_satshakit.jpg">

				<p>In order to help my fellow students to replicate this board, I also made a <span class="redones">BOM of satshakit</span>:</p>
				<iframe width="1200" height="400" src="https://docs.google.com/spreadsheets/d/1svDoZXL4UT52zrwGDGs7aG2bA4hvbDQF-i0Wjd3rae0/pubhtml?widget=true&amp;headers=false"></iframe>
				<p></p>
				<ul class="lists">
				<li><span class="redones">Main improvements</span> of satshakit over Fabkit are:</li>
				<li><span class="redones">16Mhz</span> instead of 8Mhz</li>
				<li><span class="redones">crystal</span> instead of resonator</li>
				<li><span class="redones">it costs less</span> (9.23 euro vs 13.11 euro)</li>
				<li><span class="redones">it uses default Arduino IDE</span> (satshakit is recognized as Arduino UNO) instead of a patched Arduino IDE</span></li>
				<li>it has almost <span class="redones">rect traces</span> instead of almost oblique ones</li>
				<li>ADC6/7 connected instead of ADC6/7 not connected</li>
				<li>larger space to easy soldering</li>
				<li>power led instead of none</li>
				</ul>		


				<p>To use satshakit as an Arduino, here is <span class="redones">Arduino pinout on satshakit<span class="redones">:</p>

				<img class="images-default" src="img/week10/arduino_pin_mapping.png">

				<p>Also, here is the schema about <span class="redones">programming satshakit with a FabISP</span>:</p>
				
				<img class="images-default" src="img/week10/programming_fab_isp.png">

				<p>So here are some boards from my fellow students <span class="redones">Pierluigi de Palo and Mattia Ciurnelli</span>:</p>
				<img class="images-default" src="img/week10/satshakits.jpg">

				<p>And also some videos that show <span class="redones">satshakit while is working</span> with different configurations/sensors:</p>

				<iframe width="700" height="450" src="https://www.youtube.com/embed/YNITEv0ebkc" frameborder="0" allowfullscreen></iframe>

				<iframe width="700" height="450" src="https://www.youtube.com/embed/Gk_RFebLofY" frameborder="0" allowfullscreen></iframe>

				<iframe width="700" height="450" src="https://www.youtube.com/embed/ZQmN3uTlZuc" frameborder="0" allowfullscreen></iframe>
				<p></p>
				<p>Rethinking about this week assignment, now with satshakit available, I decided to make a <span class="redones">little radar</span>. I made this radar with a reclycled (from a scanner)  <span class="redones">unipolar stepper motor and two HC-SR04 sonar sensors </span> attached to the stepper with some 
				scotch tape. Here are some pictures about:</p>

				<img class="images-default" src="img/week10/radar_1.jpg">

				<img class="images-default" src="img/week10/radar_2.jpg">

				<img class="images-default" src="img/week10/radar_3.jpg">

				<p>In order to move the stepper motor I design a special version of satshakit board: <span class="redones">satshakit radar</span>. This board is basically a satshakit, plus an <span class="redones">ULN2003A</span> to control the stepper motor. Here is a screenshot about <span class="redones">satshakit radar schematic</span>:</p>
				
				<img class="images-default" src="img/week10/satshakit_radar_schematic.png">

				<p>And here you can see a screenshot about <span class="redones">satshakit radar board:</span></p>

				<img class="images-default" src="img/week10/satshakit_radar_board.png">
				
				<p>Here is a picture of the soldered and ready-to-use satshakit radar board:</p>

				<img class="images-default" src="img/week10/satshakit_radar.jpg">

				<p>To move stepper motor and get distance data from sensors, I wrote the following Arduino sketch (it uses  <a href="https://code.google.com/p/arduino-new-ping/"><span class="redones-link" >NewPing library</span></a> to work with HC-SR4 sensors):</p>

				<p><pre class="prettyprint lang-c">
#include Stepper.h
#include NewPing.h

#define TRIGGER_PIN1  12
#define ECHO_PIN1     11
#define MAX_DISTANCE1 400
#define TRIGGER_PIN2  3
#define ECHO_PIN2     2

#define MAX_DISTANCE2 400
#define STEPS 48
int HALF_TURN = 24;

int count = 0;
boolean dir = true;

NewPing sonar1(TRIGGER_PIN1, ECHO_PIN1, MAX_DISTANCE1);
NewPing sonar2(TRIGGER_PIN2, ECHO_PIN2, MAX_DISTANCE2);

Stepper stepper(STEPS, 5, 6, 7, 8); 

void setup()
{
  
  Serial.begin(115200);
  stepper.setSpeed(30);

}

void loop()
{
  
  delay(50);
  
  if(dir){
 
      ++count;
      stepper.step(1);
      unsigned int uS1 = sonar1.ping();
      Serial.print("S1: ");
      Serial.print(uS1 / US_ROUNDTRIP_CM);
      Serial.println("cm");
      unsigned int uS2 = sonar2.ping();
      Serial.print("S2: ");
      Serial.print(uS2 / US_ROUNDTRIP_CM);
      Serial.println("cm");
      
      if(count==HALF_TURN){
      
        count = 0;
        dir = false;
        
      }
    
  }else{
  
        ++count;
      stepper.step(-1);
      unsigned int uS1 = sonar1.ping();
      Serial.print("S1: ");
      Serial.print(uS1 / US_ROUNDTRIP_CM);
      Serial.println("cm");
      Serial.print("S2: ");
      unsigned int uS2 = sonar2.ping();
      Serial.print(uS2 / US_ROUNDTRIP_CM);
      Serial.println("cm");
  
      if(count==HALF_TURN){
      
        count = 0;
        dir = true;
        
      }
  
  }
  

}
				</pre></p>	

				<p></p>
				<p>Here are some <span class="redones">videos about satshakit radar</span>. Here is satshakit radar  while uploading Arduino bootloader:</p>

				<iframe width="700" height="450" src="https://www.youtube.com/embed/ws3hkNioKY0" frameborder="0" allowfullscreen></iframe>

				<p>And here while uploading satshakit radar Arduino sketch:</p>

				<iframe width="700" height="450" src="https://www.youtube.com/embed/6jgbYFliTYo" frameborder="0" allowfullscreen></iframe>

				<p>Finally, here is the <span class="redones">satshakit radar working</span> with data about distance of the two sonar sensors (labeled as S1 and S2 in the serial output) displayed in serial monitor. Stepper do half-turn and return back. In this way, with two opposed sonar sensors, radar is reading distance in a 360 degree range: </p>

				<iframe width="700" height="450" src="https://www.youtube.com/embed/0FD7bHNqlxU" frameborder="0" allowfullscreen></iframe>
				
				<p>Here you can find the files about satshakit, and satshakit radar Eagle projects: <a href="drawings/week10/satshakit.rar"><span class="redones-link" >download</span></a>. Also here is BOM in xlsx: <a href="other/satshakit_BOM.xlsx"><span class="redones-link">download</span></a>.</p>

				


			</div>
		</section>
		<section id= "week11" class="row">
			<div class="photo-grid">
				<p>During this week I've learned about <span class="redones">output devices.</span></p>

				<p>To accomplish with this weekly assignment, and at the same time do so something for my <span class="redones">quadcopter</span> final project, I tried to <span class="redones">control drone ESCs and motors</span> with a prototype of a flight controller board. As flight controller board I used <span class="redones">satshakit</span>, a general purpose Arduino compatible board, developed by me during input devices assignment. Here you can find some information about satshakit: <a href="http://fabacademy.org/archives/2015/doc/projects/satshakit/satshakit.html"><span class="redones-link">FabAcademy project</span></a>, <a href="https://github.com/satshas/satshakit"><span class="redones-link">Github repo</span></a></p>


				<p>As test platform for this assignment I assembled a <span class="redones">250mm quadcopter</span>, with four 12A ESCs, four 2150kv motors and a 2200mAh battery. Here you can see a pitcure about this test quadcopter:</p>

				<img class="images-default" src="img/week11/drone.jpg">

				<p>Satshakit is fully compatible with Arduino libraries, so first I tried to control a single ESC via the <a href="http://www.arduino.cc/en/reference/servo"><span class="redones-link">Arduino servo library</span></a>. Also I wanted to control the ESC via a value sent from serial console to satshakit. In order to do this I wrote the following Arduino sketch:</p>

				<pre class="prettyprint lang-c">
#include &ltServo.h&gt

int readValue = 0, value = 0;

Servo esc1;

void setup() {

  esc1.attach(9);
  Serial.begin(9600);
  
}

void loop() {

  esc1.writeMicroseconds(value);
 
  if(Serial.available()){ 
   
    readValue = Serial.parseInt();
    
    if(readValue != NULL){
    value = readValue;  
    
    Serial.println(value);
    
  }
  }

}
			</pre>
			<p><br><span class="redones">GND</span> of ESC BEC and satshakit must be connected together. Here is the connection schema of this setup:</p>
			<img class="images-default" src="img/week11/simple_schema.jpg">

			<p>And here you can see a picture about the setup of this test:</p>
			<img class="images-default" src="img/week11/drone_1esc_setup.jpg">
			<p>This test was <span class="redones">successfull</span>, the motor started to spin from the value of 1500, and reached maximum rotation speed at 2000. Encouraged from this first result, and as a more <span class="redones">complete setup</span>, I tried to control all the drone ESCs and motors, using a <a href="http://www.spektrumrc.com/Products/Default.aspx?ProdId=SPM5500"><span class="redones-link"> Spectrum DX5</span></a> as remote controller, an <a href="http://www.drotek.fr/shop/en/home/62-imu-10dof-mpu6050-hmc5883-ms5611.html"><span class="redones-link"> Drotek 10DOF</span></a> as IMU and <a href="http://www.multiwii.com/"><span class="redones-link">MultiWii 2.3</span> software</a>. So I configured MultiWii to work my quadcopter configuration:</p>

			<pre class="prettyprint lang-c">
 /**************************    The type of multicopter    ****************************/
    //#define GIMBAL
    //#define BI
    //#define TRI
    //#define QUADP
    #define QUADX
    //#define Y4
    //#define Y6
    //#define HEX6
    //#define HEX6X
    //#define HEX6H  // New Model
    //#define OCTOX8
    //#define OCTOFLATP
    //#define OCTOFLATX
    //#define FLYING_WING
    //#define VTAIL4
    //#define AIRPLANE
    //#define SINGLECOPTER
    //#define DUALCOPTER
    //#define HELI_120_CCPM
    //#define HELI_90_DEG
    /****************************    Motor minthrottle    *******************************/
    /* Set the minimum throttle command sent to the ESC (Electronic Speed Controller)
       This is the minimum value that allow motors to run at a idle speed  */
    //#define MINTHROTTLE 1300 // for Turnigy Plush ESCs 10A
    //#define MINTHROTTLE 1120 // for Super Simple ESCs 10A
    //#define MINTHROTTLE 1064 // special ESC (simonk)
    //#define MINTHROTTLE 1050 // for brushed ESCs like ladybird
    #define MINTHROTTLE 1050 // (*) (**)

  /****************************    Motor maxthrottle    *******************************/
    /* this is the maximum value for the ESCs at full power, this value can be increased up to 2000 */
    #define MAXTHROTTLE 1850

  /****************************    Mincommand          *******************************/
    /* this is the value for the ESCs when they are not armed
       in some cases, this value must be lowered down to 900 for some specific ESCs, otherwise they failed to initiate */
    #define MINCOMMAND  1000

  /**********************************  I2C speed for old WMP config (useless config for other sensors)  *************/
    #define I2C_SPEED 100000L     //100kHz normal mode, this value must be used for a genuine WMP
    //#define I2C_SPEED 400000L   //400kHz fast mode, it works only with some WMP clones
  /***************************    Internal i2c Pullups   ********************************/
    /* enable internal I2C pull ups (in most cases it is better to use external pullups) */
    //#define INTERNAL_I2C_PULLUPS

  /**********************************  constant loop time  ******************************/
    #define LOOP_TIME 2800

  /**************************************************************************************/
  /*****************          boards and sensor definitions            ******************/
  /**************************************************************************************/

    /***************************    Combined IMU Boards    ********************************/
      /* if you use a specific sensor board:
         please submit any correction to this list.
           Note from Alex: I only own some boards, for other boards, I'm not sure, the info was gathered via rc forums, be cautious */
      //#define FFIMUv1         // first 9DOF+baro board from Jussi, with HMC5843                   <- confirmed by Alex
      //#define FFIMUv2         // second version of 9DOF+baro board from Jussi, with HMC5883       <- confirmed by Alex
      //#define FREEIMUv1       // v0.1 & v0.2 & v0.3 version of 9DOF board from Fabio
      //#define FREEIMUv03      // FreeIMU v0.3 and v0.3.1
      //#define FREEIMUv035     // FreeIMU v0.3.5 no baro
      //#define FREEIMUv035_MS  // FreeIMU v0.3.5_MS                                                <- confirmed by Alex
      //#define FREEIMUv035_BMP // FreeIMU v0.3.5_BMP
      //#define FREEIMUv04      // FreeIMU v0.4 with MPU6050, HMC5883L, MS561101BA                  <- confirmed by Alex
      //#define FREEIMUv043     // same as FREEIMUv04 with final MPU6050 (with the right ACC scale)
      //#define NANOWII         // the smallest multiwii FC based on MPU6050 + pro micro based proc <- confirmed by Alex
      //#define PIPO            // 9DOF board from erazz
      //#define QUADRINO        // full FC board 9DOF+baro board from witespy  with BMP085 baro     <- confirmed by Alex
      //#define QUADRINO_ZOOM   // full FC board 9DOF+baro board from witespy  second edition
      //#define QUADRINO_ZOOM_MS// full FC board 9DOF+baro board from witespy  second edition       <- confirmed by Alex
      //#define ALLINONE        // full FC board or standalone 9DOF+baro board from CSG_EU
      //#define AEROQUADSHIELDv2
      //#define ATAVRSBIN1      // Atmel 9DOF (Contribution by EOSBandi). requires 3.3V power.
      //#define SIRIUS          // Sirius Navigator IMU                                             <- confirmed by Alex
      //#define SIRIUSGPS       // Sirius Navigator IMU  using external MAG on GPS board            <- confirmed by Alex
      //#define SIRIUS600       // Sirius Navigator IMU  using the WMP for the gyro
      //#define SIRIUS_AIR      // Sirius Navigator IMU 6050 32U4 from MultiWiiCopter.com           <- confirmed by Alex
      //#define SIRIUS_AIR_GPS  // Sirius Navigator IMU 6050 32U4 from MultiWiiCopter.com with GPS/MAG remote located
      //#define SIRIUS_MEGAv5_OSD //  Paris_Sirius™ ITG3050,BMA280,MS5611,HMC5883,uBlox  http://www.Multiwiicopter.com <- confirmed by Alex
      //#define MINIWII         // Jussi's MiniWii Flight Controller                                <- confirmed by Alex
      //#define MICROWII        // MicroWii 10DOF with ATmega32u4, MPU6050, HMC5883L, MS561101BA from http://flyduino.net/
      //#define CITRUSv2_1      // CITRUS from qcrc.ca
      //#define CHERRY6DOFv1_0
      //#define DROTEK_10DOF    // Drotek 10DOF with ITG3200, BMA180, HMC5883, BMP085, w or w/o LLC
      //#define DROTEK_10DOF_MS // Drotek 10DOF with ITG3200, BMA180, HMC5883, MS5611, LLC
      //#define DROTEK_6DOFv2   // Drotek 6DOF v2
      //#define DROTEK_6DOF_MPU // Drotek 6DOF with MPU6050
      #define DROTEK_10DOF_MPU//
      //#define MONGOOSE1_0     // mongoose 1.0    http://store.ckdevices.com/
      //#define CRIUS_LITE      // Crius MultiWii Lite
      //#define CRIUS_SE        // Crius MultiWii SE
      //#define CRIUS_SE_v2_0   // Crius MultiWii SE 2.0 with MPU6050, HMC5883 and BMP085
      //#define OPENLRSv2MULTI  // OpenLRS v2 Multi Rc Receiver board including ITG3205 and ADXL345
      //#define BOARD_PROTO_1   // with MPU6050 + HMC5883L + MS baro
      //#define BOARD_PROTO_2   // with MPU6050 + slave  MAG3110 + MS baro
      //#define GY_80           // Chinese 10 DOF with  L3G4200D ADXL345 HMC5883L BMP085, LLC
      //#define GY_85           // Chinese 9 DOF with  ITG3205 ADXL345 HMC5883L LLC
      //#define GY_86           // Chinese 10 DOF with  MPU6050 HMC5883L MS5611, LLC
      //#define GY_88 // Chinese 10 DOF with MPU6050 HMC5883L BMP085, LLC
      //#define GY_521          // Chinese 6  DOF with  MPU6050, LLC
      //#define INNOVWORKS_10DOF // with ITG3200, BMA180, HMC5883, BMP085 available here http://www.diymulticopter.com
      //#define INNOVWORKS_6DOF // with ITG3200, BMA180 available here http://www.diymulticopter.com
      //#define MultiWiiMega    // MEGA + MPU6050+HMC5883L+MS5611 available here http://www.diymulticopter.com
      //#define PROTO_DIY       // 10DOF mega board
      //#define IOI_MINI_MULTIWII// www.bambucopter.com
      //#define Bobs_6DOF_V1     // BobsQuads 6DOF V1 with ITG3200 & BMA180
      //#define Bobs_9DOF_V1     // BobsQuads 9DOF V1 with ITG3200, BMA180 & HMC5883L
      //#define Bobs_10DOF_BMP_V1 // BobsQuads 10DOF V1 with ITG3200, BMA180, HMC5883L & BMP180 - BMP180 is software compatible with BMP085
      //#define FLYDUINO_MPU       // MPU6050 Break Out onboard 3.3V reg
      //#define CRIUS_AIO_PRO
      //#define DESQUARED6DOFV2GO  // DEsquared V2 with ITG3200 only
      //#define DESQUARED6DOFV4    // DEsquared V4 with MPU6050
      //#define LADYBIRD
      //#define MEGAWAP_V2_STD     // available here: http://www.multircshop.com                    <- confirmed by Alex
      //#define MEGAWAP_V2_ADV
      //#define HK_MultiWii_SE_V2  // Hobbyking board with MPU6050 + HMC5883L + BMP085
      //#define HK_MultiWii_328P   // Also labeled "Hobbybro" on the back.  ITG3205 + BMA180 + BMP085 + NMC5583L + DSM2 Connector (Spektrum Satellite)  
      //#define RCNet_FC           // RCNet FC with MPU6050 and MS561101BA  http://www.rcnet.com
      //#define RCNet_FC_GPS       // RCNet FC with MPU6050 + MS561101BA + HMC5883L + UBLOX GPS http://www.rcnet.com
      //#define FLYDU_ULTRA        // MEGA+10DOF+MT3339 FC
      //#define DIYFLYING_MAGE_V1  // diyflying 10DOF mega board with MPU6050 + HMC5883L + BMP085 http://www.indoor-flying.hk
      //#define MultiWii_32U4_SE         // Hextronik MultiWii_32U4_SE
      //#define MultiWii_32U4_SE_no_baro // Hextronik MultiWii_32U4_SE without the MS561101BA to free flash-memory for other functions
      //#define Flyduino9DOF       // Flyduino 9DOF IMU MPU6050+HMC5883l
      //#define Nano_Plane         // Multiwii Plane version with tail-front LSM330 sensor http://www.radiosait.ru/en/page_5324.html
			</pre>
			<p><br>Then I uploaded Multiwii to satshakit, here is the connection schema of this setup:</p>

			<img class="images-default" src="img/week11/complete_schema.jpg">

			<p>Here you can see some pictures about the complete drone setup:</p>
			<img class="images-default" src="img/week11/satshakit.jpg">
			<img class="images-default" src="img/week11/imu.jpg">
			<img class="images-default" src="img/week11/receiver.jpg">
			<img class="images-default" src="img/week11/complete_setup.jpg">

			<p>Finally I successfully managed to control all drone ESCs and read data from the IMU with the remote controller. This test demonstrates that I can <span class="redones">use satshakit as the starting point for my flight controller board</span>. Here you can see a video about:</p>

			<iframe width="700" height="450" src="https://www.youtube.com/embed/kZMLoyP47z4" frameborder="0" allowfullscreen></iframe>



			<p><br>As further experimentation, that regards also my final project, I tried to play with some <span class="redones">electromagnets</span>. In particular I wanted to test how eventually I could control them. I used two  of the following electromagnets:</p>

			<img class="images-default" src="img/week11/electormagnet.jpg">

			<p>So, for sure I cannot power the electromagnet from the satshakit, but I need an external power supply and a relais/transistor to switch them on and off. I ended up in using the following <span class="redones">relais</span>:</p>

			<img class="images-default" src="img/week11/relais.jpg">

			<p>Because of the relais I <span class="redones">alternated electromagnets on/off status</span>, so when an electromagnet is on, the other is off and viceversa. For this setup I simply used the blink Arduino demo sketch, with the pin 13 of the satshakit connected to the relais signal input. Also I used a  <span class="redones">satshakit power board</span>. Here is a photo about this setup:</p>

			<img class="images-default" src="img/week11/electromagnet_setup.jpg">

			<p>And here is a video while the magnetic blink it's working:</p>
			<iframe width="700" height="450" src="https://www.youtube.com/embed/xf46ZWN7ghI" frameborder="0" allowfullscreen></iframe>


			</div>
		</section>
		<section id= "week12" class="row">
			<div class="photo-grid">
				<p>Along this week week we've talked about <span class="redones">composites</span>.</p>

				<p>As composites exercise I was thinking about create a sort of <span class="redones">dome</span>. To obtain a medium size object, and without wasting so much material and time, I decided to create a composite by  covering a <span class="redones">pressfit kit</span>.</p>

				<p>First I started with the dome model. I drawn this model to be easily built with a pressfit kit. Here you can see the dome 3D model, made with <span class="redones">Rhino</span>:</p>
				<img class="images-default" src="img/week12/dome.jpg">

				<p>With the help of  <a href="http://www.123dapp.com/make"><span class="redones-link">123D Make</span></a> and with our laser cutting machine I cut the pressfit kit pieces. I chosen a sheet of <span class="redones">MDF</span> as base material. In the following picture you can see the dome pressfit kit pieces ready to be assembled:</p>
				<img class="images-default" src="img/week12/dome_pieces.jpg">
				<p>As support to recreate the dome model surfaces, I used one <span class="redones">female stocking</span>.</p>
				<img class="images-default" src="img/week12/stockings.jpg">
				<p>Its <span class="redones">elasticity</span> allows to avoid unwanted surfaces and to shape the object in a very similar way we can see in the rendered 3D model. Here is the dome pressfit kit assembled and with the female stoking applied:</p>
				<img class="images-default" src="img/week12/dome_stoockings.jpg">
				<p>As fabric to put inside the resin I tried to use some <span class="redones">mosquito net</span>: </p>
				<img class="images-default" src="img/week12/mosquito net.jpg">
				<p>So I mixed <span class="redones">epoxy resin and the hardner</span> with a proportion of <span class="redones">2:1</span>:</p>
				<img class="images-default" src="img/week12/resin.jpg">
				<p>Within this resin pot life, of about <span class="redones">40 minutes</span>, I spread the resin and mosquito net patches on the dome. Here is the dome just after this process:</p>
				<img class="images-default" src="img/week12/dome_after.jpg">
				<img class="images-default" src="img/week12/dome_after_up.jpg">
				<p>After about <span class="redones">24 hours</span> of waiting I applied also a second layer of resin and patches. After 48 hours here is the dome <span class="redones">final result</span>:</p>
				<img class="images-default" src="img/week12/dome_after_1.jpg">
				<img class="images-default" src="img/week12/dome_after_up_1.jpg">

				<p>Because I used only half of the MDF sheet I decided to make another composite object: a <span class="redones">simple boat</span>. So here it's the boat model I drawn:</p>
				<img class="images-default" src="img/week12/boat.jpg">
				<p>I followed almost the same process of before, with the exception of the fabric I used. This time I tried some large net material:</p>
				<img class="images-default" src="img/week12/large_net_material.jpg">
				<p>Here are the boat pressfit kit pieces before they get assembled:</p>
				<img class="images-default" src="img/week12/boat_pieces.jpg">
				<p>And here is the boat pressfit kit assembled and with the female stocking on it:</p>
				<img class="images-default" src="img/week12/boat_stockings.jpg">
				<img class="images-default" src="img/week12/boat_stockings1.jpg">
				<p>Unfortunately I wasn't able to use this kind of material with our resin, because it's <span class="redones">pre-plastified</span> and resin cannot catch it efficiently. So I backed up with the mosquito net to avoid wasting the resin I've already mixed.</p>
				
				<p>Here you can see the photos about simple<span class="redones"> boat final result</span>:</p>
				<img class="images-default" src="img/week12/boat_after_1.jpg">
				<img class="images-default" src="img/week12/boat_after_2.jpg">
				<img class="images-default" src="img/week12/boat_after_3.jpg">
				<img class="images-default" src="img/week12/boat_after_4.jpg">

				<p>As accidental experimentation, and due to the fact I dropped some resin on a piece of <span class="redones">polystyrene</span> I discovered that this material significantly changes its <span class="redones">strength</span> and <span class="redones">flexibility</span> after a layer or resin solidify on it. Here you can see the of polystyrene on which I dropped the resin, after the resin was solidified:</p>

				<img class="images-default" src="img/week12/polystyrene.jpg">

				<p>And here you can see my hand while trying (with no result) to break it:</p>
				<img class="images-default" src="img/week12/polystyrene_bent.jpg">

				<p>Here you can download the 3D models I drawn for this week: <a href="drawings/week12/boat.3dm.rar"><span class="redones-link">boat</span></a>
					<a href="drawings/week12/dome.3dm.rar">, <span class="redones-link">dome</span></a>.</p>

			</div>
		</section>
		<section id= "week13" class="row">
			<div class="photo-grid">
				<p>This week we've dealt with <span class="redones">networking and communications</span></p>

				<p>As first experiment with MCU communication, I tried <span class="redones">I2C</span> with two satshakit. The setup was simple, as you can see in the following picture:</p>
				<img class="images-default" src="img/week13/satshakit_i2c.jpg">
				<p>Also, to do a quick test, I used sketches described in the <a href="http://www.arduino.cc/en/Tutorial/MasterReader"><span class="redones-link">Arduino I2C MasterReader tutorial</span></a>. Here you can see a video about this:</p>
				<iframe width="700" height="450" src="https://www.youtube.com/embed/9XcrL3Ypu_s" frameborder="0" allowfullscreen></iframe>

				<p><br>After this simple test was successful, I decided to implement a full <span class="redones">Internet of Things</span> system. Within this, I developed also some improvements to the satshakit board. These improvements regards the realization of a <span class="redones">modular, multicore, satshakit system</span>. Also, in order to supply power to multiple satshakit and additional communication devices, I developed a <span class="redones">satshakit power board</span>. Starting from satshakit power board, I needed to get 5V and 3.3V from an input voltage of 7-12V, and to have available multiple VCCs and GNDs. From these considerations born the power board:</p>

				<img class="images-default" src="img/week13/power_board_sch.jpeg">
				<img class="images-default" src="img/week13/power_board_board.jpeg">

				<p>I designed this board taking into consideration the components I had available: SMD 10uF capacitors, through-hole L7085CV and UA78M33C voltage regulators. Here you can see a picture about a soldered satshakit power board:</p>

				<img class="images-default" src="img/week13/power_board.jpg">

				<p>As MCU communication between the satshakit modular boards, and due to the previous test, I chose to use I2C. Satshakit modular boards have only the following <span class="redones">modifications</span> in confront of the standard satshakit: <span class="redones">4 extra pin header (1 GND,1 VCC,1 A4, 1 A5)</span>. Here you can see the a picture of the modular satshakit board:</p>

				<img class="images-default" src="img/week13/satshakit_modular_board.jpeg">

				<p>To make this modular version, I used <span class="redones">dual layer fiber glass FR4</span> sheets. The key was to center the 4 extra pin header along Y of the Eagle board. Here you can see a dual layer board ready to be soldered: </p>

				<img class="images-default" src="img/week13/satshakit_dl_modular.jpg">

				<p>The experiment to make this <span class="redones">modular and multicore satshakit board was successful</span>, as you can see in the following videos:</p>

				<iframe width="700" height="450" src="https://www.youtube.com/embed/bxnmX-B9Czo" frameborder="0" allowfullscreen></iframe>

				<iframe width="700" height="450" src="https://www.youtube.com/embed/fPvHaHXurHE" frameborder="0" allowfullscreen></iframe>

				<iframe width="700" height="450" src="https://www.youtube.com/embed/nVHYBydPKpk" frameborder="0" allowfullscreen></iframe>

				<p>At this point I was ready to build an <span class="redones">satshakit IoT module</span>. An satshakit IoT module consist of a satshakit (normal or modular version), a satshakit power board, a <span class="redones">ESP8266 WiFi</span> module and a PIR sensor. The objective of the IoT system is to send to a smart system, data about of human presence detected by a distributed set of sensors. Here you can see some pictures about the first IoT module prototype:</p>
			
				<img class="images-default" src="img/week13/iot_module_caliper.jpg">
				<img class="images-default" src="img/week13/iot_module_hand1.jpg">
				<img class="images-default" src="img/week13/iot_module_hand2.jpg">
				
				<p>Before implementing the software for the full IoT system, I made the following schema to have a clear starting point:</p>

				<img class="images-default" src="img/week13/Iot_system.jpg">
				
				<p>Where <a href="http://practionist.eng.it/"><span class="redones-link">PRACTIcal reasONIng sySTem</span></a> is a suite of tools supporting the design and development of distributed complex systems based on the BDI model of agency. The framework provides each system component with necessary tools to interact with the environment where it lives, including cognitive capacities upon the environment and execution of actions. I'm one of the active developer of PRACTIONIST. Data received from PRACTIONIST is stored and retrieved in <span class="redones">PROLOG</span> like <span class="redones">Belief Base</span>. Here you can see two simple PRACTIONIST Prolog Like rules wrote on purpose for this IoT system:</p>

				<pre class="prettyprint lang-c">
bel(self, empty(status: A)) &lt= owner_inside(value: A)
and presence(where: main,value: A)
and presence(where: bathroom,value: A)
and presence(where: kitchen,value: A)
and presence(where: corridor,value: A)
and presence(where: entrance,value: A).
			  
bel(self, alarm(status: A, owner: B)) &lt= owner_inside(value: B) 
and ( presence(where: main,value: A) 
or presence(where: bathroom,value: A)
or presence(where: kitchen,value: A) 
or presence(where: corridor,value: A) 
or presence(where: entrance,value: A) ).
				</pre>

				<p>Also, here is the code of the PRACTIONIST plans that update the Belief Base and retrieve data for an exposed REST web service:</p>	

				<pre class="prettyprint lang-c">

/**
 * Copyright (C) 2013 Engineering Ingegneria Informatica S.p.A.
 * Research & Development Laboratory
 *
 * Licensed under the GNU LESSER GENERAL PUBLIC LICENSE, 
 * Version 3 (the "License"); you may not use this file except 
 * in compliance with the License. You may obtain a copy of the 
 * License at http://www.gnu.org/licenses/lgpl.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @author Daniele Ingrassia Company: Engineering Ingegneria Informatica S.p.A
 *         E-mail: daniele.ingrassia@eng.it
*/
package rs.fabacademy.reasoning_agent.plan.utility;

import jade.content.abs.AbsPredicate;

import java.util.HashMap;

import org.practionist.container.message.PractionistBusinessMessage;
import org.practionist.plan.library.BusinessMessageReceiverPlan;

import rs.fabacademy.RSConstants;
import rs.fabacademy.TRACE;
import rs.service.ServiceConstants;

public class UpdateDataBMPlan extends BusinessMessageReceiverPlan
{

	/*
	 * (non-Javadoc)
	 * 
	 * @see org.practionist.plan.GoalPlan#practical(org.practionist.core.Goal)
	 */
	@Override
	protected boolean practical(PractionistBusinessMessage businessMessage)
	{

		if (businessMessage.getOperation() == RSConstants.NOTIFICATION_OPERATION_UPDATE_DATA)
			return true;

		return false;
	}

	@Override
	protected void body()
	{

		TRACE.info("start");
		long time1 = System.nanoTime(), time2;

		AbsPredicate bufferBelief,bufferBelief1,templateBelief;
		
		HashMap&ltString, String&gt notificationData = (HashMap&ltString, String&gt) msg.getContent().get(0);
		String presenceData;
		String updateData = notificationData.get(ServiceConstants.PARAMETER_UPDATE_DATA);
		String updateKind = notificationData.get(ServiceConstants.PARAMETER_UPDATE_KIND);
		
		TRACE.info("updateData: "+updateData);
		TRACE.info("updateKind: "+updateKind);
		
		if(updateKind.startsWith(RSConstants.UPDATE_KIND_PRESENCE)){

			//extract presence data
			presenceData = updateKind.split("_")[1];
			
			try {
				
				templateBelief = new AbsPredicate(RSConstants.BELIEF_PRESENCE_HEAD);
				templateBelief.set("where",presenceData);
				remove(templateBelief);
				
				bufferBelief = new AbsPredicate(RSConstants.BELIEF_PRESENCE_HEAD);
				bufferBelief.set("where",presenceData);
				bufferBelief.set("value",updateData);
				add(bufferBelief);
				
			} catch (Exception e) {
				
				e.printStackTrace();
				TRACE.info("error predicates UPDATE_KIND_PRESENCE");
			
			}
			
		}else
		if(updateKind.equals(RSConstants.UPDATE_KIND_DOOR)){
			
			try{
			
				templateBelief = new AbsPredicate(RSConstants.BELIEF_DOOR_HEAD);
				templateBelief.set("value", "open");
				remove(templateBelief);
				
				templateBelief = new AbsPredicate(RSConstants.BELIEF_DOOR_HEAD);
				templateBelief.set("value", "close");
				remove(templateBelief);
			
				bufferBelief = new AbsPredicate(RSConstants.BELIEF_DOOR_HEAD);
				bufferBelief.set("value",updateData);
				add(bufferBelief);
			
			} catch (Exception e) {
			
				e.printStackTrace();
				TRACE.info("error predicates UPDATE_KIND_DOOR");
		
			}
			
		}else
		if(updateKind.equals(RSConstants.UPDATE_KIND_DOOR_PRESENCE)){
				
			try{
				
				templateBelief = new AbsPredicate(RSConstants.BELIEF_DOOR_PRESENCE_HEAD);
				templateBelief.set("value","true");
				remove(templateBelief);
				
				templateBelief = new AbsPredicate(RSConstants.BELIEF_DOOR_PRESENCE_HEAD);
				templateBelief.set("value","false");
				remove(templateBelief);
			
				bufferBelief = new AbsPredicate(RSConstants.BELIEF_DOOR_PRESENCE_HEAD);
				bufferBelief.set("value",updateData);
				add(bufferBelief);
			
			} catch (Exception e) {
			
				e.printStackTrace();
				TRACE.info("error predicates UPDATE_KIND_DOOR_PRESENCE");
		
			}
				
		}else	
		if(updateKind.equals(RSConstants.UPDATE_KIND_OWNER_INSIDE)){
				
			try{
				
				templateBelief = new AbsPredicate(RSConstants.BELIEF_OWNER_INSIDE_HEAD);
				templateBelief.set("value","true");
				remove(templateBelief);
				
				templateBelief = new AbsPredicate(RSConstants.BELIEF_OWNER_INSIDE_HEAD);
				templateBelief.set("value","false");
				remove(templateBelief);
			
				bufferBelief = new AbsPredicate(RSConstants.BELIEF_OWNER_INSIDE_HEAD);
				bufferBelief.set("value",updateData);
				add(bufferBelief);
			
			} catch (Exception e) {
			
				e.printStackTrace();
				TRACE.info("error predicates UPDATE_KIND_OWNER_INSIDE");
		
			}
				
		}	

		time2 = System.nanoTime() - time1;
		TRACE.info(time2 + "");
		TRACE.info("end");

		setSucceed();

	}

}
				</pre>

				
				<pre class="prettyprint lang-c">
				
/**
 * Copyright (C) 2013 Engineering Ingegneria Informatica S.p.A.
 * Research & Development Laboratory
 *
 * Licensed under the GNU LESSER GENERAL PUBLIC LICENSE, 
 * Version 3 (the "License"); you may not use this file except 
 * in compliance with the License. You may obtain a copy of the 
 * License at http://www.gnu.org/licenses/lgpl.txt
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @author Daniele Ingrassia Company: Engineering Ingegneria Informatica S.p.A
 *         E-mail: daniele.ingrassia@eng.it
*/
package rs.fabacademy.reasoning_agent.plan.utility;

import jade.content.abs.AbsPredicate;

import java.util.HashMap;

import org.practionist.belief.AbsPredicateFactory;
import org.practionist.container.message.PractionistBusinessMessage;
import org.practionist.plan.PlanExecutionException;
import org.practionist.plan.library.BusinessMessageReceiverPlan;

import rs.fabacademy.RSConstants;
import rs.fabacademy.TRACE;
import rs.service.AbsPredicateObject;
import rs.service.Alarm;
import rs.service.Empty;
import rs.service.ServiceConstants;

import com.google.gson.Gson;

public class GetDataBMPlan extends BusinessMessageReceiverPlan
{

	/*
	 * (non-Javadoc)
	 * 
	 * @see org.practionist.plan.GoalPlan#practical(org.practionist.core.Goal)
	 */
	@Override
	protected boolean practical(PractionistBusinessMessage businessMessage)
	{

		if (businessMessage.getOperation() == RSConstants.NOTIFICATION_OPERATION_GET_DATA)
			return true;

		return false;
	}

	@Override
	protected void body()
	{

		TRACE.info("start");
		long time1 = System.nanoTime(), time2;

		Alarm alarm = new Alarm();
		Empty empty = new Empty();
		
		AbsPredicate bufferBelief,bufferBeliefs[];
		Gson bufferGson = new Gson();
		
		HashMap&ltString, String&gt notificationData = (HashMap&ltString, String&gt) msg.getContent().get(0);
		String dataKind = notificationData.get(ServiceConstants.PARAMETER_GET_DATA_KIND);

		if(dataKind.equals("empty")){
			
		bufferBelief = AbsPredicateFactory.create(RSConstants.BELIEF_EMPTY.replace("A", "false"));
									
			try {
				
				bufferBeliefs = retrieveAllAbsPredicates(bufferBelief,true);
				
				if(bufferBeliefs == null){
					
					TRACE.info("NOT EMPTY");
					
					empty.empty = "false";
					
					RSConstants.PRACTIONIST_RESPONSE.add(empty);
					
				}else{
					
					TRACE.info("EMPTY");
					
					empty.empty = "true";
					
					RSConstants.PRACTIONIST_RESPONSE.add(empty);
					
				}
				
			} catch (PlanExecutionException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
				
				RSConstants.PRACTIONIST_RESPONSE.add("Belief base error");
				
			}	
			
			
			
		}else
		if(dataKind.equals("alarm")){
				
			bufferBelief = AbsPredicateFactory.create(RSConstants.BELIEF_ALARM.replace("A", "true").replace("B", "false"));
											
				try {
						
					bufferBeliefs = retrieveAllAbsPredicates(bufferBelief,true);
						
					if(bufferBeliefs != null){
							
						TRACE.info("ALARM true");
						
						alarm.alarm = "true";
						
						RSConstants.PRACTIONIST_RESPONSE.add(alarm);
							
					}else{
							
						TRACE.info("ALARM false");
						alarm.alarm = "false";
						RSConstants.PRACTIONIST_RESPONSE.add(alarm);
							
					}
						
				} catch (PlanExecutionException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
						
					RSConstants.PRACTIONIST_RESPONSE.add("Belief base error");
						
				}	
					
					
					
		}else
		if(dataKind.equals("all")){
			
			Object AllPredicates[] = getBeliefBase().all().toArray();
			AbsPredicateObject APOS[] = new AbsPredicateObject[AllPredicates.length];	
				
			for(int C=0;C&ltAllPredicates.length;C++){

			System.out.println("Predicate "+C+": "+AllPredicates[C].toString());
			
			APOS[C] = new AbsPredicateObject("");
			APOS[C].fromAbsPredicate((AbsPredicate)AllPredicates[C]);
			
			}
			
			RSConstants.PRACTIONIST_RESPONSE.add(APOS);
			
		}else
			RSConstants.PRACTIONIST_RESPONSE.add("invalid data kind");

		
		
		
		
		//retrieveAbsPredicate(AbsPredicateFactory.create());

		time2 = System.nanoTime() - time1;
		TRACE.info(time2 + "");
		TRACE.info("end");

		setSucceed();

	}

}


				</pre>

				<p><a href="http://eclipse.org/jetty/"><span class="redones-link">Jetty webserver</span></a> was launched on my notebook, in order to be used as <span class="redones">gateaway</span>. IoT modules are able to make an HTTP GET request to Jetty web server with the following sketch:</p>

				<pre class="prettyprint lang-c">


    #include &ltSoftwareSerial.h&gt
    #define DEBUG false
    
    SoftwareSerial mySerial(9,10);
    
    String cipSend,startConnection,domain,port,getRequest,path,parameters;
    boolean presence,bufferPresence;
    
    void setup(){
      
      Wire.begin();
      
      pinMode(2,INPUT);
      pinMode(13,OUTPUT);
      
      presence = false;
      bufferPresence = false;
          
      Serial.begin(9600); 
      
      if(DEBUG)
        mySerial.begin(9600); 

      domain = "192.168.1.90";
      path="";
      parameters="";
      port = "8080";

      sendData("AT+RST\r\n",5000,DEBUG);
      sendData("AT+CWMODE=1\r\n",5000,DEBUG);
      sendData("AT+CWJAP=\"opendot\",\"xxxx\"\r\n",30000,DEBUG);
            
      if(DEBUG)      
        mySerial.println("end setup");
      
    }
    
    void loop(){
          
      if(digitalRead(2))
        bufferPresence = true;
      else
        bufferPresence = false;
        
      if(bufferPresence != presence){
      
        presence = bufferPresence;
        
       if(DEBUG)  
        mySerial.println("presence changed");
        
        if(presence){
          parameters = "?presence5=true";
          digitalWrite(13, HIGH);
        }else{
          parameters = "?presence5=false";
          digitalWrite(13, LOW);  
        }     
                
        startConnection = "AT+CIPSTART=\"TCP\",\"" + domain + "\","+port+"\r\n";
        sendData(startConnection,5000,DEBUG);
      
        getRequest = "GET /"+parameters+" HTTP/1.1\r\nHost:"+domain+":"+port+"\r\n\r\n";
      
        cipSend = "AT+CIPSEND=";
        cipSend += getRequest.length();
        cipSend += "\r\n";
      
        sendData(cipSend,5000,DEBUG);     
        sendData(getRequest,5000,DEBUG);
      
        delay(30000);
      
        sendData("AT+CIPCLOSE\r\n",5000,DEBUG);
      
        delay(5000);    
          
      }else{
        if(DEBUG) 
          mySerial.print("presence not changed");
      }
      delay(1000);
      
      
    }
   
   
    String sendData(String command, const int timeout, boolean debug){
      
      String response = "";
      
      Serial.print(command);
      mySerial.print("Command: "+command);
      
      long int time = millis();
      
      while((time+timeout) > millis()){
        
        while(Serial.available()){
          
          char c = Serial.read(); 
          response+=c;
        
        }  
      }
      
      if(debug){
       
        mySerial.print("response: "); 
        mySerial.print(response);
      }
      
      return response;
    
  }

				</pre>

				<p><br>To be noted that every module has its own specific URL parameter. Also, the gateaway enrich these parameters with better identifiers. This because the gateaway know where the IoT module are. Here you can see the principal java class implementing the Jetty web server:</p>

				<pre class="prettyprint lang-c">

package rs.service;



import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.eclipse.jetty.server.Request;
import org.eclipse.jetty.server.handler.AbstractHandler;

import rs.fabacademy.RestClient;
import rs.fabacademy.RestClient.RequestMethod;

import com.google.gson.Gson;
 
public class HttpRequestHandler extends AbstractHandler {

	private Gson bufferGson;
	private Response bufferResponse;
	private String parameter,requestUrl;
	private RestClient restClient;
	
	public HttpRequestHandler(){
		
		bufferGson = new Gson();
		bufferResponse = new Response();
				
	}
	
	@Override
    public void handle(String target, Request baseRequest, HttpServletRequest request, 
    HttpServletResponse response) throws IOException, ServletException {
    		
    	response.setContentType("application/json;charset=utf-8");
        response.setStatus(HttpServletResponse.SC_OK);
        baseRequest.setHandled(true);
        bufferResponse.reset();
    	
    	System.out.println("Parameters received-> " + request.getParameterMap().toString());
    	
    	requestUrl = "http://"+ServiceConstants.PRACTIONIST_HOST+":"
    	+ServiceConstants.PRACTIONIST_PORT+ServiceConstants.PRACTIONIST_PATH;

		if(target.equals("/")){ 
			
			if( 
			(parameter = request.getParameter(ServiceConstants.PARAMETER_PRESENCE_1)) 
			!= null){
				
				bufferResponse.
				setStatus(ServiceConstants.PARAMETER_PRESENCE_1+": "+parameter);
				
				requestUrl += "?";
				requestUrl += 
				ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_KIND+"=presence_main";
				requestUrl += "&";
				requestUrl += 
				ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_DATA+"="+parameter;
				
				restClient = new RestClient(requestUrl);
				
				try
				{
	
					restClient.execute(RequestMethod.GET);
	
				}
				catch (Exception e)
				{
	
					e.printStackTrace();
				}
				
			}else
			if( 
			(parameter = request.getParameter(ServiceConstants.PARAMETER_PRESENCE_2)) 
			!= null){
					
				bufferResponse.
				setStatus(ServiceConstants.PARAMETER_PRESENCE_2+": "+parameter);
				
				requestUrl += "?";
				requestUrl += 
				ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_KIND+"=presence_bathroom";
				requestUrl += "&";
				requestUrl += 
				ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_DATA+"="+parameter;
				
				restClient = new RestClient(requestUrl);
				
				try
				{
	
					restClient.execute(RequestMethod.GET);
	
				}
				catch (Exception e)
				{
	
					e.printStackTrace();
				}
					
			}else
			if( 
			(parameter = request.getParameter(ServiceConstants.PARAMETER_PRESENCE_3)) 
			!= null){
					
				bufferResponse.
				setStatus(ServiceConstants.PARAMETER_PRESENCE_3+": "+parameter);
				
				requestUrl += "?";
				requestUrl += 
				ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_KIND+"=presence_kitchen";
				requestUrl += "&";
				requestUrl += 
				ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_DATA+"="+parameter;
				
				restClient = new RestClient(requestUrl);
				
				try
				{
	
					restClient.execute(RequestMethod.GET);
	
				}
				catch (Exception e)
				{
	
					e.printStackTrace();
				}
						
			}else
			if( 
			(parameter = request.getParameter(ServiceConstants.PARAMETER_PRESENCE_4)) 
			!= null){
					
					bufferResponse.
					setStatus(ServiceConstants.PARAMETER_PRESENCE_4+": "+parameter);
					
					requestUrl += "?";
					requestUrl += 
					ServiceConstants.
					PRACTIONIST_PARAMETER_UPDATE_KIND+"=presence_corridor";
					requestUrl += "&";
					requestUrl += 
					ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_DATA+"="+parameter;
					
					restClient = new RestClient(requestUrl);
					
					try
					{
		
						restClient.execute(RequestMethod.GET);
		
					}
					catch (Exception e)
					{
		
						e.printStackTrace();
					}
							
			}else
			if( 
			(parameter = request.getParameter(ServiceConstants.PARAMETER_PRESENCE_5)) 
			!= null){
				
				requestUrl += "?";
				requestUrl += 
				ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_KIND+"=presence_entrance";
				requestUrl += "&";
				requestUrl += 
				ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_DATA+"="+parameter;
				
				restClient = new RestClient(requestUrl);
				
				try
				{
	
					restClient.execute(RequestMethod.GET);
	
				}
				catch (Exception e)
				{
	
					e.printStackTrace();
				}
					
					bufferResponse.
					setStatus(ServiceConstants.PARAMETER_PRESENCE_5+": "+parameter);
							
			}else
			if( 
			(parameter = request.getParameter(ServiceConstants.PARAMETER_DOOR)) 
			!= null){
					
					bufferResponse.
					setStatus(ServiceConstants.PARAMETER_DOOR+": "+parameter);
					
					requestUrl += "?";
					requestUrl += 
					ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_KIND+"=door";
					requestUrl += "&";
					requestUrl += 
					ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_DATA+"="+parameter;
					
					restClient = new RestClient(requestUrl);
					
					try
					{
		
						restClient.execute(RequestMethod.GET);
		
					}
					catch (Exception e)
					{
		
						e.printStackTrace();
					}
					
							
			}else	
			if( 
			(parameter = request.getParameter(ServiceConstants.PARAMETER_DOOR_PRESENCE)) 
			!= null){
					
					bufferResponse.
					setStatus(ServiceConstants.PARAMETER_DOOR_PRESENCE+": "+parameter);
					
					requestUrl += "?";
					requestUrl += 
					ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_KIND+"=doorPresence";
					requestUrl += "&";
					requestUrl += 
					ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_DATA+"="+parameter;
					
					restClient = new RestClient(requestUrl);
					
					try
					{
		
						restClient.execute(RequestMethod.GET);
		
					}
					catch (Exception e)
					{
		
						e.printStackTrace();
					}
							
			}else
			if( 
			(parameter = request.getParameter(ServiceConstants.PARAMETER_OWNER_INSIDE)) 
			!= null){
					
					bufferResponse.
					setStatus(ServiceConstants.PARAMETER_OWNER_INSIDE+": "+parameter);
					
					requestUrl += "?";
					requestUrl += 
					ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_KIND+"=ownerInside";
					requestUrl += "&";
					requestUrl += 
					ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_DATA+"="+parameter;
					
					restClient = new RestClient(requestUrl);
					
					try
					{
		
						restClient.execute(RequestMethod.GET);
		
					}
					catch (Exception e)
					{
		
						e.printStackTrace();
					}
							
			}else	
				bufferResponse.setError("invalid parameters");	       
			
		}else
			bufferResponse.setError("invalid path");

	
		 response.getWriter().
		 println(bufferGson.toJson(bufferResponse).replace("\\\"", "\""));
		
    }
 
}
				</pre>

				<p>Here you can see all the modules powered on and ready to be used:</p>
				<img class="images-default" src="img/week13/iot_modules.jpg">
				
				<p>I made also a multicore satshakit IoT module, in which a satshakit act as a master and reads the PIR sensor value from a slave one:</p>

				<img class="images-default" src="img/week13/multicore_iot.jpg">
				
				<p>Here you can see the sketch I used on the master of this IoT module:</p>

				<pre class="prettyprint lang-c">

    #include &ltSoftwareSerial.h&gt
    #include &ltWire.h&gt
    #define DEBUG true
    
    SoftwareSerial mySerial(9,10);
    
    String cipSend,startConnection,domain,port,getRequest,path,parameters;
    boolean presence,bufferPresence;
    char fromSlave;
    
    void setup(){
      
      Wire.begin();
      
      pinMode(13,OUTPUT);
      
      presence = false;
      bufferPresence = false;
          
      Serial.begin(9600); 
      
      if(DEBUG)
        mySerial.begin(9600); 

      domain = "192.168.1.90";
      path="";
      parameters="";
      port = "8080";

      sendData("AT+RST\r\n",5000,DEBUG);
      sendData("AT+CWMODE=1\r\n",5000,DEBUG);
      sendData("AT+CWJAP=\"opendot\",\"xxxxxx\"\r\n",30000,DEBUG);
            
      if(DEBUG)      
        mySerial.println("end setup");
      
    }
    
    void loop(){
      
      fromSlave = 'a';
      
      Wire.requestFrom(2, 6);
      
      if(Wire.available()){
      
        fromSlave = Wire.read();
        
      }
      
      if(fromSlave != 'a')
        bufferPresence = true;
      else
        bufferPresence = false;
        
      if(bufferPresence != presence){
      
        presence = bufferPresence;
        
       if(DEBUG)  
        mySerial.println("presence changed");
        
        if(presence){
          parameters = "?presence5=true";
          digitalWrite(13, HIGH);
        }else{
          parameters = "?presence5=false";
          digitalWrite(13, LOW);  
        }     
                
        startConnection = "AT+CIPSTART=\"TCP\",\"" + domain + "\","+port+"\r\n";
        sendData(startConnection,5000,DEBUG);
      
        getRequest = "GET /"+parameters+" HTTP/1.1\r\nHost:"+domain+":"+port+"\r\n\r\n";
      
        cipSend = "AT+CIPSEND=";
        cipSend += getRequest.length();
        cipSend += "\r\n";
      
        sendData(cipSend,5000,DEBUG);     
        sendData(getRequest,5000,DEBUG);
      
        delay(30000);
      
        sendData("AT+CIPCLOSE\r\n",5000,DEBUG);
      
        delay(5000);    
          
      }else{
        if(DEBUG) 
          mySerial.print("presence not changed");
      }
      delay(1000);
      
      
    }
   
   
    String sendData(String command, const int timeout, boolean debug){
      
      String response = "";
      
      Serial.print(command);
      mySerial.print("Command: "+command);
      
      long int time = millis();
      
      while((time+timeout) > millis()){
        
        while(Serial.available()){
          
          char c = Serial.read(); 
          response+=c;
        
        }  
      }
      
      if(debug){
       
        mySerial.print("response: "); 
        mySerial.print(response);
      }
      
      return response;
    
  }

				</pre>
				<p>And here is the code I uploaded on the slave satshakit in order to send sensor data to master:</p>

				<pre class="prettyprint lang-c">
#include &ltWire.h&gt

char toMaster;

void setup()
{
  Wire.begin(2);                
  Wire.onRequest(requestEvent); 
  pinMode(2,INPUT);
  
  toMaster = 'b';

}

void loop()
{
  
  delay(100);
}

void requestEvent()
{
  
  if(digitalRead(2))
     Wire.write('b');
   else 
     Wire.write('a');
                       
}
				</pre>

				<p>Here is a video where you can see the satshakit yellow led powered by my presence while I was getting near the sensor:</p>

				<iframe width="700" height="450" src="https://www.youtube.com/embed/5-wfTvfO6ss" frameborder="0" allowfullscreen></iframe>

				<p>Finally here is the <span class = "redones">final and complete test of the IoT system</span>. Due to a weak WiFi not all modules were able to quickly communicate with gateaway and server: </p>
				<iframe width="700" height="450" src="https://www.youtube.com/embed/gabnJ0VTCmk" frameborder="0" allowfullscreen></iframe>

				<p>After a while other GET requests were coming...</p>

				<img class="images-default" src="img/week13/calls.jpg">

				<p>Here you can see the <span class = "redones">json output</span> of the PRACTIONIST REST web service. Data is updated in realtime while is perceived by satshakit IoT modules.</p>

				<pre class="prettyprint lang-c">
[
   {
      "kind":"door",
      "parameters":[
         "value"
      ],
      "values":[
         "close"
      ]
   },
   {
      "kind":"door_presence",
      "parameters":[
         "value"
      ],
      "values":[
         "false"
      ]
   },
   {
      "kind":"owner_inside",
      "parameters":[
         "value"
      ],
      "values":[
         "false"
      ]
   },
   {
      "kind":"presence",
      "parameters":[
         "where",
         "value"
      ],
      "values":[
         "corridor",
         "false"
      ]
   },
   {
      "kind":"presence",
      "parameters":[
         "where",
         "value"
      ],
      "values":[
         "main",
         "true"
      ]
   },
   {
      "kind":"presence",
      "parameters":[
         "where",
         "value"
      ],
      "values":[
         "bathroom",
         "true"
      ]
   },
   {
      "kind":"presence",
      "parameters":[
         "where",
         "value"
      ],
      "values":[
         "entrance",
         "false"
      ]
   },
   {
      "kind":"presence",
      "parameters":[
         "where",
         "value"
      ],
      "values":[
         "kitchen",
         "true"
      ]
   }
]
				</pre>

				<p><br>Here you can download Eagle projects of <a href="drawings/week13/eagle_satshakit_modular.zip"><span class="redones-link">satshakit multicore & modular</span></a> and <a href="drawings/week13/eagle_satshakit_power_board.zip"><span class="redones-link">satshakit power board</span></a>.</p>
				<p>Also, here you can download code I wrote for this assignment: <a href="other/IoTGateaway.rar"><span class="redones-link">IoTGateaway</span></a>, <a href="other/PRACTIONIST_FabAcademy.rar"><span class="redones-link">PRACTIONIST_FabAcademy</span></a></p>

			</div>
		</section>
		<section id= "week14" class="row">
			<div class="photo-grid">
				<p>Along this week, we've learned about <span class="redones">interface and application programming</span></p>
				<p>What I wanted to do for this week, was to improve the Internet of Things system I developed along the previous week13. This time with the objective of implement a <span class="redones">web gui</span> and to do some simple <span class="redones">data analysis</span>. Also, another improvement I desired, was to detect if a <span class="redones">specific person</span> (eg: the owner) is inside the environment where the IoT system is. In order to recognize this presence I was thinking about an <span class="redones">Android application</span> that can detect if it's inside an environment via a WiFi network.</p>

				<p>First, I modified the IoT schema as follows:</p>
				<img class="images-default" src="img/week14/iot_system_new.jpg">
				<p>As you can see this time there is also an Android smartphone. This smartphone can connect via local WiFi in order to recognize if it's inside a specific environment, and also connect via mobile internet to the remote <a href="http://practionist.eng.it/index.htm"><span class="redones-link">PRACTIcal reasONIng sySTem</span></a> (see week13 for more details).</p>
				<p>The idea behind how to recognize the owner presence is to develop an Android application that continuously probe for a fixed WiFi <span class="redones">SSID name</span>. If the SSID name is found, the app will try to connect to this WiFi network, and then will make an <span class="redones">HTTP GET request to check if in the response there is the password</span>. If the password match, the app will made another HTTP GET request to remote PRACTIONIST, in order to set it's presence to true. Otherwise, if there isn't the SSID name in the WiFi detected networks, or the password doesn't match, it will made an HTTP GET request to set it's presence to false.</p>
				<p>To implement the aforementioned behaviour, I wrote the followind Android Broadcast Receiver:</p>
				<pre class="prettyprint lang-c">
    class MyBroadcastReceiver extends BroadcastReceiver{
    	
    	public void updateOwnerPresence(){
    		
    		String ownerInside = 
    			"http://satsha.sytes.net:8080/updateData?updateKind=ownerInside&updateData=true";
    		String ownerOutside = 
    			"http://satsha.sytes.net:8080/updateData?updateKind=ownerInside&updateData=false";
    		
    		RestClient restClientPRACTIONIST; 
			RestClient restClient = new RestClient("http://10.10.10.99:8084/recognize");
			
			try{
				
				restClient.execute(RequestMethod.GET);
				
				Log.v("test",restClient.getResponse());
				
				if(restClient.getResponse().startsWith("satshakitIoT")){
					
					Log.v("test","inside");
					
					restClientPRACTIONIST = new RestClient(ownerInside);
					restClientPRACTIONIST.execute(RequestMethod.GET);
					
				}else{
					
					restClientPRACTIONIST = new RestClient(ownerOutside);
					restClientPRACTIONIST.execute(RequestMethod.GET);
					
					Log.v("test","outside");
					
				}

			}catch (Exception e){

				e.printStackTrace();
				
				restClientPRACTIONIST = new RestClient(ownerOutside);
				
				try {
					
					restClientPRACTIONIST.execute(RequestMethod.GET);
				
				}catch (Exception e1) {
					
					e1.printStackTrace();
				
				}
				
			}
    		
    	}
    	
        public void onReceive(Context c, Intent intent){
        	
        	WifiManager wifiManager = (WifiManager) c.getSystemService(Context.WIFI_SERVICE);
        	WifiInfo wifiInfo = wifiManager.getConnectionInfo();
        	if (WifiInfo.getDetailedStateOf(wifiInfo.getSupplicantState()) 
        		== NetworkInfo.DetailedState.CONNECTED) {
        		
        		Log.v("test",wifiInfo.getSSID());
        		
        		if(wifiInfo.getSSID().equals(mySSID)){
        			
        			Log.v("test","already conn");
        			updateOwnerPresence();
        			
        		}else{
        			
                	WifiConfiguration conf = new WifiConfiguration();
        	    	conf.SSID = "\"" + mySSID + "\""; 
        	    	conf.allowedKeyManagement.set(WifiConfiguration.KeyMgmt.NONE);
        	    	
        	    	wifiManager = (WifiManager)getSystemService(Context.WIFI_SERVICE); 
        	    	wifiManager.addNetwork(conf);
        	    	
        	    	List&ltWifiConfiguration&gt list = wifiManager.getConfiguredNetworks();
        	    	for( WifiConfiguration i : list ) {
        	    	    if(i.SSID != null && i.SSID.equals("\"" + mySSID + "\"")) {
        	    	         //wifiManager.disconnect();
        	    	         wifiManager.enableNetwork(i.networkId, true);
        	    	         wifiManager.reconnect();               
        	
        	    	         break;
        	    	         
        	    	    }           
        	    	 }
        			
        	    	updateOwnerPresence();
        	    	
        		}
        	   
        	}else{
        			
    	    	WifiConfiguration conf = new WifiConfiguration();
    	    	conf.SSID = "\"" + mySSID + "\""; 
    	    	conf.allowedKeyManagement.set(WifiConfiguration.KeyMgmt.NONE);
    	    	
    	    	wifiManager = (WifiManager)getSystemService(Context.WIFI_SERVICE); 
    	    	wifiManager.addNetwork(conf);
    	    	
    	    	List&ltWifiConfiguration&gt list = wifiManager.getConfiguredNetworks();
    	    	for( WifiConfiguration i : list ) {
    	    	    if(i.SSID != null && i.SSID.equals("\"" + mySSID + "\"")) {
    	    	         //wifiManager.disconnect();
    	    	         wifiManager.enableNetwork(i.networkId, true);
    	    	         wifiManager.reconnect();               
    	
    	    	         break;
    	    	    }           
    	    	 }
    			
    	    	updateOwnerPresence();
        		
        	}

        }
        
    }
				</pre>
				<p>This time I tried this IoT system inside my <span class="redones">residence room</span> (where I live actually here in Milan). My residence room only has three rooms: <span class="redones">entrance, bathroom and bedroom</span>. So I modified the week13's IoT Gateaway, in order to work with different rooms and to be able to send the password if the owner is inside. Here you can see the principal class of the IoT Gateaway: </p>
				<pre class="prettyprint lang-c">
package service;



import gateaway.RestClient;
import gateaway.RestClient.RequestMethod;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.eclipse.jetty.server.Request;
import org.eclipse.jetty.server.handler.AbstractHandler;

import com.google.gson.Gson;
 
public class HttpRequestHandler extends AbstractHandler {

	private Gson bufferGson;
	private Response bufferResponse;
	private String parameter,requestUrl;
	private RestClient restClient;
	
	public HttpRequestHandler(){
		
		bufferGson = new Gson();
		bufferResponse = new Response();
				
	}
	
	@Override
    public void handle(String target, Request baseRequest, 
    HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {
    		
    	response.setContentType("application/json;charset=utf-8");
        response.setStatus(HttpServletResponse.SC_OK);
        baseRequest.setHandled(true);
        bufferResponse.reset();
    	
    	System.out.println("Parameters received-> " + request.getParameterMap().toString());
    	
    	requestUrl = "http://"+ServiceConstants.PRACTIONIST_HOST+":"
    	+ServiceConstants.PRACTIONIST_PORT+ServiceConstants.PRACTIONIST_PATH;

		if(target.equals("/")){ 
			
			if( (parameter 
				= request.getParameter(ServiceConstants.PARAMETER_PRESENCE_1)) != null){
				
				bufferResponse.setStatus(ServiceConstants.PARAMETER_PRESENCE_1
					+": "+parameter);
				
				requestUrl += "?";
				requestUrl += ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_KIND+"=presence_entrance";
				requestUrl += "&";
				requestUrl += ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_DATA+"="+parameter;
				
				restClient = new RestClient(requestUrl);
				
				try
				{
	
					restClient.execute(RequestMethod.GET);
	
				}
				catch (Exception e)
				{
	
					e.printStackTrace();
				}
				
			}else
			if( (parameter 
				= request.getParameter(ServiceConstants.PARAMETER_PRESENCE_2)) != null){
					
				bufferResponse.setStatus(ServiceConstants.PARAMETER_PRESENCE_2
					+": "+parameter);
				
				requestUrl += "?";
				requestUrl += 
				ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_KIND+"=presence_bathroom";
				requestUrl += "&";
				requestUrl += 
				ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_DATA+"="+parameter;
				
				restClient = new RestClient(requestUrl);
				
				try
				{
	
					restClient.execute(RequestMethod.GET);
	
				}
				catch (Exception e)
				{
	
					e.printStackTrace();
				}
					
			}else
			if( (parameter 
				= request.getParameter(ServiceConstants.PARAMETER_PRESENCE_3)) != null){
					
				bufferResponse.setStatus(ServiceConstants.PARAMETER_PRESENCE_3
					+": "+parameter);
				
				requestUrl += "?";
				requestUrl += 
				ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_KIND+"=presence_bedroom";
				requestUrl += "&";
				requestUrl += 
				ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_DATA+"="+parameter;
				
				restClient = new RestClient(requestUrl);
				
				try
				{
	
					restClient.execute(RequestMethod.GET);
	
				}
				catch (Exception e)
				{
	
					e.printStackTrace();
				}
							
			}else
			if( (parameter 
				= request.getParameter(ServiceConstants.PARAMETER_OWNER_INSIDE)) != null){
					
					bufferResponse.setStatus(ServiceConstants.PARAMETER_OWNER_INSIDE
						+": "+parameter);
					
					requestUrl += "?";
					requestUrl += 
					ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_KIND+"=ownerInside";
					requestUrl += "&";
					requestUrl += 
					ServiceConstants.PRACTIONIST_PARAMETER_UPDATE_DATA+"="+parameter;
					
					restClient = new RestClient(requestUrl);
					
					try
					{
		
						restClient.execute(RequestMethod.GET);
		
					}
					catch (Exception e)
					{
		
						e.printStackTrace();
					}
							
			}else	
				bufferResponse.setError("invalid parameters");	       
			
		}else
			if(target.equals("/recognize")){
				
				response.getWriter().print("satshakitIoT");
				System.out.println("recognize received");
				return;
				
			}
				else
			bufferResponse.setError("invalid path");

	
		 response.getWriter().
		 	println(bufferGson.toJson(bufferResponse).replace("\\\"", "\""));
		
    }
 
}
				</pre>
				<p>And, according to the above modifications, also I modified the <span class="redones">PRACTIONIST code</span>. Main modifications regards implementing a data structure to memorize <span class="redones">when presence updates are perceived</span>. So I wrote the following <span class="redones">java class hierarchy</span>: </p>
				<img class="images-default" src="img/week14/class_digram.jpg">
				<p>There are also other minor modifications, that you can check by downloading the code at the bottom of this page. As starting point in develop the web gui, I drawn an SVG of the <span class="redones">residence room planimetry</span>:</p>
				<img class="images-default" src="img/week14/residence_room.svg">

				<p>I choose to made an SVG because I wanted to have the possibility to <span class="redones">change the room's colors </span> as the output indicating (or not) a presence. I separated the web gui in two main sections: <span class="redones">real time data</span> and <span class="redones">statistical data</span>. Real time data section will show the real time status of the rooms with also some general statuses, such as <span class="redones">empty</span>, <span class="redones">owner inside</span> and <span class="redones">alarm</span> (if a presence is detected and the owner is outside). The other section, statistical data, will show some charts about <span class="redones">rooms utilization</span>, and <span class="redones">owner presence</span>. The web gui is made up of <span class="redones">HTML</span> mixed with <span class="redones">javascript code</span>. I used <a href="http://getbootstrap.com/"><span class="redones-link">Bootstrap</span></a> and <a href="https://jquery.com/"><span class="redones-link">jQuery</span></a>. With jQuery I made some loops to make asynchronous HTTP GET requests to PRACTIONIST, in order to update data in real time.</p>

				<p>Here is the code doing requests for real time rooms and owner presences:</p>
				<pre class="prettyprint lang-c">
    $room_svg = $("#residence_room");
    $text_svg = $("#text");

    setInterval(function(){

       $.getJSON(

        "http://satsha.sytes.net:8080/getData?dataKind=beliefs",
        function(data){

           for(var i in data){

                if(data[i].kind == "presence"){

                    if(data[i].values[0] == "bathroom"){

                        if(data[i].values[1] == "true")
                            $("#bathroomPath", $room_svg).attr("style", "fill:"+bathroomColor);
                        else
                            $("#bathroomPath", $room_svg).attr("style", "fill:"+white);

                    } 

                    if(data[i].values[0] == "bedroom"){

                        if(data[i].values[1] == "true")
                            $("#bedroomPath", $room_svg).attr("style", "fill:"+bedroomColor);
                        else
                            $("#bedroomPath", $room_svg).attr("style", "fill:"+white);

                    }                         

                    if(data[i].values[0] == "entrance"){

                        if(data[i].values[1] == "true")
                            $("#entrancePath", $room_svg).attr("style", "fill:"+entranceColor);
                        else
                            $("#entrancePath", $room_svg).attr("style", "fill:"+white);

                    }       

                }else
                if(data[i].kind == "owner_inside"){

                    if(data[i].values[0] == "true")
                        $("#owner_string", $text_svg).text("owner: inside");
                    else
                        $("#owner_string", $text_svg).text("owner: outside");
                }

           }

          
        })
    
    }, 2000);
</pre class="prettyprint lang-c">
	<p>As you can see data is requested every 2 seconds, and is in <span class="redones">JSON</span> format. Data for the other statuses, is requested in a similar way:</p>
	<pre class="prettyprint lang-c">
       $.getJSON(

        "http://satsha.sytes.net:8080/getData?dataKind=alarm",
        function(data){

            if(data.alarm == "true")
                $("#alarm_string", $text_svg).text("alarm: true");
            else
                $("#alarm_string", $text_svg).text("alarm: false");
        
        })
    
    }, 2000);

    setInterval(function(){

       $.getJSON(

        "http://satsha.sytes.net:8080/getData?dataKind=empty",
        function(data){

            if(data.empty == "true")
                $("#empty_string", $text_svg).text("empty: true");
            else
                $("#empty_string", $text_svg).text("empty: false");
          
        })
    
    }, 2000);
	</pre>
	<p>To show statistical data I used <a href="https://developers.google.com/chart/"><span class="redones-link">Google Charts</span></a>. I used two kind of charts: a <span class="redones">bar chart</span> and a <span class="redones">pie chart</span>. I used bar chart to show rooms utilization times, and pie chart to quickly see how much time the owner is inside/outside. Here you see code to generate these charts with Google Charts apis:</p>
	<pre class="prettyprint lang-c">
function drawRoomsTimesChart(){

      var data = new google.visualization.DataTable();

      data

      var data = google.visualization.arrayToDataTable([
        
        ['room','secs',{ role: "style" }],
        ['bathroom', (bathroomTime/1000),"color: 3d85c6"],
        ['entrance', (entranceTime/1000),"color: 6aa84f"],
        ['bedroom', (bedroomTime/1000),"color: e69138"]
      
      ]);

      var options = {
        titleTextStyle: {color: "black", fontName: "monospace", fontSize: 16},
        title: "rooms utilization time",
    
        vAxis: {
          title: "secs"
        }
      };

      var chart = new google.visualization.ColumnChart(
        document.getElementById("rooms_times"));

      chart.draw(data, options);

    }

    function drawOwnerInsideChart() {

        var data = new google.visualization.DataTable();
        data.addColumn("string", "Topping");
        data.addColumn("number", "Slices");
        data.addRows([
          ["inside", ownerInside/1000],
          ["outside", ownerOutside/1000]
        ]);
     
        var options = {titleTextStyle: {color: "black", fontName: "monospace", fontSize: 16},          
                       title:"owner presence time",
                       width:400,
                       height:300,
                       is3D: true};

        var chart = new google.visualization.PieChart(document.getElementById("owner_inside"));
    
        chart.draw(data, options);

    }
</pre>
	<p>Statistical data from PRACTIONIST contains only when the updates are made. Here you can see the response for the statistical HTTP REST endpoint:</p>
<pre class="prettyprint lang-c">
{
  "entrancePresences": [
    {
      "presenceType": "entrance",
      "updateData": "true",
      "when": "2015/05/12 22:17:02"
    },
    {
      "presenceType": "entrance",
      "updateData": "false",
      "when": "2015/05/12 22:17:22"
    }
  ],
  "bathroomPresences": [
    {
      "presenceType": "bathroom",
      "updateData": "true",
      "when": "2015/05/12 22:17:09"
    }
  ],
  "bedroomPresences": [
    {
      "presenceType": "bedroom",
      "updateData": "true",
      "when": "2015/05/12 22:17:29"
    },
    {
      "presenceType": "bedroom",
      "updateData": "false",
      "when": "2015/05/12 22:17:36"
    }
  ],
  "ownerPresences": [
    {
      "updateData": "false",
      "when": "2015/05/12 21:56:50",
      "updateKind": "owner"
    },
    {
      "updateData": "true",
      "when": "2015/05/12 21:57:40",
      "updateKind": "owner"
    }
  ]
}
</pre>	
<p>So inside the code that makes requests for statistical data, I also implemented the code for getting <span class="redones">times intervals</span>:</p>
<pre class="prettyprint lang-c">
    setInterval(function(){

       $.getJSON(

        "http://satsha.sytes.net:8080/getData?dataKind=statistical",
        function(data){

           if(chartsOk){

                var bufferDate1;
                var bufferDate2;
    
                roomEmptyTime = 0;
                roomNotEmptyTime = 0;
                ownerInside = 0;
                ownerOutside = 0;
                bathroomTime = 0;
                entranceTime = 0;
                bedroomTime = 0;

                var lastFalse = "";
                var lastTrue = "";

                //calculate residence room times
                
                lastFalse = "";
                lastTrue = "";
                
                for(var i in data.bathroomPresences){

                    if(data.bathroomPresences[i].updateData == "false")    
                        lastFalse = data.bathroomPresences[i].when;
                    else                    
                    if(data.bathroomPresences[i].updateData == "true")
                        lastTrue = data.bathroomPresences[i].when;

                    if(lastTrue.length > 0 && lastFalse.length > 0){

                        bufferDate1 = new Date(lastTrue).getTime();
                        bufferDate2 = new Date(lastFalse).getTime();

                        if(bufferDate2 > bufferDate1){
                            
                            bathroomTime += bufferDate2 - bufferDate1;
                            lastTrue = "";

                        }else{
                           
                            lastFalse = "";

                        }

                    }

                }

                lastFalse = "";
                lastTrue = "";
                
                for(var i in data.entrancePresences){

                    if(data.entrancePresences[i].updateData == "false")    
                        lastFalse = data.entrancePresences[i].when;
                    else                    
                    if(data.entrancePresences[i].updateData == "true")
                        lastTrue = data.entrancePresences[i].when;

                    if(lastTrue.length > 0 && lastFalse.length > 0){

                        bufferDate1 = new Date(lastTrue).getTime();
                        bufferDate2 = new Date(lastFalse).getTime();

                        if(bufferDate2 > bufferDate1){
                            
                            entranceTime += bufferDate2 - bufferDate1;
                            lastTrue = "";

                        }else{
                           
                            lastFalse = "";

                        }

                    }

                }

                lastFalse = "";
                lastTrue = "";
                
                for(var i in data.bedroomPresences){

                    if(data.bedroomPresences[i].updateData == "false")    
                        lastFalse = data.bedroomPresences[i].when;
                    else                    
                    if(data.bedroomPresences[i].updateData == "true")
                        lastTrue = data.bedroomPresences[i].when;

                    if(lastTrue.length > 0 && lastFalse.length > 0){

                        bufferDate1 = new Date(lastTrue).getTime();
                        bufferDate2 = new Date(lastFalse).getTime();

                        if(bufferDate2 > bufferDate1){
                            
                            bedroomTime += bufferDate2 - bufferDate1;
                            lastTrue = "";

                        }else{
                           
                            lastFalse = "";

                        }

                    }

                }


                //calculate owner times
                lastFalse = "";
                lastTrue = "";

                for(var i in data.ownerPresences){

                    if(data.ownerPresences[i].updateData == "false")    
                        lastFalse = data.ownerPresences[i].when;
                    else                    
                    if(data.ownerPresences[i].updateData == "true")
                        lastTrue = data.ownerPresences[i].when;

                    if(lastTrue.length > 0 && lastFalse.length > 0){

                        bufferDate1 = new Date(lastTrue).getTime();
                        bufferDate2 = new Date(lastFalse).getTime();

                        if(bufferDate2 > bufferDate1){
                            
                            ownerInside += bufferDate2 - bufferDate1;
                            lastTrue = "";

                        }else{
                           
                            ownerOutside += bufferDate1 - bufferDate2;
                            lastFalse = "";

                        }

                    }

                }

                //redraw charts
                drawOwnerInsideChart();
                drawRoomsTimesChart();
           
           }
          
        })
    
    }, 4000);

</pre>
<p>I decided to reuse <span class="redones">satshakit IoT modules</span> and sketch code of week13. Here you can see the sketch code:</p> 
<pre class="prettyprint lang-c">
    #include &ltSoftwareSerial.h&gt
    #define DEBUG false
    
    SoftwareSerial mySerial(9,10);
    
    String cipSend,startConnection,domain,port,getRequest,path,parameters;
    boolean presence,bufferPresence;
    
    void setup(){
      
      Wire.begin();
      
      pinMode(2,INPUT);
      pinMode(13,OUTPUT);
      
      presence = false;
      bufferPresence = false;
          
      Serial.begin(9600); 
      
      if(DEBUG)
        mySerial.begin(9600); 

      domain = "10.10.10.99";
      path="";
      parameters="";
      port = "8084";

      sendData("AT+RST\r\n",5000,DEBUG);
      sendData("AT+CWMODE=1\r\n",5000,DEBUG);
      sendData("AT+CWJAP=\"mySSID\",\"xxxx\"\r\n",30000,DEBUG);
            
      if(DEBUG)      
        mySerial.println("end setup");
      
    }
    
    void loop(){
          
      if(digitalRead(2))
        bufferPresence = true;
      else
        bufferPresence = false;
        
      if(bufferPresence != presence){
      
        presence = bufferPresence;
        
       if(DEBUG)  
        mySerial.println("presence changed");
        
        if(presence){
          parameters = "?presence5=true";
          digitalWrite(13, HIGH);
        }else{
          parameters = "?presence5=false";
          digitalWrite(13, LOW);  
        }     
                
        startConnection = "AT+CIPSTART=\"TCP\",\"" + domain + "\","+port+"\r\n";
        sendData(startConnection,5000,DEBUG);
      
        getRequest = "GET /"+parameters+" HTTP/1.1\r\nHost:"+domain+":"+port+"\r\n\r\n";
      
        cipSend = "AT+CIPSEND=";
        cipSend += getRequest.length();
        cipSend += "\r\n";
      
        sendData(cipSend,5000,DEBUG);     
        sendData(getRequest,5000,DEBUG);
      
        delay(30000);
      
        sendData("AT+CIPCLOSE\r\n",5000,DEBUG);
      
        delay(5000);    
          
      }else{
        if(DEBUG) 
          mySerial.print("presence not changed");
      }
      delay(1000);
      
      
    }
   
   
    String sendData(String command, const int timeout, boolean debug){
      
      String response = "";
      
      Serial.print(command);
      mySerial.print("Command: "+command);
      
      long int time = millis();
      
      while((time+timeout) > millis()){
        
        while(Serial.available()){
          
          char c = Serial.read(); 
          response+=c;
        
        }  
      }
      
      if(debug){
       
        mySerial.print("response: "); 
        mySerial.print(response);
      }
      
      return response;
    
  }
</pre>
<p>So I placed the IoT modules inside my residence room:</p>
<img class="images-default" src="img/week14/entrance.jpg">
<img class="images-default" src="img/week14/bedroom.jpg">
<img class="images-default" src="img/week14/bathroom.jpg">

<p>At the end this is the <span class="redones">resulting web gui</span>, while it's perceiving data from PRACTIONIST:</p>
<img class="images-default" src="img/week14/gui.jpg">
<p>Also here is screen capture video, that shows the web gui <span class="redones">while it's working</span>:</p>

<iframe width="700" height="450" src="https://www.youtube.com/embed/89mAAhVE-Lw" frameborder="0" allowfullscreen></iframe>

<p>Here you can download the code I wrote for this assignment: <a href="other/web_gui.rar"><span class="redones-link">web gui</span></a>, <a href="other/PRACTIONIST_FabAcademy_new.rar"><span class="redones-link">PRACTIONIST_FabAcademy</span></a>, <a href="other/IoTGateaway_new.rar"><span class="redones-link">IoT Gateaway</span></a>, <a href="other/OwnerPresenceApp.rar"><span class="redones-link">Owner presence Android app</span></a>.</p>

			</div>
		</section>
		<section id= "week16" class="row">
			<div class="photo-grid">
				<p>This week is a special one because we've dealt with a <span class="redones">teamwork exercise</span> for <span class="redones">mechanical design, machine design</span>.</p>

				<p>As we are 10 students, and we have 4 gestalt machine axis, we decided to make two different, two axis machines: an <span class="redones">XY plotter</span> and a <span class="redones">lathe</span>. In order to build them, and more important, to make sure that everyone do something, we split the work in several pieces.</p>

				<p>Before starting in machine building, <span class="redones">we tried out the machine axis</span>, with the cardboard example structure, <span class="redones">Fabnet</span>, and software shown in the FabAcademy tutorials. This also because we needed to reuse Fabnet and the cable to with our machines. Here are some pictures of the process. Gianluca Pugliese soldered Fabnet:</p>

				<img class="images-default" src="img/week17/fabnet_solder.jpg">
				<img class="images-default" src="img/week17/fabnet.jpg">

				<p>While I, following pictures and schematics on the tutorial page, built the cable:</p>
				<img class="images-default" src="img/week17/cable.jpg">

				<p>And finally Mattia Ciurnelli with Simone Boasso lasercutted the cardboard structure:</p>
				<img class="images-default" src="img/week17/structure.jpg">

				<p>Here's a video that shows one of the built axis while is working:</p>
				<iframe width="700" height="450" src="https://www.youtube.com/embed/SRfGtBIdm_U" frameborder="0" allowfullscreen></iframe>

				<p><br>After this first axis, the other students made the others, to see if they was all working.</p>

				<ul class="lists">
				<li>The part I've done regards the <span class="redones">development of the software</span> in order to use these machines. As we have some remote students, Vincenzo Savarino, Youssef Bouali and Claudio Pecere, they joined me in development as this kind of work can be done remotely. As our instructor, Massimo Menichinelli, taught us <span class="redones">Python</span>, we used this language to develop the software. Also we want to print SVG files, coming from <span class="redones">Inkscape</span>. The work was <span class="redones">structured</span> as follows:</li>
				<li>me as the software components integrator, CAM developer, embedded programmer</li>
				<li>Vincenzo Savarino for SVG understanding and developer of the SVG parsing</li>
				<li>Youssef Bouali and Claudio Pecere for GUI of the machine commands and SVG preview </li>
				</ul>
				
				<p>The XY plotter, later conceived by Saverio Silli as a <span class="redones">Zen Garden</span>, required also a <span class="redones">supplementary feature</span>: the possibility to <span class="redones">lower and raise the tip</span> as needed for <span class="redones">SVG movements "M"</span>. In order to this I thought about using a <span class="redones">satshakit with a servo motor</span>, controlled by our software via a <span class="redones">serial FTDI</span> interface.</p>

				<p>To develop I used <a href="https://eclipse.org/"><span class="redones-link">Eclipse IDE</span></a> (Luna version), with installed <a href="http://pydev.org/"><span class="redones-link">PyDev</span></a> plugin. PyDev integrates Python langauge into Eclipse IDE. Here's a screenshot of my setup, and about the packages and files of the software:</p>

				<img class="images-default" src="img/week17/eclipse.png">

				<ul class="lists"><li>The packages contains the following components:</li>
					<li><span class="redones">examples</span>: some examples from <a href="https://github.com/imoyer/gestalt"><span class="redones-link">/imoyer/gestalt</span></a> repo</li>
					<li><span class="redones">gestalt</span>: full <a href="https://github.com/imoyer/gestalt"><span class="redones-link">/imoyer/gestalt</span></a> repo</li>
					<li><span class="redones">mtm</span>: contains the code that integrates all togheter, the machine class and the CAM to use the machines</li>
					<li><span class="redones">svgParse</span>: contains the code to read and parse svg data</li>

				</ul>

				<p>My part was focused on the development of the mtm package. Let's examinate what I've done inside. First I created an <span class="redones">Configuration.py</span> which contains some global configuration data. Here's the code about:</p>

				<pre class="prettyprint lang-c">
# -*- coding: utf-8 -*-

'''
Created on 13/jun/2015

@author: satsha
'''

MM_STEPS_RATIO = 1.4
MACHINE_MAX_Y = 280
MACHINE_MAX_X = 280
				</pre>

				<ul class="lists"><li><br>Then I created the file <span class="redones">Utils.py</span> which contains some utility methods and the CAM. In particular here are the following functions:</li>
					<li><span class="redones">mm2steps</span>: to convert millimeters into virtual machine measure unit</li>
					<li><span class="redones">checkSvgDims</span>: to check if the SVG doesn't exceed the gestalt axis usable area</li>
					<li><span class="redones">svgDataToMachine</span>: the CAM used to convert SVG parsed data structure into a machine path, to be noted that this function will position axis at the starting point after the path is finished</li>
				</ul>

				<p>The CAM I implemented, accordingly with the SVG parser, will catch only the <span class="redones">movements "M" and lines "L"</span> of the path SVG element. Here you can read about the code of the Utils.py file:</p>

				<pre class="prettyprint lang-c">
# -*- coding: utf-8 -*-
'''
Created on 13/jun/2015

@author: satsha
'''

import mtm.Configuration as conf
import svgParse.parse_path as parse_path

def mm2steps(mm):
    return mm*conf.MM_STEPS_RATIO

def checkSvgDims(elements):
    
        for e in elements:
            if e.nodeName == 'g':
                for path in e.getElementsByTagName('path'):
                    pathCommands = parse_path.get_path_commands(path.getAttribute('d'))
                    for command in pathCommands:
                        if command[1][0] != None:
                            if ((command[1][0][0]/5) &gt 280 or (command[1][0][0]/5) &lt 0) or ((command[1][0][1]/5) &gt 280 and (command[1][0][1]/5) &lt 0):
                                return False
    
        return True
    
def svgDataToMachine(elements):
    
            machine = []
            
            for e in elements:
                if e.nodeName == 'g':
                    for path in e.getElementsByTagName('path'):
                        pathCommands = parse_path.get_path_commands(path.getAttribute('d'))
                        for command in pathCommands:
                            if command[0][0] != None and command[1][0] != None:
                                machine.append([command[0][0],(-command[1][0][0]/5),(command[1][0][1]/5)])
             
            machine.append([('M'),(0),(0)])                                  
            return machine
                        
				</pre>	

	<ul class="lists"><li><br>I also created another file for our machines: <span class="redones">fabMachine.py</span>. I developed this file starting from the <span class="redones">xy_plotter.py</span> example. Specifically, I added two extra functions:</li> 
		<li><span class="redones">printPath</span>: to move the machine accordingly to the path generated from the CAM</li>
		<li><span class="redones">moveSingle</span>: to do a single movement</li>
	</ul>
	<p>In the printPath function, there is the code for <span class="redones">distinguish SVG movements "M" from lines "L"</span>, and to send the command to the satshakit that controls the tip position via the servo. Here's the code:</p>

				<pre class="prettyprint lang-c">
from gestalt import nodes
from gestalt import interfaces
from gestalt import machines
from gestalt import functions
from gestalt.machines import elements
from gestalt.machines import kinematics
from gestalt.machines import state
from gestalt.utilities import notice
from gestalt.publish import rpc
import time
import io

import svgParse.svg2path as svg2path
import mtm.Utils as utils
import serial


def printPath(machineData,velocity):

    serialPort = '/dev/ttyUSB0';
    serialSpeed = 115200;
    
    try:
        serialInterface = serial.Serial(serialPort, serialSpeed)
        print 'serial initialized @ '+serialPort+' speed of '+str(serialSpeed)
        
    except:
     print 'serial initizialization error @ '+serialPort+' speed of '+str(serialSpeed)    

    stages = virtualMachine(persistenceFile = "test.vmp")
    stages.xyNode.setVelocityRequest(velocity)    
    
    
    for move in machineData:
        
            if move[0] == 'M':
               serialInterface.write(str(1));
            else:
                if move[0] == 'L':
                    serialInterface.write(str(0));
        
            stages.move([move[1],move[2]], 0)
            
            status = stages.xAxisNode.spinStatusRequest()
            
            while status['stepsRemaining'] > 0:
                time.sleep(0.1)
                status = stages.xAxisNode.spinStatusRequest()    


def moveSingle(x,y,velocity):
    stages = virtualMachine(persistenceFile = "test.vmp")

    stages.xyNode.setVelocityRequest(velocity)    
    moves = [[x,y]]

    
    for move in moves:
        stages.move(move, 0)
        status = stages.xAxisNode.spinStatusRequest()
       
        while status['stepsRemaining'] > 0:
            time.sleep(0.001)
            status = stages.xAxisNode.spinStatusRequest()    

class virtualMachine(machines.virtualMachine):
    
    def initInterfaces(self):
        if self.providedInterface: self.fabnet = self.providedInterface        
        else: self.fabnet = interfaces.gestaltInterface('FABNET', interfaces.serialInterface(baudRate = 115200, interfaceType = 'ftdi', portName = '/dev/ttyUSB1'))
        
    def initControllers(self):
        self.xAxisNode = nodes.networkedGestaltNode('X Axis', self.fabnet, filename = '086-005a.py', persistence = self.persistence)
        self.yAxisNode = nodes.networkedGestaltNode('Y Axis', self.fabnet, filename = '086-005a.py', persistence = self.persistence)

        self.xyNode = nodes.compoundNode(self.xAxisNode, self.yAxisNode)

    def initCoordinates(self):
        self.position = state.coordinate(['mm', 'mm'])
    
    def initKinematics(self):
        self.xAxis = elements.elementChain.forward([elements.microstep.forward(4), elements.stepper.forward(1.8), elements.leadscrew.forward(8), elements.invert.forward(True)])
        self.yAxis = elements.elementChain.forward([elements.microstep.forward(4), elements.stepper.forward(1.8), elements.leadscrew.forward(8), elements.invert.forward(False)])        
        self.stageKinematics = kinematics.direct(2)
    
    def initFunctions(self):
        self.move = functions.move(virtualMachine = self, virtualNode = self.xyNode, axes = [self.xAxis, self.yAxis], kinematics = self.stageKinematics, machinePosition = self.position,planner = 'null')
        self.jog = functions.jog(self.move)
        pass
        
    def initLast(self):
        self.machineControl.setMotorCurrents(aCurrent = 0.8, bCurrent = 0.8, cCurrent = 0.8)
        self.xNode.setVelocityRequest(0)    
        pass
    
    def publish(self):
        self.publisher.addNodes(self.machineControl)
        pass
    
    def getPosition(self):
        return {'position':self.position.future()}
    
    def setPosition(self, position  = [None]):
        self.position.future.set(position)

    def setSpindleSpeed(self, speedFraction):
        #self.machineControl.pwmRequest(speedFraction)
        pass

				</pre>

				<p><br>Serial commands sent by the printPath function, are read via serial and used by the satshakit as the following <span class="redones">Arduino sketch</span> shows. I wrote this sketch together with Simone Boasso. When ASCII 48 (the char "0") is received the servo will go up, and vice versa will happen with 49 (the char "1"). Here's the sketch code:</p>

				<pre pre class="prettyprint lang-c">
#include &ltServo.h&gt

Servo servo;
int value;

void setup() {
  
  pinMode(13,OUTPUT);
  
  servo.attach(12);
  Serial.begin(115200);


}

void loop() {
  
  if(Serial.available()){
    
    value = Serial.read();
    
    Serial.println(value);
    
    if(value == 48){
       
      digitalWrite(13,LOW);
      servo.write(0);   
    
    }else
    if(value == 49){
      
      digitalWrite(13,HIGH);
      servo.write(130);   
    
    }
  }
  
  delay(10);

}
				</pre>

				<p><br>Finally, in order to test all the components, I wrote the <span class="redones">main.py</span> file. Main.py simply uses the files I've described before, plus the SVG parser from Vincenzo, to <span class="redones">print an SVG with the machines</span>. Here's the code about:</p>

				<pre pre class="prettyprint lang-c">
# -*- coding: utf-8 -*-

'''
Created on 13/jun/2015

@author: satsha
'''

import svgParse.svg2path as svg2path
import mtm.Utils as utils
import mtm.fabMachine as plotter

if __name__ == '__main__':

    #parse svg
    svgData = svg2path.parse('drawing.svg')
    
    #check dimensions
    if utils.checkSvgDims(svgData):
        print 'SVG dimensions ok'
        
        machineData = utils.svgDataToMachine(svgData)
    
        for data in machineData:
            print data[0],
            print ' ',
            print data[1]
            print ' ',
            print data[2]
            
        plotter.printPath(machineData,8)    
                        
    else:
        print 'SVG dimensions exceed the machine area'

				</pre>

				<p><br>In order to print the SVGs with our machines, you can use <span class="redones">Inkscape</span>. You need to transform the items you drawn in paths with the following command <span class="redones">"Path -> Object to path"</span> and then use the function <span class="redones">"Extension -> Modifiy Path -> Flatten Beziers"</span>, due olny "M" and "L" SVG path are intepreted by the software. Here you can see a video about the software while it's controlling the XY plotter (Zen Garden):</p>

				<iframe width="700" height="450" src="https://www.youtube.com/embed/z2z3II6Ukg0" frameborder="0" allowfullscreen></iframe>

				<p><br>Here is a picture about the finished drawings of the video:</p>
				<img class="images-default" src="img/week17/zen_drawings.jpg">

				<p>For the <span class="redones">lathe</span> machine, the software needed some dimensions adjustments. After some tuning we managed to use the same software with the lathe. Here are two videos about:</p>

				<iframe width="700" height="450" src="https://www.youtube.com/embed/qCDA7sPEB0o" frameborder="0" allowfullscreen></iframe>

				<iframe width="700" height="450" src="https://www.youtube.com/embed/kFXGtFw6jkU" frameborder="0" allowfullscreen></iframe>

				<p><br>Finally, here are the pieces made with lathe machine:</p>
				<img class="images-default" src="img/week17/lathe_results.jpg">

				<p>Here you can download the software we've developed: <a href="other/MTM.rar"><span class="redones-link">MTM</span></a>.</p>

			</div>
		</section>
		<section id= "week17" class="row">
			<div class="photo-grid">
				<p>Along this week we've talked about <span class="redones">invention, intellectual property, and income</span>. Starting from the assumption that I've tried to develope an <span class="redones">autonomous drone</span>, that's a really <span class="redones">difficult project</span> but also a very <span class="redones">marketable one</span>, I will start to talk of my personal intention before any license and legal question.</p>
				<p>Personally, I loved these FabAcademy's months of <span class="redones">hard and high motivated work</span>. I face alot of difficulties, but in the end I was <span class="redones">really satisfied of my results</span>. In few words, I will really  <span class="redones">like to see more about of my final project </span> developement, made by me or maybe from anyone else. But for sure, I will not like the fact that someone  <span class="redones">will close my project in a commercial one </span> and no one will be able to continue it, or understand how it works. So what I want is to <span class="redones">keep AAVOID as an open hardware and software platform</span> so to became a <span class="redones">reference point</span> for who wants to <span class="redones">freely</span> start the <span class="redones">developement of a fabbable & open smart quadcopter</span>. Also, I trust the  <span class="redones">power of the community </span>, which, as one of one million existing examples, was fundamental during the FabAcademy.</p>

				<p>Accordingly to these considerations, I chose to use the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="redones-link">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0)</span></a> for projects, drawings, images, videos, and <a href="http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html"><span class="redones-link">GNU Lesser General Public License, version 2.1</span></a> for source code.</p>

				<p>In my opinion AAVOID <span class="redones">is not able to break the market</span>, or even effectively stimulate a crowdfounding campaign. Also, due to the above considerations I will like the fact <span class="redones">it will remain open</span>. As diffusion ways I was thinking about talking about AAVOID in <span class="redones">specialized media, social networks, workshops a maybe some conferences</span>.</p>

			</div>
		</section>
		<section id= "week18" class="row">
			<div class="photo-grid">
				<p>week18 project development</p>
			</div>
		</section>
		<section id= "week19" class="row">
			<div class="photo-grid">
				<img src="presentation.png">
			</div>
		</section>
<section id= "project0" class="row">
			<div class="photo-grid">
				
				<p>This page shows <span class="redones">results</span> about my <span class="redones">FabAcademy</span> quadcopter final project: <span class="redones">A</span>utonomous <span class="redones">A</span>ssembly a<span class="redones">VOI</span>dance <span class="redones">D</span>rone.</p>
				<img class="images-default" src="img/final_project/7/AAVOID_up.jpg">
				<ul class="lists">
					<li>AAVOID <span class="redones">achieved</span> to:</li>
					<li>be almost <span class="redones">fabbable</span></li>
					<li>do almost perfect <span class="redones">flights</span></li>
					<li>bring onboard a <span class="redones">smartphone</span></li>
					<li>send real time <span class="redones">data through internet</span></li>
					<li>automatically <span class="redones">avoid</span> different obstacles such as <span class="redones">walls and people</span></li>
					<li>be an <span class="redones">open & low cost platform</span> to develope a <span class="redones">smart & fabbable drone</span></li>
				</ul>

				<p>If you want to <span class="redones">build an AAVOID</span> by yourself of course <span class="redones">you can do it</span>. On this purpose I've created an all in one package with everything you need to <span class="redones">digital fabricate</span> it: <a href="other/AAVOID_files.rar"><span class="redones-link">AAVOID_files</span></a>.</p>

				<p>Also, I did the following <a href="other/AAVOID_BOM.pdf"><span class="redones-link">Bill Of Materials (download)</span></a>, for you to get all parts you may need:</p>
				<iframe width="900" height="400" src="https://docs.google.com/spreadsheets/d/1BSloIivfbE2i2i6q-gaaQD0LK4O9zXnzNUXTOeDzLtE/pubhtml?widget=true&amp;headers=false"></iframe>

				<p><br>While in the <span class="redones">final project</span> section you can read <span class="redones">all the technical details</span> about AAVOID developement, here are some media of the <span class="redones">final version</span>.</p>

				<p>These are <span class="redones">video collections</span> about the <span class="redones">final results of AAVOID</span>:</p>
				<iframe width="700" height="400" src="https://www.youtube.com/embed/d7vyrYP5Dv0" frameborder="0" allowfullscreen></iframe>
				<iframe width="700" height="450" src="https://www.youtube.com/embed/videoseries?list=PLqZoQW5WAkMd1l3yD5R0X7uHbD_H_N9HI" frameborder="0" allowfullscreen></iframe>

				<p><br>And here's a <span class="redones">image gallery</span> about AAVOID last version:</p>

				
				<img class="images-default" src="img/final_project/7/AAVOID_hand.jpg">
				<img class="images-default" src="img/final_project/7/AAVOID_smarthpone.jpg">
				<img class="images-default" src="img/final_project/7/AAVOID_down.jpg">
							
			
			</div>
		</section>
		<section id= "project1" class="row">
			<div class="photo-grid">
				
				<p><br>Final Project: <span class="redones">concept</span>.<br>
				We are by now invaded by <span class="redones">Unmanned Aerial Vehicles</span>. They spread everywhere and for whatever kind of use, from taking an aerial video of a party to flying over a raging forest fire alerting firefighters, from hovering over a construction site conducting a building inspection to exploring dangerous places like war sites.</p>

				<img class="images" src="img/drone_fire.jpeg">
				<img class="images" src="img/drone_inspect.jpeg">
			
				<p>The use of such flying robotics in the form of small UAVs, also known as <span class="redones">drones</span>, is pervasive now but not only: its <span class="redones">commercial growth</span> is predicted to <span class="redones">significantly increase</span> and reach several tens billions of dollars worldwide over the next years.</p>
				<img class="images1" src="img/drones_market.jpeg">
				
				<p>However, in order to achieve this market increase, a multitude of <span class="redones">issues</span> needs to be addressed and several <span class="redones">improvements</span> need to be done. For example, talking about security, the drones on the market today don’t have anything that complain with obstacle avoidance, so they easily get crashed on people and things by inexperienced pilots. Furthermore, they don’t present any kind of mechanism to cooperate each other, or to obtain smarter behaviours.</p>
				<img class="images" src="img/drone_crash.jpg">

				
				<ul class="lists">
				<li>Accordingly to above examples, and due to my interest on <span class="redones">A.I.</span>, what I want to do is to make a drone with such capabilities. So my goal is to acquire all the know-how on the today’s drones to build a <span class="redones">smart quadcopter</span> that offers the following extras:</li>
				<li><span class="redones">obstacle avoidance</span></li>
				<li><span class="redones">cooperation capabilities</span></li>
				</ul>
				<p>The concept of cooperation I want to realize is intended as another use of the drones:  <span class="redones">the drones as building block material</span> that can be modularly and autonomously assembled.
				In this direction I think at this quadcopter like a normal one, but equipped with <span class="redones">advanced</span> hardware and software <span class="redones">components</span>, and surrounded by a cage, in order to apply more sensors and to enable an autonomous assembly behaviour. I think about the cage as a <span class="redones">light cubic frame</span> for simplicity of drones assembling.</p>
				
				<p> The acronym I have chosen for this drone is <span class="redones"> AAVOID</span>:<span class="redones"> A</span>utonomous <span class="redones"> A</span>ssembly a<span class="redones">VOI</span>ding <span class="redones">D</span>rone</p>
				
				<p>Here is a draft schema of the <span class="redones">Control Unit</span>'s hardware architecture:</p>
				<img class="images-default" src="img/final_project/AAVOID_CU.png" style="background-color:white;width: 65%;"></p>

			</div>
		</section>
		<section id= "project2" class="row">
			<div class="photo-grid">
				<p>Final project electronics: <span class="redones">flight controller experimentations</span></p>
				<p>The developing of AAVOID flight controller goes through several steps. I will use the flight controller as the interface to <span class="redones">access and control low level drone hardware</span>, such as motors, accelerometer etc. Due to the fact that flight controller and actuators & sensors board share the same core architecture, I will use the work done for flight controller as the starting point to develop the sensors & actuators board.</p> 

				<p>One of the my firts ideas was to use the <span class="redones">ATMega2560</span> microcontroller, as you can see from the old AAVOID Control Unit architecture:</p>

				<img class="images-default" src="img/final_project/1/fligh_controller_old.jpg">

				<p>In order to pursue this idea, first I wanted to know if I was able to <span class="redones">proper solder</span> the 100 pins of this big microcontroller. Also, I needed FDTI and USB part of the circuit in order to test it completely. So I made, with our Trotec Speedy100 Flexx, <span class="redones">three different breakout boards</span>, ATMega2560, FTDI FT232RL and USB.</p>

				<p>Here are screens about Eagle schematics:</p>
				
				<img class="images-default" src="img/final_project/1/usb_schematic.png">
				<img class="images-default" src="img/final_project/1/ft232rl_schematic.png">
				<img class="images-default" src="img/final_project/1/2560_schematics.jpg">

				<p>Here you can see screens about Eagle boards:</p>

				<img class="images-default" src="img/final_project/1/usb_board.png">
				<img class="images-default" src="img/final_project/1/ft233rl_board.png">
				<img class="images-default" src="img/final_project/1/2560_board.png">

				<p>Here you can download the Eagle projects of the breakboards plus the svg files ready to be printed: <a href="drawings/final_project/1/breakboards.rar"><span class="redones-link" >download</span></a>.</p>

				<p>Attempts to solder ATMega2560 and FT232RL failed, due to, now recognized, my error in apply too much flux. The USB breakboard was ok. Here you can see some pictures about the results and test circuits:</p>

				<img class="images-default" src="img/final_project/1/usb_soldering.jpg">
				<img class="images-default" src="img/final_project/1/usb_real.jpg">
				<img class="images-default" src="img/final_project/1/ft232rl_positioning.jpg">
				<img class="images-default" src="img/final_project/1/ft232rl_real_.jpg">
				<img class="images-default" src="img/final_project/1/ft232rl_full.jpg">

				<p>A short circuit cause some smoke exiting from FT232RL pins, so I quickly detached USB cable from PC..:</p>

				<img class="images-default" src="img/final_project/1/ft232rl_explosion.jpg">

				<p>Here you can see the attemps with ATMega2560, from positioning to test circuit:</p>

				<img class="images-default" src="img/final_project/1/2560_resin.jpg">
				<img class="images-default" src="img/final_project/1/2560_positioning.jpg">
				<img class="images-default" src="img/final_project/1/2560_flux.jpg">
				
				<img class="images-default" src="img/final_project/1/2560_real.jpg">
				<img class="images-default" src="img/final_project/1/2560_full.jpg">

				<p>I never managed to past the fuses step while programming the ATMega2560:</p>

				<img class="images-default" src="img/final_project/1/2560_fuses.png">
				
				<p>As I developed a general purpose Arduino compatible board, the <a href="https://github.com/satshas/satshakit"><span class="redones-link">satshakit</span></a>, I decided to use it as my flight controller board. As communication and the programming communication I will use an <span class="redones">USB FTDI 5V cable</span>. With this cable I don't need anymore the FT232RL chip. Also, as IMU, I will use a <a href="http://www.drotek.fr/shop/en/home/62-imu-10dof-mpu6050-hmc5883-ms5611.html"><span class="redones-link">Drotek 10DOF</span></a>. With this IMU I will get MPU6050 gyro, HMC5883 digital compass and MS5611 barometer, all in a compact package. Furthermore, this the Drotek 10DOF will work well with <a href="http://www.multiwii.com/"><span class="redones-link">Multiwii</span></a>.</p>

				<p>With satshakit, Multiwii and quadcopter hardware I've done several <span class="redones">successful experimentation</span>. You can read more in the <a href="javascript:ReplaceContentInContainer('middle',document.getElementById('week11').innerHTML,'week11')" rel="lightbox" class="col-2"><span class="redones-link" style="font-weight: bold;">output devices assignment</span></a> section. Here is a video about controlling ESCs and motors with satshakit:</p>

				<iframe width="700" height="450" src="https://www.youtube.com/embed/kZMLoyP47z4" frameborder="0" allowfullscreen></iframe>

			</div>
		</section>
		<section id= "project3" class="row">
			<div class="photo-grid">
				<p>Final project: <span class="redones">Applications and Implications</span>.</p>
				<p>In this project page we've to better describe our final project, and also take into consideration that it isn't just a <span class="redones">mind's whim</span>, but it can have some real-world <span class="redones">Applications and Implications</span>.</p>

				<p>The <span class="redones">big news</span> is that I've accepted <span class="redones">Neil's suggestion</span> to cooperate with someone to have better chances to <span class="redones">carry out the project</span>. In fact, after Neil told me two times the aforementioned suggestion, our local instructur <span class="redones">Massimo Menichinelli</span> and my fellow student <a href="http://fabacademy.org/archives/2015/eu/students/ciurnelli.mattia/index.html"><span class="redones-link">Mattia Ciurnelli</span></a>, proposed me to develop the project not alone. After this Mattia told me that, if for me it's ok, he would participate. Finally, I <span class="redones">decided to cooperate</span> with him. Motivations behind this decision are mainly that I've always cooperated well with Mattia. He is young and also filled with the desire to succeed, like me. I also <span class="redones">warned him</span> about the chances that this project will fail. This project may go <span class="redones">beyond the FabAcademy scopes</span>, but also I think that it's difficult for me that similar <span class="redones">circumstances will come again</span>, so <span class="redones">let's try our best</span>.</p>

				<h2 class="col-2" style="margin: 30px;">Question 1: <span class="redones" style="font-style: italic;">what will it do?</span><br></h2>	

				<p><span class="redones">Fly</span>. With the difference on <span class="redones">how</span> it will fly. Something can fly, if it's light enough for you to launch it. And what about an remote controlled airplane? You're just using another method to control it, but, same as an hand launch, you're in charge do decide what to do, how and where fly. So what's this project about? It's about giving <span class="redones">some degree of autonomy</span> at an <span class="redones"> almost fabbed quadcopter</span>. Key features in this direction are: <span class="redones">obstacle avoidance</span> and <span class="redones">cooperation</span> capabilities.</p>	

      			<h2 class="col-2" style="margin: 30px;">Question 2: <span class="redones" style="font-style: italic;">who's done what beforehand?</span><br></h2>
      			
      			<p>As far as I know, in today market there isn't a <span class="redones">really, even partially, autonomous drone</span>. Unless you consider autonomous some drones following GPS coordinates at high quota, needed to avoid obstacles. In the academician world there are some prototypes that seems to work very well, talking about cooperation, but not of obstacle avoidance: <a href="http://www.ted.com/talks/raffaello_d_andrea_the_astounding_athletic_power_of_quadcopters"><span class="redones-link">Raffaello D'Andrea's athletic quadcopter</span></a>, <a href="https://www.ted.com/talks/vijay_kumar_robots_that_fly_and_cooperate"><span class="redones-link">Vijay Kumar robots that fly...and cooperate</span></a>. To be know that these prototypes work only in a special and built on purpose environment, that helps the drones to move and detect each other.</p>
      			
      			<h2 class="col-2" style="margin: 30px;">Question 3: <span class="redones" style="font-style: italic;">what materials and components will be required?</span><br></h2>
      			
      			<ul class="lists">
      				<li>I think it's a good idea to split required materials in three macro category:</li>
      				<li><span class="redones">structural materials:</span> wood frame, plastic/carbon fiber propellers, plastic supports/cage</li>
      				<li><span class="redones">electronics equipment:</span> <a href="http://fabacademy.org/archives/2015/doc/projects/satshakit/satshakit.html"><span class="redones-link">satshakits</span></a>, 10DOF IMU, radio remote controller, USB FTDI cable, Android smartphone, sonar sensors, eventually a server</li>
      				<li><span class="redones">software components:</span> Android porting of <a href="http://practionist.eng.it/index.htm"><span class="redones-link">PRACTIcal reasONIng sySTem</span></a> framework for implementing autonomous behaviours, <a href="http://www.multiwii.com/"><span class="redones-link">MultiWii</span></a> as flight controller, eventually a Linux server for storage and data anlysis</li>
      			</ul>
      			
      			<h2 class="col-2" style="margin: 30px;">Question 4: <span class="redones" style="font-style: italic;">where will they come from?</span><br></h2>

      			<p>Wood will come from a <span class="redones">local supplier</span>, same as for the PLA we will use to 3D print small parts such as supports. I developed satshakit, so it will come from <a href="http://www.opendotlab.it/"><span class="redones-link">OpenDot Fablab</span></a>, but obviously, the component of which is made or the other electronic parts, are all made in China.</p>

      			<h2 class="col-2" style="margin: 30px;">Question 5: <span class="redones" style="font-style: italic;">how much will it cost?</span><br></h2>

     			<p>This will be an expensive project. It's too early to know now the exact cost of all, but I think it will costs around <span class="redones">300 euros</span>. The <span class="redones">most expensive parts</span> will be: ESCs, motors, sonar sensors and the Android smartphone.</p>
     			
     			<h2 class="col-2" style="margin: 30px;">Question 6: <span class="redones" style="font-style: italic;">what parts and systems will be made?</span><br></h2>
      			
      			<ul class="lists">
      				<li>Dealing with the FabAcademy philosophy, we will try, at our best, to <span class="redones">make/develop by ourselves</span> the following parts:</li>
      				<li>frame</li>
      				<li>surroundings cage</li>
      				<li>parts and sensors supports</li>
      				<li>flight controller board (based on satshakit)</li>
      				<li>sensors and actuators board (based on satshakit)</li>
      				<li>power and signal distribution board</li>
      				<li>software for autonomous control</li>
      				<li>software for drone data streaming and analysis</li>
      				</ul>
      			<h2 class="col-2" style="margin: 30px;">Question 7: <span class="redones" style="font-style: italic;">what processes will be used?</span><br></h2>
      			
      			<ul class="lists"><li>I think that we will use <span class="redones">several and heterogeneous processes</span>. In fact we have to deal with:</li>
      				<li><span class="redones">laser engraving</span> pcbs</li>
      				<li><span class="redones">soldering</span> and testing pcbs</li>
      				<li><span class="redones">laser cutting</span> the frame</li>
      				<li><span class="redones">3D printing supports</li>
      				<li><span class="redones">embedded programming</span></li>
      				<li>Android, Web and Linux <span class="redones">software development</span></li>
      			</ul>

      			<h2 class="col-2" style="margin: 30px;">Question 8: <span class="redones" style="font-style: italic;">what tasks need to be completed?</span><br></h2>

      			<p>You can read about the tasks we've defined, in <span class="redones">question 10. There you can find also the schedule.</span>.</p>

      			<h2 class="col-2" style="margin: 30px;">Question 9: <span class="redones" style="font-style: italic;">what questions need to be answered?</span><br></h2>

      			<ul class="lists"><li>There will be many difficulties, but I continuously think <span class="redones"> about three main concerns:</span></li>
      				<li>how to make a <span class="redones">stable flight</span> with almost fabbed parts</li>
      				<li>how to efficiently load sensors and smartphone on the quadcopter</li>
      				<li>develop <span class="redones">accurate and efficient agorithms</span> for obstacle avoidance and cooperation capabilities</li>
      			</ul>
      			
      			<h2 class="col-2" style="margin: 30px;">Question 10: <span class="redones" style="font-style: italic;">what is the schedule?</span><br></h2>

      			<p>Here you can see the <span class="redones">Gantt diagram</span> we've made with Mattia. Tasks in <span class="redones">yellow</span> are assigned to Mattia, while the <span class="redones">red</span> ones are mine. <span class="redones">Blue</span> tasks are shared between us.</p>
      			
      			<iframe  style="margin: 30px" width="1200" height="600" src="dhtmlxGantt/gantt.html"></iframe>
     		 	
     		 	<h2 class="col-2" style="margin: 30px;">Question 11: <span class="redones" style="font-style: italic;">how will it be evaluated?</span><br></h2>
     		 	<ul class="lists"><li>We will evalute this project by effectively reaching three macro milestones. I think that the milestones are:</li>
     		 		<li><span class="redones">fly</span> with an almost fabbed quadcopter</li>
     		 		<li>implement some autonomous <span class="redones">obstacle avoidance capabilities</span></li>
     		 		<li>implement some autonomous <span class="redones">cooperation capabilities</span></li>
     		 		</ul>				
			</div>
		</section>
		<section id= "project5" class="row">
			<div class="photo-grid">
				<p>Final project electronics: <span class="redones">flight controller</span>.</p>
				<p>As discussed in the previous final project section <a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project2').innerHTML,'project2')" rel="lightbox" class="col-2"><span class="redones-link" style="font-weight: bold;">flight controller experimentations</span></a>, I decided to use a modified <a href="http://fabacademy.org/archives/2015/doc/projects/satshakit/satshakit.html"><span class="redones-link">satshakit</span></a> with <a href="http://www.multiwii.com/"><span class="redones-link">MultiWii</span></a> as flight controller board.

				<p>Due to the fact <a href="http://fabacademy.org/archives/2015/eu/students/ciurnelli.mattia/index.html"><span class="redones-link">Mattia Ciurnelli</span></a> joined with me in order to help carrying out AAVOID quadcopter final project, I discussed with him about the size and the shape of the board in order to fit it within the distribution board. Also, there were several other design parameters related to the <span class="redones">intrinsic structure of a quadcopter</span> and <span class="redones">future modifications plans</span>. We had the <span class="redones">idea to integrate distribution board</span> with <span class="redones">flight controller board</span>, and, in the future, also to integrate <span class="redones">sensors and actuators board</span>.</p>

				<ul class="lists">
				<li>In my opinion, make a single, <span class="redones">high integrated board</span> will bring the following <span class="redones">benefits</span>:</li>
				<li><span class="redones">less</span> external <span class="redones">wirings</span></li>
				<li><span class="redones">better</span> overall and compact <span class="redones">package</span></li>
				<li><span class="redones">reduce frame and supports complexity</span> as we will use <span class="redones">one board instead of three</span></li>
				<li><span class="redones">reduce risks of wire cut by propellers</span></li>
				<li><span class="redones">reduce risk of wrong connections</span></li>
				<li><span class="redones">reduce overall weight</span></li>
				<li><span class="redones">reduce overall quadcopter volume</span></li>
				<li><span class="redones">reduce risks of wires disconnection during flight</span></li>
				</ul>

				<ul class="lists">
				<li>Summarizing, the design parameters for the bord were:</li>
				<li><span class="redones">space available</span> on the frame</li>
				<li><span class="redones">centralize IMU</span> connectors</li>
				<li>leave space for <span class="redones">adding components</span> for integrating sensors and actuators board</li>
				<li>leave space to fit this board (in Eagle) <span class="redones">inside distribution board</span> (made by Mattia)</li>
				<li>move to the <span class="redones">angles ESC signals pads</span></li>
				<li><span class="redones">eliminate unnecessary components</span> from satshakit, to obtain more board space and reduce complexity (power led and reset button)</li>
				<li><span class="redones">logically dispose group of pin headers</span> for easy usage and to reduce external wirings</li>
				</ul>

				<p>Considering all this thoughts, you can see the resulting board in the following pictures. This is <span class="redones">AAVOID v1 schematics</span>:</p>
				<img class="images-default" src="img/final_project/4.2/AAVOID_v1_schematics.png">

				<p>This time I used clear names and labels to easy identify components, and better realize where put them. Here is <span class="redones">AAVOID v1 board</span>:</p>
				<img class="images-default" src="img/final_project/4.2/AAVOID_v1_board.png">

				<p>Our IMU is a <a href="http://www.drotek.fr/shop/en/home/62-imu-10dof-mpu6050-hmc5883-ms5611.html"><span class="redones-link">Drotek 10DOF</span></a>, and it connects to flight controller via <span class="redones">I2C</span> bus. As you can see from the above picture, our IMU connectors on the board aren't perfectly at the center, due the fact that <span class="redones">connectors on the IMU aren't themselves centered</span>. You can see IMU connectors in the following picture:</p>

				<img class="images-default" src="img/final_project/4.2/imu.jpg">

				<p>So here it's the board on inkscape ready to be printed:</p>

				<img class="images-default" src="img/final_project/4.2/board_ink.png">

				<p>Finally, here is the soldered board ready to be mounted on the frame:</p>

				<img class="images-default" src="img/final_project/4.2/board.jpg">

				 <p>As you can see the holes on the board were adjusted to center the IMU on the frame. You can read more about this board and other things into <a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project6').innerHTML,'project6')" rel="lightbox" class="col-2"><span class="redones-link" style="font-weight: bold;">4.3 Teamwork: AAVOID v1</span></a> we <span class="redones"> section. We manage to fly</span> with this board.</p>

				 <p>Here is the download AAVOID v1 Eagle project: <a href="drawings/final_project/4.2/AAVOID_v1.rar"><span class="redones-link">AAVOID_v1</span></a>.</p>

			</div>
		</section>

		<section id= "project4" class="row">
			<div class="photo-grid">
				<p>Final project CAD design: <span class="redones">quadcopter foots</span>.</p>

				<p>As my final project partner <a href="http://fabacademy.org/archives/2015/eu/students/ciurnelli.mattia/index.html"><span class="redones-link">Mattia Ciurnelli</span></a> will do AAVOID quadcopter frame, I tried to design its <span class="redones">foots</span>.As first try, I was thinking about <span class="redones">something different</span> from the mains multicopter foot structures. I wanted to <span class="redones">mix design and functionality</span> by using upper part of the foots as a <span class="redones">joint</span>, to fix them on the frame without the need of anything else but eventually some glue. Also, this first version of the foots will be very strong, by crossing two parallepipeds. Here you can see pictures of the foots 3D model:</p>
				<img class="images-default" src="img/final_project/4.1/foot1_model.png">
				<img class="images-default" src="img/final_project/4.1/foot1_model2.png">

				<p>Due to the 3D model shapes, and because of the <span class="redones">lightness and robustness of PLA</span> I chosen to <span class="redones">3D print them</span>. Also I wasn't in need to have a very precise production, because foots aren't a fundamental quadcopter part. This version of the foot weights about 8 grams and require 44 minutes to be printed:</p>
				<img class="images-default" src="img/final_project/4.1/foot1_cura.png">

				<p>I <span class="redones">printed just one foot</span>, because of I wanted to try it before start a 4 hours print. The results was pretty good, except for minor superficial defect into the inside part. Here are some pictures about:</p>
				
				<img class="images-default" src="img/final_project/4.1/foot1_1.jpg">
				<img class="images-default" src="img/final_project/4.1/foot1_2.jpg">
				
				<p>So I tried to assemble them with the frame, and the dimensions of the joint were ok:</p>
				<img class="images-default" src="img/final_project/4.1/foot1_3.jpg">

				<p>But after, when I tried to put the motor I discovered that the foot won't let the motor fit:</p>
				<img class="images-default" src="img/final_project/4.1/foot1_4.jpg">

				<p>After this first attempt I decided to move towards a <span class="redones">more standard structure</span>. So this is the 3D model for the second version of the foots:</p>
				<img class="images-default" src="img/final_project/4.1/foot2_model.png">
				<img class="images-default" src="img/final_project/4.1/foot2_model2.png">

				<p>As you can see, also this time I wanted to use a joint to assemble foots on the frame, but this time the <span class="redones">joint its on the frame</span>. This require a lot less materials and time to be 3D printed:</p>

				<img class="images-default" src="img/final_project/4.1/foot2_cura.png">

				<p>Again I printed juest one foot. Here's a picture about:</p>
				<img class="images-default" src="img/final_project/4.1/foot2_1.jpg">	

				<p>This time the foot was perfect, will strongly fit without any glue, and also was very optimized in weight and fabrication time. Here are some pictures of AAVOID with the foots fitted:</p>

				<img class="images-default" src="img/final_project/4.1/drone_foot.jpg">			
				<img class="images-default" src="img/final_project/4.1/drone_foots.jpg">	

				<p>Here you can download the 3D models of the foots: <a href="drawings/final_project/4.1/foot_drone1.3dm.rar"><span class="redones-link">1st version</span></a>, <a href="drawings/final_project/4.1/foot_drone1.3dm.rar"><span class="redones-link">2nd version</span></a></p>

			</div>
		</section>

		<section id= "project6" class="row">
			<div class="photo-grid">
				<p>Final project teamwork: <span class="redones">AAVOID v1</span>.</p>
				<p>This section is the last final project section in which I've cooperated with <a href="http://fabacademy.org/archives/2015/eu/students/ciurnelli.mattia/index.html"></aside><span class="redones-link">Mattia Ciurnelli</span></a>.</p>
								
				<ul class="lists">
				<li>We've divided this section in the following main processes:</li>
				<li><span class="redones">Design considerations and decisions</span></li>
				<li><span class="redones">Soldering the board</span></li>
				<li><span class="redones">Assembly the quadcopter</span></li>
				<li><span class="redones">Configuration</span></li>
				<li><span class="redones">Results and thoughts</span></li>
				<li><span class="redones">Dowloads and specifications</span></li>
				</ul>

				<h3><span class="redones">-------------Design considerations and decisions-------------</span></h3>
				<p><br>There were alot of design considerations and decisions to be taken, and this just in order to hope that AAVOID will do <span class="redones">some simple jumps on the ground without destroy itself at first flight</span>. In order to synthesize, we will cover in this section the main ones.</p>

				<ul class="lists">
				<li>Here's the considerations:</li>
				<li>as <span class="redones">frame material</span> we need one that is a good <span class="redones">compromise between resistency, vibration absorption and price</span></li>
				<li>we need to future <span class="redones">integrate</span> several <span class="redones">sonar sensors and an Android smartphone</span></li>
				<li>we wanted to avoid as many as possible <span class="redones">external wirings</span></li>
				<li>we wanted a very <span class="redones">compact and simple shape</span></li>
				<li>to get <span class="redones">most precise readings from IMU</span></li>
				</ul>

				<ul class="lists">
				<li>And Here's the decisions:</li>
				<li><span class="redones">use 0.8mm plywood</span></li>
				<li><span class="redones">integrate flight controller board with distribution board</span></li>
				<li><span class="redones">put the IMU at center</span> and also aligned with motor basement</li>
				<li><span class="redones">put battery on top</span>, in order to leave space below, needed for future integration of an Android smartphone</li>
				<li><span class="redones">reduce the length of all the wires</span></li>
				<li>make and solder a <span class="redones">battery cable into the board</span></li>
				<li><span class="redones">solder ECSs power and signal cables</span></li>
				</ul>

				<p>You can read about solutions details we implemented, along all of this page.</p>

				<h3><span class="redones">---------------Soldering the board---------------</span></h3>
				<p><br>
				As starting step to build the <span class="redones">first prototype of AAVOID quadcopter</span> was to solder the board and step by step test all the traces and components. Everyone has proceeded to solder a board, having finally two of them, to reduce the probability of errors. The board was very <span class="redones">easy and quick to solder</span> due some unnecessary components was removed from the schematic, and there is plenty of <span class="redones">space for the future integration</span> of the sensors and actuators board. Here you can see a picture about the board layout just before it was printed with our fiber laser: </p>

				<img class="images-default" src="img/final_project/4.2/board_ink.png">

				<p>
				As you can see, the space where’s the name and the version of the board, it’s deliberately empty to <span class="redones">fit future components</span>. Together we started to solder the board and in a few minutes it was ready. We leave the endpoint connectors of the distribution board, as we needed to see how this first version will fit with the frame and the other physical parts. In the following picture, there is the soldered board:

				<img class="images-default" src="img/final_project/4.2/board.jpg">

				</p>
				<h3><span class="redones"><span class="redones">---------------Assembly the quadcopter---------------</span></h3>
				<p><br>
					As we wasn’t sure about the board mounting holes, we don’t let the laser completely cut them: we adjusted the holes with a dremel (as you can see in the picture above), after tried to fit the board in the frame, paying attention to the position of the IMU that should stay perfectly centered. Center the IMU was a fundamental step, that we prepared together by considering combining the positioning of the IMU connectors on the board and the hole for the IMU connectors on the the frame. We decided to put the IMU directly on top frame surface, and firmly block it with bi-adhesive scotch tape. This because we wanted to <span class="redones"> exploit the plywood surface finish</span>, to put the IMU in a <span class="redones">almost ground parallel position</span> and for taking it at the same level with motors basement. Here are some pictures about the IMU mounted on the frame:</p>

					<img class="images-default" src="img/final_project/4.3/imu_frame2.jpg">	
					<img class="images-default" src="img/final_project/4.3/imu_frame1.jpg">	
					<img class="images-default" src="img/final_project/4.3/imu_foots1.jpg">	
					<img class="images-default" src="img/final_project/4.3/imu_foots.jpg">	

					<p>After we found the right way to place the board and IMU we blocked the board at the frame directly using <span class="redones">screws on the wood</span>. Here’s you can see pictures about this process:</p>

					<img class="images-default" src="img/final_project/4.3/board_wood_screws.jpg">

					<p>And here is AAVOID v1 board mounted on the frame:</p>

					<img class="images-default" src="img/final_project/4.3/board_frame.jpg">
					<img class="images-default" src="img/final_project/4.3/board_frame1.jpg">
					<img class="images-default" src="img/final_project/4.3/board_frame2.jpg">

					<p>Once we finished mounting board and IMU on the frame, we started to add the other physical parts like <span class="redones">foots</span> and the upper structure, that are 3d printed. The foots are <span class="redones">blocked in the frame by using the predisposed holes</span> on it, and fit together becoming hard to remove. Here's some foots pictures, and relative frame joints:</p>

					<img class="images-default" src="img/final_project/4.3/foots.jpg">
					<img class="images-default" src="img/final_project/4.1/drone_foot.jpg">

						
					<p>The <span class="redones">upper structure</span>, instead, is attached on the frame using <span class="redones">screws and bolts</span>, and its function is to <span class="redones">cover and protect the IMU</span>, <span class="redones">and to hold the battery</span>. Here you can see the upper structure mounted on the frame:</p>

					<img class="images-default" src="img/final_project/4.3/imu_battery_holder.jpg">
					<img class="images-default" src="img/final_project/4.3/imu_battery_holder1.jpg">

					<p>Also, the sides of the quadcopter is actually very thin:</p>

					<img class="images-default" src="img/final_project/4.3/quadcopter_side.jpg">

					<p>After we put the battery, we weren't sure about the IMU will stay fixed with the frame while the quadcopter is flying. So, to stay safer, we used a square <span class="redones">piece of cardboard</span> to further block the IMU with the battery:</p>	

					<img class="images-default" src="img/final_project/4.3/imu_paper.jpg">

					<p>The next steps in assembly AAVOID quadcopter were to <span class="redones">add ESCs and motors</span>. ESCs were attached to frame arms with <span class="redones">cable ties</span>, and connected to board for power supply and signal. We decided to <span class="redones">solder all of these connections</span> to avoid in-fly dangerous disconnections:</p>

					<img class="images-default" src="img/final_project/4.3/esc_solder.jpg">

					<p>After the ESCs were all in place, we continued with motors. <span class="redones">Motors are fixed with 4 10mm bolts</span> directly on the motors platform, placed at the end of each frame arm. Because of the motors are the <span class="redones">most stressed part</span>, as they bring movements to the quadcopter, we apply one <span class="reodnes">washer to each bolt</span>:</p>

					<img class="images-default" src="img/final_project/4.3/motor_fix.jpg">

					<p>The next step was to test and configure the quadcopter, in order to do this <span class="redones">we didn’t mount propellers</span>, as they could be dangerous if they rotate near us.

					</p>
					<h3><span class="redones"><span class="redones">---------------Configuration---------------</span></h3>
					<p><br>
					The first thing we did, was to verify if the board works correctly. To start testing the board we tried to power it with 5V, to see if there was some smoke. As Daniele didn’t put the power led, to know if the board was really switched on, we needed to program it. So, due to the fact that luckily there <span class="redones">wasn’t any smoke</span>, we tried to program the board with an <span class="redones">Arduino as ISP</span>.</p>

					<img class="images-default" src="img/final_project/4.3/board_programming.jpg">

					<p> Also this step was passed, as the board was programmed flawlessly. As final step in programming the board we <span class="redones">uploaded MultiWii</span>, setting in the <span class="redones">“config.h”</span> file type of multicopter and IMU, by uncommenting the corresponding lines:</p> 

					<img class="images-default" src="img/final_project/4.3/multiwii1.png">
					<img class="images-default" src="img/final_project/4.3/multiwii2.png">

					<p>Here's a video about the <span class="redones">Multiwii working on AAVOID v1 board</span>:</p>

					<iframe width="700" height="450" src="https://www.youtube.com/embed/J8oPGxUSLbI" frameborder="0" allowfullscreen></iframe>

					<p><br>As you can see in the video, <span class="redones">IMU and board worked fine</span>, but the accelerometer, the gyro and the magnetometer were not calibrated. As further test we tried the <span class="redones">connection between smartphone and the board</span>, using <span class="redones">USB OTG cable</span>, in order to visualize the <span class="redones">IMU data on the smartphone screen</span>, and also this test was good. Due to the future integration of an Android smartphone on AAVOID, this test was a fundamental one to prove that <span="redones">communications between Androd and Multiwii are possible</span>. The Android app I used is <a href="https://play.google.com/store/apps/details?id=com.ezio.multiwii&hl=it"><span class="redones-link">EZ-GUI ground station</span></a>.</p>

					<iframe width="700" height="450" src="https://www.youtube.com/embed/NPf7IKyEKg0" frameborder="0" allowfullscreen></iframe>
					
					<p><br>Next steps were to <span class="redones">test motors and ESCs</span>, and, as required intermediate steps, add <span class="redones">radio receiver</span>, and configure the <span class="redones">arming of the quadcopter</span>. Due we’ve a <span class="redones">5-channel radio control</span>, and to the fact that the <span class="redones">fifth channel</span> isn’t strictly needed to fly, we used <span class="redones">this channel as input for arming/disarming</span> the quadcopter. We set as arming signal an high level of this channel. Receiver wirings were made with very short cables, as you can see from the below picture:</p>

					<img class="images-default" src="img/final_project/4.3/receiver.jpg">

					<p>After was connected we <span class="redones">manually adjusted max-min receiver signal</span>, in order to use with the right proportions of the receiver stick's movements. After the radio control was setup, we tested motor rotations. As you may know, a <span class="redones">X quadcopter</span> need to rotate propellers in the following way:</p>


					<img class="images-default" src="img/final_project/4.3/propellers_config.png">

					<ul class="lists"><li>Final steps in configuration were to calibrate magnetometer and accelerometer. In order to <span class="redones">calibrate accelerometer</span> here are the instructions (from <a href="http://www.multiwii.com/wiki/index.php?title=Calibration_Accelerometer"><span class="redones-link">MultiWii wiki</span></a>):</li>

    				<li>Place your MULTI on a flat leveled surface</li>
    				<li>Connect your MULTI to your Multiwii GUI</li>
    				<li>Press the calib_mag button in your Multiwii GUI to start the calibration</li>
    				<li>Wait a few secounds. Do not move your copter during this</li>
    				<li>Check your sensors directions</li>
					</ul>

					<ul class="lists">
						<li>Different procedure was needed to <span class="redones">calibrate magnetomer</span>:</li>
						<li>Press the calib_mag button in your Multiwii GUI</li>
						<li>Rotate 360 degree around yaw axis for x, y calibration.</li>
    					<li>Rotate 360 degree around pitch axis for y z calibration.</li>
    				    <li>Rotate 360 degree around roll for x z calibration.</li>

					</ul>
					
					<p>At this point AAVOID v1 was <span class="redones">ready to fly</span>! We added olny some scotch tape in order to fix some moving parts. Here are some pictures of AAVOID v1 just before the first flight:</p>

					<img class="images-default" src="img/final_project/4.3/AAVOID1.jpg">
					<img class="images-default" src="img/final_project/4.3/AAVOID2.jpg">
					<img class="images-default" src="img/final_project/4.3/AAVOID3.jpg">

<h3><span class="redones"><span class="redones">---------------Results and thoughts---------------</span></h3>

		<p><br><span class="redones">AVVOID v1 managed to fly!</span> Here's a video of one the <span class="redones">first flights</span>:</p>
					<iframe width="700" height="450" src="https://www.youtube.com/embed/JLgGLL2r4ZU" frameborder="0" allowfullscreen></iframe>

		<p><br>Another great result was weight, as you can see from the following picture, <span class="redones">AAVOID v1 weights only 449 grams</span>. This is good to be able to add other weights in the future, such as the Android smartphone.</p>


		<img class="images-default" src="img/final_project/4.3/weight.jpg">
		

		<p>As you can see AAVOID still not fly perfectly. We think this happened because we <span class="redones">left default flight mode of MultiWii set to ACRO</span>. From what we've read from Multiwii documentation, this flight mode is useful for "performing acrobatics (tight turns, flips, etc)" and also uses only the <span class="redones">gyroscope</span>. Another consideration about flight is relative to choice to <span class="redones">put the battery to the top</span> instead of placing it under the frame, that could have been caused further flight instability. These consideration could explain why AAVOID v1 was so reactive to the transmitter sticks.</p>

		<p>As we and other fellow students really enjoyed these flights, we ended up in a crash, useful for us to point out 
		frame fragility. In fact in this crash the <span class="redones">frame broke in one of its weak points</span>:
</p>
		<img class="images-default" src="img/final_project/4.3/broke1.jpg">
		<img class="images-default" src="img/final_project/4.3/broke2.jpg">

		<p>Even the propellers were broken in the crash, as they was the first thing that touched the ground:</p>

		<img class="images-default" src="img/final_project/4.3/broken_propeller.jpg">

		<p>So for future flights, we are thinking about a more <span class="redones">solid frame</span> and some sort of <span class="redones">propellers protection</span>.</p>

		<ul class="lists">
					<li>Talking about wiring and <span class="redones">flight controller and distribution board</span>, we pinned the following modification to be made in the next version:</li>
					<li>add two 10uF capacitor to the distribution board in order to stabilize the power supply</li>
					<li>rotate also the bottom left ESC pads</li>
					<li>make the board larger to be firmly blocked by the 3D printed supports structure</li>
					<li>add another GND for board Multiwii Uploading (I soldered a pin on the fly to be able to program it)</li>
					<li>add another RESET pin (I soldered a pin on the fly to be able to use reset)</li>
					<li>reorder ESC signals pad, as they were mirrored</li>
					<li>maybe add add a switch to power on and off the quadcopter without remove the batter</li>
					</ul>


<h3><span class="redones"><span class="redones">---------------Downloads and specifications---------------</span></h3>

<p>We decided to separate fabbed parts from bought parts. This because we want to show <span class=redones>how much of AAVOID v1 is digital fabricated</span>.</p>

<ul class="lists">
<li>AAVOID v1 <span class="redones">fabbed parts list</span>:</li>
<li>flight and distribution board</li>
<li>250mm frame</li>
<li>foots</li>
<li>battery holder (upper structure)</li>
</ul>

<ul class="lists">
<li>AAVOID v1  <span class="redones">bought</span> parts list:</li>
<li>3S 11.1V 1300mah LiPo battery</li>
<li>4 x 12A Afro ECS’s</li>
<li>4 x 2150kv 2206 Multistar brushless motors</li>
<li>Drotek 10DOF IMU</li>
<li>AR610 6 channel Spektrum receiver</li>
<li>DX5E 5 channel Spektrum transmitter</li>
<li>4 x carbon fiber 6030 propellers</li>
</ul>

<ul class="lists">
	<li>Here are all <span class="redones">AAVOID v1 downloads</span>: </li>
	<li><a href="drawings/final_project/4.3/upper_structure.3dm.rar"><span class="redones-link">upper structure</span></a></li> 
	<li><a href="drawings/final_project/4.2/AAVOID_v1.rar"><span class="redones-link">AAVOID v1 board</span></a></li>
<li><a href="drawings/final_project/4.1/foot_drone2.3dm.rar"><span class="redones-link">foots</span></a></li> 
<li><a href="drawings/final_project/4.3/AAVOID_v1_frame.3dm.rar"><span class="redones-link">frame</span></a></li>
</ul>

			</div>
		</section>

		<section id= "project7" class="row">
			<div class="photo-grid">
				<p>Returning solo: <span class="redones">cooperation considerations</span>.</p>
				<p>After cooperating for about a week with <a href="http://fabacademy.org/archives/2015/eu/students/ciurnelli.mattia/index.html"><span class="redones-link">Mattia Ciurnelli</span></a>, I thought some cooperation considerations. <span class="redones">Live a situation</span>, instead of just talking of it, could bring things that you <span class="redones">never expected</span>. In this case, for me, the main problem was that Mattia <span class="redones">completely abandoned its project</span> in favour of mine AAVOID quadcopter. In my opinion this caused from the beginning problems to me that <span class="redones">not wanted to change nothing</span> from an idea matured in several months. Mattia always proposed several <span class="redones">interesting frame structures and materials</span>, that could be very innovative, but don't follow my main idea of a smart quadcopter. So we decided to fork the quadcopter development in <span class="redones">two different directions: I will continue to AAVOID and Mattia will better develop the physical structure creating a different quadcopter</span>.</p>

			</div>
		</section>

		<section id= "project8" class="row">
			<div class="photo-grid">
				<ul class="lists"><li>In this section I will cover the <span class="redones">strucure improvements</span> made for <span class="redones">AAVOID v2</span>. These improvements were driven  by the firsts flight experiences (in which a bad landing caused a broken frame) and by the scheduled development of trying <span class="redones">adding a smartphone onboard</span>. In this direction I thought about the following considerations:</li>
				<li>I need a more <span class="redones">robust frame</span></li>
				<li>frame needs to have <span class="redones">more space</span> in oder to have the possibility to <span class="redones">attach new supports</span></li>
				<li>I want to <span class="redones">keep a simple design</span> without adding new materials other than wood</li>
				<li><span class="redones">smartphone must be safe</span> placed, so it will not easily broke in case of crash</li>
				<li>I will use <span class="redones">plastic ties</span> to easily but firmly block the smartphpone</li>
				<li>supports must also <span class="redones">enclose radio module</span></li>
				<li>with the esclusion of the battery, and for balancing reason, I wanted to <span class="redones">put everything below the frame</span></li>
				<li>the 3D printed <span class="redones">battery enclosure takes too much time to be 3D printed</span></li>
				<li>I could use again the <span class="redones">glue to attach the foots</span></li>
				<li>I could use <span class="redones">screws and whashers</span> to quickly assemble/disassemble frame parts</li>
				</ul>
				
				<p>So, with these considerations in minds, I started design all the pieces with <span class="redones">Rhino</span>. First I redesigned the <span class="redones">frame</span>. Here is screenshot of the new frame compared to old one (new frame on the left):</p>
				<img class="images-default" src="img/final_project/5.1/frame_new.png">
				<ul class="lists">
					<li>As you can see from the screenshot, here are <span class="redones">differences between frames</span>:</li>
					<li><span class="redones">wider</span> motor <span class="redones">arms</span>, to obatin a <span class="redones">compromise</span> in strengthen the frame without limit too much props thrust</li>
					<li><span class="redones">smaller motor holes</span>, in order to strengthen motor-frame attachment</li>
					<li><span class="redones">rotated motor wires holes</span>, to have more wood laterally</li>
					<li><span class="redones">added 4 four lateral, rectangular holes</span> for down mounted supports</li>
					<li>enlarged the <span class="redones">space between foots mounting holes</span>, in order to mount large foots</li>
					<li><span class="redones">added two rectangualr holes</span> to mount upper battery supports</li>
					<li><span class="redones">removed holes for screws</span> as I will fix them directly on the wood</li>
				</ul>

				<p>Accordingly with the new frame I designed also the following supports. <span class="redones">Down mounted supports</span> for the donw side of drone, useful to <span class="redones">enclose radio receiver and attach the smastphone</span>:</p>

				<img class="images-default" src="img/final_project/5.1/down_supports.png">

				<p>To firmly block these supports, and maybe fix with plastic ties some other things, I designed also a <span class="redones">down supports conjunction</span>:</p>
				
				<img class="images-default" src="img/final_project/5.1/conjunction.png">

				<p>These are the <span class="redones">battery holders</span>. I thought about these to be used with plastic ties:</p>

				<img class="images-default" src="img/final_project/5.1/battery_holders.png">


				<p>In order to reinforce more the central part of the frame, and to enclose <span class="redones">IMU</span>, I designed also another part, to be put on top, the <span class="redones">upper frame</span>:</p>

				<img class="images-default" src="img/final_project/5.1/upper_frame.png">

				<p>To realize all of these parts, I used again our <span class="redones">laser cutter machine</span> and <span class="redones">8mm plywood</span> for all the parts, with the esclusion of upper frame, for which I used <span class="redones">4mm plywood</span>. Here are the parts just before they were cut:</p>

				<img class="images-default" src="img/final_project/5.1/all_parts.png">

				<p>And here's the part just after they were laser cut:</p>

				<img class="images-default" src="img/final_project/5.1/cut_all_parts.jpg">

				<p>That was the time to assemble all the parts together, in oder to obtain the <span class="redones"> complete structure</span>:</p>

				<img class="images-default" src="img/final_project/5.1/ass_1.jpg">
				<img class="images-default" src="img/final_project/5.1/ass_2.jpg">
				<img class="images-default" src="img/final_project/5.1/ass_3.jpg">
				<img class="images-default" src="img/final_project/5.1/ass_4.jpg">

				<p>As said in the above considerations, I redesigned also quadcopter foots. This because I needed <span class="redones">more height</span> to fit new supports and smartphone. Also, this time I <span class="redones">resize foots</span> to be larger, in order to obtain <span class="redones">more resistance</span>. So here are new foot compared to the previous one (new foot is the bigger one):</p>

				<img class="images-default" src="img/final_project/5.1/new_foots.png">

				<p>As before, I 3D printed the foots, and used some <span class="redones">glue</span> to attach them to the frame. Here is the new foot just after it was print:</p>

				<img class="images-default" src="img/final_project/5.1/new_foots.jpg">

				<p>Finally, here you can dowload the new structure and the new foots: <a href="drawings/final_project/5.1/AAVOID_frame_and_foots.3dm.rar"><span class="redones-link">download</span></a>.</p>


			</div>
		</section>

		<section id= "project9" class="row">
			<div class="photo-grid">
				<p>Here I will talk about the <span class="redones">new board</span> for <span class="redones">AAVOID v2</span>. As said in previous section <a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project5').innerHTML,'project5')"><span class="redones-link">4.2 Electronics: flight controller</span></a>, AAVOID board will have <span class="redones">two Atmega328 microcontrollers</span>. This because one of them serves as flight controller with <a href="http://www.multiwii.com/"><span class="redones-link">MultiWii</span></a>, and the other for <span class="redones">AutoPilot, to read data sensors and to communicate with smartphone</span>. So this time the goal was to <span class="redones">fly with two microcontroller</span> onboard, and to <span class="redones">improve the existing AAVOID v1 board</span>. To be noted that, during the design of AAVOID v1 board, <span class="redones">I purposely left space to fit the other microntroller</span>. Microncontrollers will have each <span class="redones">separated components</span>, with the <span class="redones">esclusion of power stabilizers capacitors</span>. Also, microcontrollers will share the same power, coming from the <span class="redones">7805 voltage regulator</span>. Apart these small modifications, the board <span class="redones">can be considered as a dual satshakit board</span>, as the electronic design of <span class="redones">a single board is equal to the satshakit</span>.</p> 

				
				<p>So I started to change the <span class="redones">AAVOID v1 Eagle schematic</span>:</p>

				<img class="images-default" src="img/final_project/4.2/AAVOID_v1_schematics.png">

				<p>In order to <span class="redones">add the second microcontroller</span>. Here is <span class="redones">AAVOID v2 Eagle schematic</span>, with added the new components:</p>

				<img class="images-default" src="img/final_project/5.2/new_schematic.png">


				<p>Once I designed new schematic, it was time to <span class="redones">change Eagle board accordingly</span>. Again I started from the <span class="redones">AAVOID v1 Eagle board</span>:</p>
				<img class="images-default" src="img/final_project/4.2/AAVOID_v1_board.png">

				<p>To obtain <span class="redones">AAVOID v2 Eagle board</span>, containing all of the new componentes I've added to the schematic:</p>

				<img class="images-default" src="img/final_project/5.2/new_board.png">

				<p>To produce the board I followed the usual procedure we used in the past, in which <span class="redones">we engraved FR4 fiber glass boards</span> with a <span class="redones">fiber laser cutter machine</span>. The first thing to do was to export top and pads as a PNG from Eagle:</p>

				<img class="images-default" src="img/final_project/5.2/AAVOID_v2.png">

				<p>And then continue editing it with <span class="redones">Inkscape</span>, in order to use new colors for cut boarders, and to make pin headers holes:</p>
				<img class="images-default" src="img/final_project/5.2/inskscape_board.png">

				<p>So here it's the board, just after it was engraved by fiber laser, and ready to be soldered:</p>
				<img class="images-default" src="img/final_project/5.2/board.jpg">

				<p>And finally, here's the board with all the <span class="redones">components soldered on it</span>:</p>
				<img class="images-default" src="img/final_project/5.2/board_soldered.jpg">

				<p>To clear uo a bit, on <span class="redones">which microcontroller will manage what</span>, here is a simple explanation picture:</p>
				<img class="images-default" src="img/final_project/5.2/board_schema.jpg">

				<p>Here you can download Eagle project and Inkscape svg of AAVOID v2 board: <a href="drawings/final_project/5.2/AAVOID_v2.rar"><span class="redones-link">download</span></a>.</p>

			</div>
		</section>

		<section id= "project10" class="row">
			<div class="photo-grid">
				<ul class="lists"><li>Here you will find information about <span class="redones">AAVOID v2 assembly and tests</span>. Assembling AAVOID v2 was quite easy, due the already done experience in <a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project6').innerHTML,'project6')"><span class="redones-link">4.3 AAVOID v1: teamwork</span></a>. Basically <span class="redones">I had to use all the new parts</span>, such as board, frame, supports and foots. The <span class="redones">objectives</span> I wanted to reach with this new version were the following:</li>

				<li>obtain a very <span class="redones">stable flight</span></li>
				<li>fly with <span class="redones">two working microcontrollers onboard</span></li>
				<li>fly with an <span class="redones">onboard smartphone</span></li>
				<li>test the <span class="redones">overall robustness</span> of the new frame, foots and supports</li>
				<li>test the <span class="redones">reliability of the new board</span></li>
				<li>test <span class="redones">new kinds of propellers</span></li>
				</ul>


				<p>Here you can see a picture about the <span class="redones">assembled AAVOID v2 structure</span>:</p>

				<img class="images-default" src="img/final_project/5.3/structure.jpg">

				<p>Also, here is the structure with the <span class="redones">board mounted</span> on it:</p>

				<img class="images-default" src="img/final_project/5.3/structure_board.jpg">

				<p>Talking about the board, I loaded the previous configured <a href="http://www.multiwii.com/"><span class="redones-link">MultiWii</span></a> used for AAVOID v1, <span class="redones">into one of the microcontrollers</span>. The difference was that this time I used <span class="redones">ANGLE flight mode, instead of the previous ACRO</span>. In fact as stated in <a href="https://flyingeinstein.com/index.php/tutorials/enabling-flight-modes"><span class="redones-link">this website</span></a>, ANGLE is the flight mode "where the copter's control system and sensors keep the copter level with reference to the direction of gravity", while ACRO "is really just flying without any features enabled; this is where you are in the most control of the flight response". The motivation behind the choice to use ANGLE flight mode was related to fact I wanted a very stable flight.  To simply verify that also the <span class="redones">other microcontroller was working</span>, I uploaded the <span class="redones">Blink example</span> of Arduino IDE. This test <span class="redones">was successful</span>. After this test I tried also some <span class="redones">serial communications examples</span>, again from Arduino IDE. This time <span class="redones">the test failed</span>. In fact, serial console was receiving almost unreadable characters. <span class="redones">Powering the board apart</span> I discovered that the board <span class="redones">was ok</span>, and the problem was related to the  <span class="redones">7805 voltage regulator</span>. So I <span class="redones">disabled the second microcontroller</span> during the fly tests.</p>

				<p>Here you can see severeal pictures of an assembled AAVOID v2 prototype. This time I used also <span class="redones">plastic 6030 propellers</span>:</p>

				<img class="images-default" src="img/final_project/5.3/AAVOID_v2_1.jpg">
				<img class="images-default" src="img/final_project/5.3/AAVOID_v2_2.jpg">
				<img class="images-default" src="img/final_project/5.3/AAVOID_v2_3.jpg">
				<img class="images-default" src="img/final_project/5.3/AAVOID_v2_4.jpg">
				<img class="images-default" src="img/final_project/5.3/AAVOID_v2_5.jpg">
				<img class="images-default" src="img/final_project/5.3/AAVOID_v2_6.jpg">
				<img class="images-default" src="img/final_project/5.3/AAVOID_v2_7.jpg">

				<p>To be noted the <span class="redones">plastic ties</span> to block smartphone and battery. To <span class="redones">avoid destroy a smartphone</span>, as these are the first fly tests with it onboard, <span class="redones">I used an old and broken one</span>. However, this smartphone was very similar, in weight and dimensions to the one I wanted to use later.</p>
					
				<p>At this was point was the time to do some <span class="redones">real fly tests</span>. These test was very good, as you can see <span class="redones">I stressed several aspect of flying</span> such as: <span class="redones">stability</span> with medium wind and a cup of water on it, <span class="redones">overall performances and electronics reliability</span> with very hard turns and with the load of the smartphone. Here are the videos about:</p>

				<iframe width="700" height="450" src="https://www.youtube.com/embed/H54l0PhV-Hk" frameborder="0" allowfullscreen></iframe>
				<iframe width="700" height="450" src="https://www.youtube.com/embed/FrCRy8Wi_UQ" frameborder="0" allowfullscreen></iframe>
				<iframe width="700" height="450" src="https://www.youtube.com/embed/2PrbweWn0ns" frameborder="0" allowfullscreen></iframe>
				<iframe width="700" height="450" src="https://www.youtube.com/embed/7gvb79VRCpE" frameborder="0" allowfullscreen></iframe>
				<iframe width="700" height="450" src="https://www.youtube.com/embed/mlyDfJ9ZATc" frameborder="0" allowfullscreen></iframe>

				<ul class="lists"><li><br>After these fly tests, these are <span class="redones">considerations about AAVOID v2</span>:</li>
				<li>the fly <span class="redones">was very stable</span></li>
				<li>the electronics (with one micontroller) was very <span class="redones">reliable</span></li>
				<li>I need to try to <span class="redones">power the second microcontroller from one of the ESCs</span></li>
				<li><span class="redones">plastic propellers give more stability and soft command responses</span> than carbon fiber ones, in contrast they reduce agility and battery life</li>
				</ul>

				<p>I will try to resolve the second microcontroller problems, and to implement the other scheduled features with the development of <span class="redones">AAVOID v3</span>. At this point of the development, I build another AAVOID version, <span class="redones">keeping this as a backup</span> in case of crash. To do this I made new frame supports to be compatible also with this version of the frame.</p>

			</div>
		</section>

		<section id= "project11" class="row">
			<div class="photo-grid">
				<p>As one the first steps in developing <span class="redones">AAVOID v3</span> I wanted to resolve the board <span class="redones">power problems</span> and add to it <span class="redones">add some improvements</span>. I have to admit that, at this point of the development, <span class="redones">the board was the last obstacle</span> to finally start in developing some <span class="redones">smart features of AAVOID</span>. In fact <span class="redones">I spent alot of time</span>, and <span class="redones">I made alot of board revisions</span>, in order to obtain a <span class="redones">perfect one for my needs</span>. Just to have an idea, here's a <span class="redones">picture of all the board I've tested</span>, that respectevely corresponds to the number of revisions I made. And they're not all if you count also other two boards, actually installed in two AAVOID prototipes. From the <span class="redones">oldest (left)</span> to the <span class="redones">newest (right)</span>:</p>
				
				<img class="images-default" src="img/final_project/6.1/boards.jpg">

				<p>The first revision I did for AAVOID v3 <span class="redones">eliminates the 7805 voltage regulator</span>, in favor of <span class="redones">powering the two ATMega328P microcontrollers via two of the ESCs BEC</span>. Also, this time, I wanted to give <span class="redones">separated power stabilizers capacitors</span>, in order to further <span class="redones">improve electronics reliability during flight</span>. Here you can see some pictures about this new board, just after laser engraving, I soldered all the components and I installed it onto AAVOID v3: </p>

				<img class="images-default" src="img/final_project/6.1/boardv1_1.jpg">
				<img class="images-default" src="img/final_project/6.1/boardv1_2.jpg">
				<img class="images-default" src="img/final_project/6.1/boardv1_3.jpg">

				<p>With this board, and power from ECSs BEC, also <span class="redones">the other microcontroller was fully working</span> with only the power from the battery. However, when I did some <span class="redones">stress tests on full load</span> (smartphone plus new supports and sensors), I had another problem, one of the <span class="redones">power board traces exploded and I had serious crash</span>. In the test I put the throttle at the lowest level, when the quadcopter was at about 10 meters of altitude. When it was falling just at 1 meter from the ground I gave it full throttle. In that moment a <span class="redones">lot of current passed through power board traces</span>, as the <span class="redones">motors passed from idle to maximum power</span>. Here you can see a picture of the exploded trace:</p>
				<img class="images-default" src="img/final_project/6.1/exploded.jpg">

				<p>To make things worse, <span class="redones">with sonars</span>, I discovered also <span class="redones">another problem</span>. In fact, in order to have a decent read resfresh rate from them, I needed also the <span class="redones">analog pins to be usable from the AutoPilot microcontroller (upper right one)</span>. So in the final board revision I enlarged the power board traces, <span class="redones">doubling their size</span>, and also <span class="redones">added pin headers for the analog pins</span> of the second microcontroller.</p>

				<p>So finally <span class="redones">I made it</span>, these are Eagle schematic and board of the last AAVOID board revision. <span class="redones">This board is exactly what I need to go further with AAVOID development</span>.</p>

				<img class="images-default" src="img/final_project/6.1/schematic_final.png">
				<img class="images-default" src="img/final_project/6.1/board_final.png">

				<p>As usual here are the PNG exported from Eagle and respective edited SVG with Inkscape:</p>

				<img class="images-default" src="img/final_project/6.1/eagle_png.png">
				<img class="images-default" src="img/final_project/6.1/inkscape.png">

				<p>And here's the <span class="redones">next steps</span>, laser engraved FR4 board, and soldered and installed onto <span class="redones">AAVOID v3</span>:</p>
				<img class="images-default" src="img/final_project/6.1/board_final.jpg">

				<img class="images-default" src="img/final_project/6.1/board_final_installed.jpg">

				<p>Also, if you want to see where to connect things, here's an <span class="redones">explanation schema</span>:</p>
				<img class="images-default" src="img/final_project/6.1/connection_schema.jpg">

				<p>Here you can download AAVOID v3 Eagle project, exported PNG and Inkscape SVG: <a href="drawings/final_project/6.1/AAVOID_v3.rar"><span class="redones-link">download</span></a>.</p>

			</div>
		</section>

		<section id= "project12" class="row">
			<div class="photo-grid">
				<ul class="lists"><li>Here are <span class="redones">last AAVOID structure updates</span>, the making of <span class="redones">sonar supports</span>. These supports will be useful to <span class="redones">attach 6 sonars sensors to AAVOID</span>. These were the thoughts for designing sonar supports:</li>
				<li>similar to AAVOID frame and other supports I want to <span class="redones">keep these supports as much simple as possible</span></li>
				<li>I <span class="redones">don't want</span> to add too <span class="redones">much weight to AAVOID</span></li>
				<li>these support will be <span class="redones">compatible with the actual version of the frame</span>, ensuring that an <span class="redones">AAVOID v3 could become an AAVOID v2</span> at any time (<span class="redones">modular structure</span>)</li>
				<li>as the <span class="redones">sonars have a certain area of sensing</span>, they could be placed a <span class="redones">little decentered</span></li>
				<li>sonar sensors could be attached <span class="redones">directly on the wood with just one screw</span></li>
				</ul>

				<p>With these constraints in mind, I started in designing sonars supports. For the <span class="redones">front, rear, backwards, right and left sensors</span> here's a screenshot of <span class="redones">what comes out</span>. Again I used <span class="redones">Rhino</span> to design these:</p>
				<img class="images-default" src="img/final_project/6.2/under_supports.png">

				<p>The support in the bottom part of the picture will be mounted in place of one of the previous <span class="redones">down mounted supports</span>. These new supports are interchangeable with the old one, realizing a modular system, that <span class="redones">can be used as an AAVOID v2 or an AAVOID v3 structure</span>. In a similar way, the support in the top part of the picture, will substitute the previous <span class="redones">down supports conjunction</span>. The shown supports will realize a sort of cross, on which tips attach the aforementioned sensors. For the <span class="redones">upper sonar sensor</span>, I decided to make a simple strucure, that was again interchangeable with the previous <span class="redones">battery holders</span>:</p>				
				<img class="images-default" src="img/final_project/6.2/upper_supports.png">

				<p>In this case the sonar will be attached at the bar on the upper side. For <span class="redones">bottom sonar sensor</span>, I didn't designed anything, as I was thinking about mounting it directly on one of the <span class="redones">down mounted supports</span>. Mixing new parts with the actual frame, and some of the older parts (to avoid wood waste), here's <span class="redones">all the AAVOID v3 structure parts</span>, ready to be cut with our laser cutter machine:</p>
				<img class="images-default" src="img/final_project/6.2/all_parts.png">
				<p>So here are all the <span class="redones">AAVOID v3 parts</span> just after they were cut:</p>
				<img class="images-default" src="img/final_project/6.2/parts_cut.jpg">


				<p>In similar way I did for <span class="redones">AAVOID v2</span> structure, here you can see some pictures about the <span class="redones">AAVOID v3 structure assembled</span>:</p>
				<img class="images-default" src="img/final_project/6.2/structure_v3_1.jpg">
				<img class="images-default" src="img/final_project/6.2/structure_v3_2.jpg">
				<img class="images-default" src="img/final_project/6.2/structure_v3_3.jpg">


				<p>Here you can download AAVOID v3 structure: <a href="drawings/final_project/6.2/AAVOID_v3_structure.3dm.rar"><span class="redones-link">download</span></a>.</p>

			</div>
		</section>

		<section id= "project13" class="row">
			<div class="photo-grid">
				<p>This part of the final project will cover <span class="redones">choices and tests of sonar sensors to be used on AAVOID v3</span>. After alot of Internet searching and speaking to different people, <a href="http://www.maxbotix.com/"><span class="redones-link">MaxBotix</span></a> seemed the company that could have in its catalog sonars sensors I would need. In fact their sonars are <span class="redones">widely used for many fields</span>, in which is possible to find also <span class="redones">UAV applications</span>. Following their <a href="http://www.maxbotix.com/SelectionGuide/Selection-Guide.htm"><span class="redones-link">sensor selection guide</span></a>, they suggest, for a <span class="redones">protected environment and for UAV use</span>, the <a href="http://www.maxbotix.com/Ultrasonic_Sensors/MB1240.htm"><span class="redones-link">MaxSonar MB1240</span></a>:</p>

				<img class="images-default" src="img/final_project/6.3/ultrasonic_sensor.jpg">

				<p>This sensor is also used by <a href="https://store.3drobotics.com/products/MB1240-XL-MaxSonar-EZ4"><span class="redones-link">3DRobotics</span></a>, and its best feature is <span class="redones">noise tolerance</span>. Reading <a href="http://www.maxbotix.com/documents/XL-MaxSonar-EZ_Datasheet.pdf"><span class="redones-link">MaxBotix MaxSonar MB1240 datasheet</span></a>, these are the main features of XL MaxSonar® EZ™ Series:</p>
				<img class="images-default" src="img/final_project/6.3/features.png">
				<p>And, as said before, the MB1240, is one <span class="redones">of the best for noise tolerance</span>:</p>

				<img class="images-default" src="img/final_project/6.3/glance.png">

				<p>As you can read from the previous picture, <span class="redones">noise tolerance is inversely proportional to the beam pattern width</span>. So, I doubted that, if I will use the MB1240, there could be some <span class="redones">blind spots</span> in obstable detection. To solve this doubt, and to try <span class="redones">using the wider beam pattern available, I tried also the MB1260 and MB1200</span> sonar sensors, that are the <span class="redones">opposite in terms of main features</span>, as they offer wider beams and high sensitivity.</p> 

				<ul class="lists"><li>Talking about <span class="redones">how to use these sensors</span>, there are different ways whereby you can read distance data:</li>
				<li><span class="redones">serial</span> communication</li>
				<li><span class="redones">analog</span> output</li>
				<li><span class="redones">PWM</span> output</li>
				</ul>

				<ul class="lists"><li>Concluding thoughts about choices of sonar sensors, <span class="redones">I will test the following MaxBotix sensors</span>:</li>
				<li><span class="redones">MB1240</span></li>
				<li><span class="redones">MB1200</span></li>
				<li><span class="redones">MB1260</span></li>
				</ul>

				<p>The first test I did, was to <span class="redones">read sonar data via PWM output</span>. I did this test with a <span class="redones">single sonar sensor</span>, to be able to compare results from the different models I was testing. So I <span class="redones">soldered one sonar at time to pin 8</span> of the AutoPilot satshakit microcontroller of the AAVOID v3 board. Also, I wrote the following <span class="redones">sketch to read via serial the sonar distance data</span>:</p>

				<pre class="prettyprint lang-c">
//REAR
const int rearPwPin = 8;
long rearPulse, rearCm;

const int BAUD_RATE = 9600;
const int SAMPLE_RATE = 10;

void setup() {
 
  //init serial
  Serial.begin(BAUD_RATE);
  
    //set pin modes
  pinMode(rearPwPin, INPUT);
  
}

void loop() {

  //read sensors values
  rearPulse = pulseIn(rearPwPin, HIGH);
  
  //convert values
  rearCm = rearPulse/58;
  
  //send data to serial
  Serial.print("RE");
  Serial.print(rearCm);
    
  Serial.println();
  
  delay(SAMPLE_RATE);
 
} 
				</pre>

				<ul class="lists"><li><br>This test was done <span class="redones">indoor and without propellers</span>. In these conditions, all the sonars give out <span class="redones">very stable and precise values</span>. Main <span class="redones">observed differences between MB1200, 1260 and MB1240 were<span>:</li>
				<li>MB1260 offers the <span class="redones">farther detection range</span> (1068cm)</li>
				<li>MB1200 and 1260 aren't capable to <span class="redones">detect an opening in the wall (such as a door)</span>, as their beam is very large</li>
				<li>MB1240 isn't capable to <span class="redones">detect far small objects</span></li>
				</ul>

				<p>Here you can see a video about some parts of this test:</p>
				<iframe width="700" height="450" src="https://www.youtube.com/embed/zpFpAeMWSD4" frameborder="0" allowfullscreen></iframe>

				<p><br>The second test I did was related to one of the my <span class="redones">main concern</span> about sonar sensors: <span class="redones">distance values stability and precision while flying</span>. During this test I discovered that <span class="redones">the only sensor that could be usable</span>, with some sort of <span class="redones">data filtering</span>, was the <span class="redones">MB1240</span>. In fact, even if sonar supports position sonar sensors away from propellers, the <span class="redones">2150kv motors</span> I was using was <span class="redones">causing too much acoustic and wind noise</span> for MB1200/MB1260 sensors. Values from these <span class="redones">were completely wrong</span>. Here you can see a video about a <span class="redones">flying sonar successful test</span>, with the MB1240 onboard:</p>
				
				<iframe width="700" height="450" src="https://www.youtube.com/embed/xfCqPxrfgQI" frameborder="0" allowfullscreen></iframe>

				<p><br>So, I finally chose to <span class="redones">use only MB1240</span> sensors. <span class="redones">Further tests</span>, was related to the <span class="redones">MB1240 read refresh rate</span>. To do this test I soldered all the sensors on the AAVOID v3 board, and I modified on purpose the previous <span class="redones">sketch</span> to read distances from 6 sensors:</p>
				
				<pre class="prettyprint lang-c">
//FRONT
const int frontPwPin = 8;
long frontPulse, frontCm;

//REAR
const int rearPwPin = 9;
long rearPulse, rearCm;

//RIGHT
const int rightPwPin = 10;
long rightPulse, rightCm;

//LEFT
const int leftPwPin = 11;
long leftPulse, leftCm;

//UP
const int upPwPin = 12;
long upPulse, upCm;

//DOWN
const int downPwPin = 13;
long downPulse, downCm;

const int BAUD_RATE = 9600;
const int SAMPLE_RATE = 10;

void setup() {
 
  //init serial
  Serial.begin(BAUD_RATE);
  
    //set pin modes
  pinMode(frontPwPin, INPUT);
  pinMode(rearPwPin, INPUT);
  pinMode(rightPwPin, INPUT);
  pinMode(leftPwPin, INPUT);
  pinMode(upPwPin, INPUT);
  pinMode(downPwPin, INPUT);
  
}

void loop() {

  //read sensors values
  frontPulse = pulseIn(frontPwPin, HIGH);
  rearPulse = pulseIn(rearPwPin, HIGH);
  rightPulse = pulseIn(rightPwPin, HIGH);
  leftPulse = pulseIn(leftPwPin, HIGH);
  downPulse = pulseIn(downPwPin, HIGH);
  upPulse = pulseIn(upPwPin, HIGH);
  
  //convert values
  frontCm = frontPulse/58;
  rearCm = rearPulse/58;
  rightCm = rightPulse/58;
  leftCm = leftPulse/58;
  downCm = downPulse/58;
  upCm = upPulse/58;
  
  //send data to serial
  Serial.print("F");
  Serial.print(frontCm);
  Serial.print(",");
  
  Serial.print("RE");
  Serial.print(rearCm);
  Serial.print(",");
  
  Serial.print("RI");
  Serial.print(rightCm);
  Serial.print(",");
  
  Serial.print("L");
  Serial.print(leftCm);
  Serial.print(",");
  
  Serial.print("D");
  Serial.print(downCm);
  Serial.print(",");
  
  Serial.print("U");
  Serial.print(upCm);
  
  Serial.println();
  
  delay(SAMPLE_RATE);
 
} 
				</pre>

			<p><br>Results from this test were <span class="redones">not too bad</span>, but, due to the objective of <span class="redones">implementing a realtime AutoPilot</span> control of AAVOID v3, <span class="redones">too much slow</span>. In fact, each single reading done with <span class="redones">pulseIn function</span> was about <span class="redones">50 milliseconds</span>. Here is the code snippet I wrote to do some <span class="redones">benchmark</span>:</p>
<pre class="prettyprint lang-c">
time1 = millis();
frontPulse = pulseIn(frontPwPin, HIGH);
time2 = millis()-time1;
mySerial.print("T");
mySerial.print(time2);
</pre>
			

			<p><br>So <span class="redones">remaining choices</span> on how to read sensors data were <span class="redones">serial communication and analog output</span>. I already decided to use serial communication of the AutoPilot microcontroller to communicate with MultiWii on the other microcontroller, and also, I cannot use 6 serials/software serials to read sensor data. So I was <span class="redones">obliged to test analog output</span>. This test forced me to <span class="redones">redesign again AAVOID v3 board</span>, as you can read in the previous section <a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project11').innerHTML,'project11')"><span class="redones-link">6.1 Electronics: dual sathakit board improvements</span></a>, in order to read sensor data via analog output. Luckily <span class="redones">analog readings are very fast</span>. Here's the function I wrote to test analog readings speed:</p>
			<pre class="prettyprint lang-c">
void readSonarData(){

	time1 = millis();

    //read sensors values
  frontVoltage =  analogRead(A5); //FRONT
  rearVoltage =  analogRead(A4); //REAR
  downVoltage =  analogRead(A2); //DOWN
  leftVoltage =  analogRead(A1); //LEFT
  rightVoltage = analogRead(A0); //RIGHT

  //convert values
  frontCm = (frontVoltage/1024)*1000;
  frontReadings[readingsCount] = frontCm;
  
  rearCm = (rearVoltage/1024)*1000;
  rearReadings[readingsCount] = rearCm;
  
  rightCm = (rightVoltage/1024)*1000;
  rightReadings[readingsCount] = rightCm;
  
  leftCm = (leftVoltage/1024)*1000;
  leftReadings[readingsCount] = leftCm;
  
  downCm = (downVoltage/1024)*1000;
  downReadings[readingsCount] = downCm;
  
    if(DEBUG){
  
    //send data to serial
    mySerial.print("F");
    mySerial.print(frontCm);
    mySerial.print(" ");
  
    mySerial.print("RE");
    mySerial.print(rearCm);
    mySerial.print(" ");
  
    mySerial.print("RI");
    mySerial.print(rightCm);
    mySerial.print(" ");
  
    mySerial.print("L");
    mySerial.print(leftCm);
    mySerial.print(" ");
  
    mySerial.print("D");
    mySerial.print(downCm);
    mySerial.print(" ");
 
  }

  time2 = millis()-time1;
  mySerial.print("T");
  mySerial.print(time2);

}			</pre>

<ul class="lists"><li><br>At this point I was <span class="redones">satisfied enough</span> of these tests. So, <span class="redones">the conclusions</span> were:</li>
<li><span class="redones">use MaxBotix MaxSonar MB1240</span> sensors</li>
<li><span class="redones">use analog</span> output as the way for reading distance data</li>
</ul>

<p>Here you can download all the code I've made for this section: <a href="other/sonar_tests.rar"><span class="redones-link">sonar_tests</span></a>.</p>

			</div>
		</section>

		<section id= "project14" class="row">
			<div class="photo-grid">
				<p>In this final project section you will find information about development of <span class="redones">AAVOID v3 AutoPilot system</span>.<br></p>

				<h3><span class="redones">AutoPilot, initial considerations</span></h3>

				<p><br>Coming back from some experience with <span class="redones">Android development</span> and, furthermore, with <span class="redones">serial communication between an Android smartphone and a microcontroller</span>, I know that a <span class="redones">near-real-time, quickly reflexive</span>, AutoPilot system could <span class="redones">not be easily implemented as a mobile app</span>. This because of the non real-time nature of Android OS, but due also the delay I often observed using several Android to serial libraries, such as <a href="https://github.com/mik3y/usb-serial-for-android"><span class="redones-link">usb-serial-for-android</span></a> or <a href="https://github.com/ksksue/PhysicaloidLibrary"><span class="redones-link">PhysicaloidLibrary</span></a>. So I thought about a system that can count on a <span class="redones">low-level & fast C AutoPilot system</span>, for emergency and <span class="redones">quickly-response-needed</span> situations, and eventually, also on a <span class="redones">high level, deliberative AutoPilot system</span>, implemented as an Android app. I had clear from the beginning that <span class="redones">the dream to implement a deliberative AutoPilot system</span> will not come true due to the <span class="redones">time limits and purpose of the FabAcademy</span>. So I concentrate myself on implementing a C, reflexive AutoPilot system on the second microcontroller of AAVOID v3 board. However <span class="redones">I didn't miss the objective of proof mixing of such technologies</span>, as you can read in the next section <a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project15').innerHTML,'project15')"><span class="redones-link">6.5: Application programming: AAVOID as a "Thing" of an IoT system?</span></a>. All the code of the AutoPilot is written for and is <span class="redones">compatible with Arduino</span>.</p>

				<h3><span class="redones">AutoPilot, behavioral considerations</span></h3>

				<p><br>I think at the <span class="redones">AutoPilot</span> as a system that will <span class="redones">intervene in an autonomous way</span>, in a detected potentially <span class="redones">dangerous situation</span>, like the one in which an <span class="redones">obstacle is detected</span>. In this case <span class="redones">it will overwrite human pilot controls</span>, by automatically <span class="redones">adjust them</span> in order to move AAVOID in a <span class="redones">safe position</span>. When <span class="redones">no more obstacles are detected</span>, the Autopilot will <span class="redones">give back the controls to the human pilot</span>. The AutoPilot <span class="redones">autonomous switch on and off must be as much soft as possible</span>, avoiding AAVOID strange and dangerous reactions. As a mandatory <span class="redones">security requirement</span>, the AutoPilot <span class="redones">must be forcedly deactivable at any time</span>.</p>

				<h3><span class="redones">How to implement the AutoPilot?</span></h3>

				<p><br>The idea behind C AutoPilot system was to exploit the possibilities offered by <a href="http://www.multiwii.com/wiki/index.php?title=Multiwii_Serial_Protocol"><span class="redones-link">MultiWii Serial Protocol</span></a> (<span class="redones">MSP</span> from now on). In fact, like <span class="redones">some sort of API</span>, you can use to MSP to get low level drone data, such as stick levels, motor PWMs, but, most important also to <span class="redones">send commands</span>. In the list of the commands you cand send, there are also <span class="redones">remote control commands "MSP_SET_RAW_RC"</span>, that, as stated on MSP page: <span class="redones">"this request is used to inject RC channel via MSP. Each chan overrides legacy RX as long as it is refreshed at least every second"</span>. Specifically, "MSP_SET_RAW_RC" will <span class="redones">overwrite all the human remote controls</span> until there isn't any "MSP_SET_RAW_RC" commands in the last second. Another useful command of MSP is <span class="redones">"MSP_RC"</span> command, that gives back <span class="redones">real-time remote control values</span>. To be noted that if you inject some commands via "MSP_SET_RAW_RC", remote controls values you're reading are the same you're injecting in. By understanding  <span class="redones">"MSP_SET_RAW_RC" and "MSP_RC"</span> commands it's possible to imagine how, using these two, <span class="redones">implement a simple reflexive Autopilot system</span>. For example look at the following <span class="redones">pseudocode</span>:</p>

				<pre class="prettyprint lang-c">
loop{

	read data from sonars
	read remote control data from MultiWii

	if an object is detected{
		autpilot = true
		justActivated = true
		find direction to go
	}else{
		autpilot = false
	}

	if autpilot{
		if justActivated{
			justActivated = false
			soft switch on autpilot, interpolating with last read remote control data
		}
		overwrite and adjust remote control values to found direction
	}else{
		give controls to human pilot
	}
}				</pre>

				<p><br>So, after I tested some <span class="redones">quick ways to read distance data from sonars</span>, as you can read in <a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project13').innerHTML,'project13')"><span class="redones-link">6.3 Input devices: sonars tests</span></a>, I started <span class="redones">testing how to communicate to MultiWii through MSP</span>.</p>

				<h3><span class="redones">Communicate through MultiWii Serial Protocol</span></h3>

				
				<ul class="lists">
<li><br>In order to communicate through MSP, I read its <span class="redones">protocol specifications</span>. <br>The general format of an MSP message is: <br> <span class="redones">&ltpreamble&gt,&ltdirection&gt,&ltsize&gt,&ltcommand&gt,&ltdata&gt,&ltcrc&gt</span>.<br> Where:</li>

<li><span class="redones">preamble</span> = the ASCII characters '$M'</li>
<li><span class="redones">direction</span> = the ASCII character '<' if to the MWC or '>' if from the MWC</li>
<li><span class="redones">size</span> = number of data bytes, binary. Can be zero as in the case of a data request to the MWC</li>
<li><span class="redones">command</span> = message_id as per the table below</li>
<li><span class="redones">data</span> = as per the table below. UINT16 values are LSB first.</li>
<li><span class="redones">crc</span> = XOR of &ltsize&gt, &ltcommand&gt and each data byte into a zero'ed sum</li>
</ul>
<ul class="lists"><li>To be noted there are only <span class="redones">two directions in MSP communications</span>:</li>
<li>a <span class="redones">data request</span> coming from MultiWii</li>
<li>a <span class="redones">command sent</span> from outside to MultiWii</li>
</ul>
<p>Accordingly to the above protocol specifications, I first wrote a function to do a <span class="redones">data request</span>:</p>
<pre class="prettyprint lang-c">
void mwSerialRequest(int requestMSP){
  
  Serial.write('$');
  Serial.write('M');
  Serial.write('&lt');
  Serial.write((byte)0x00);
  Serial.write(requestMSP);
  Serial.write(requestMSP);

}
</pre>
<p><br>And then I wrote another function in order to <span class="redones">read data from MultiWii</span>, that should be in the serial buffer just after the request. In this case my interest was on <span class="redones">reading remote control data</span>, so I wrote an ad-hoc function for this. As stated from MSP page, I need to read <span class="redones">"16 x UINT 16"</span>:</p>
<pre class="prettyprint lang-c">
void readMWRCRequest(){

    if(Serial.available()){
    
    rc_response[0] = Serial.read();
    rc_response[1] = Serial.read();
    rc_response[2] = Serial.read();
    rc_response[3] = Serial.read();
    rc_response[4] = Serial.read();
    rc_response[5] = Serial.read();
    rc_response[6] = Serial.read();
    rc_response[7] = Serial.read();
    rc_response[8] = Serial.read();
    rc_response[9] = Serial.read();
    rc_response[10] = Serial.read();
    rc_response[11] = Serial.read();
    rc_response[12] = Serial.read();
    rc_response[13] = Serial.read();
    rc_response[14] = Serial.read();
    rc_response[15] = Serial.read();
    rc_response[16] = Serial.read();
    rc_response[17] = Serial.read();
    rc_response[18] = Serial.read();
    rc_response[19] = Serial.read();
    rc_response[20] = Serial.read();
    rc_response[21] = Serial.read();
        
    ROLL = byte2uint16(rc_response[5],rc_response[6]);
    PITCH = byte2uint16(rc_response[7],rc_response[8]);
    YAW = byte2uint16(rc_response[9],rc_response[10]);
    THROTTLE = byte2uint16(rc_response[11],rc_response[12]);
    AUX1 = byte2uint16(rc_response[13],rc_response[14]);
    
    mySerial.print(ROLL);
    
    mySerial.print(",");
    mySerial.print(PITCH);
   
    mySerial.print(",");
    mySerial.print(YAW);
   
    mySerial.print(",");
    mySerial.print(THROTTLE);
    
    mySerial.print(",");
    mySerial.print(AUX1);
   
    mySerial.println(); 
          
   }else
    mySerial.println("n");  
    
}
</pre>
<p><br>Because of the <span class="redones">results are bytes</span> representing <span class="redones">uint16</span>, I needed to <span class="redones">convert them to uint16</span>. So I wrote a separated function for this:</p>
<pre class="prettyprint lang-c">
int byte2uint16 (byte one,byte two){

  return (one&0xff) + ((two&0xff) &lt&lt8);

}
</pre>	
<p><br>Talking about sending commands to MultiWii via MSP, <span class="redones">I used an already written function</span>, I've found on <a href="http://microquad.blogspot.it/2013/04/a-serial-multiwii-controller.html"><span class="redones-link">Quadcopter project log</span></a>:</p>
<pre class="prettyprint lang-c">
void mwSerialCommand(uint8_t opcode, uint8_t * data, uint8_t n_bytes) {
  uint8_t checksum = 0;
   
  // Send the MSP header and message length
  Serial.write((byte *)"$M&lt", 3);
  Serial.write(n_bytes);
  checksum ^= n_bytes;
 
  // Send the op-code
  Serial.write(opcode);
  checksum ^= opcode;
   
  // Send the data bytes
  for(int i = 0; i &lt n_bytes; i++) {
    Serial.write(data[i]);
    checksum ^= data[i];
  }
   
  // Send the checksum
  Serial.write(checksum);
}
</pre>
<p><br>With the above functions I successfully managed to <span class="redones">communicate with MultiWii</span>. You'll read more on this below.</p>

<h3><span class="redones">AutoPilot, full implementation</span></h3>
<ul class="lists"><li><br>To give myself an <span class="redones">easy start</span>, and to test if <span class="redones">basis for the reflexive AutoPilot system were solid</span>, I first implemented a <span class="redones">fixed AutoPilot</span> system. This is the simplest AutoPilot system I was thinking about, and its behaviour consists in <span class="redones">simply mantain the last remote commands read from the human pilot controls</span>. For the first AutPilot run, I also <span class="redones">implemented the way to forcedly disable it</span>. In order to do this I used the last free position of my remote control <span class="redones">channel 5 or AUX_1 for MultiWii and AutoPilot code</span>.  Positions of AUX1 means: 
</li>
<li><span class="redones">LOW</span>: all deactivated</li>
<li><span class="redones">MEDIUM</span>: quadcopter armed</li>
<li><span class="redones">HIGH</span>: quadcopter armed and <span class="redones">fixed AutoPilot activated</span></li>
</ul>

<p>So I <span class="redones">physically splitted the cable on AAVOID remote control wirings</span>, in order to  take one of the end of channel 5 also to AutoPilot microcontroller. So here's the <span class="redones">fixed AutoPilot implementation</span>. To be noted that I use <span class="redones">software serial</span> for debug and communication with smartphone/PC purposes:</p>

<pre class="prettyprint lang-c">
#include &ltSoftwareSerial.h&gt
#define MSP_RC 105
#define MSP_RAW_RC 200

byte AUX1_PIN = 13;
int AUX1_PH;

bool AUTOPILOT;

int ROLL;
int PITCH;
int YAW;
int THROTTLE;
int AUX1;

byte rc_response[22];
byte rc_send[8];
uint16_t rc_values[8];

SoftwareSerial mySerial(A4, A5); // RX, TX

void setup(){
  
  AUTOPILOT = false;
  
  mySerial.begin(9600);
  Serial.begin(115200);

  pinMode(AUX1_PIN, INPUT);

  //defualt values for rcsend
  rc_values[0] = 1500;
  rc_values[1] = 1500;
  rc_values[2] = 1500;
  rc_values[3] = 1500;
  rc_values[4] = 1900;
  rc_values[5] = 1500;
  rc_values[6] = 1500;
  rc_values[7] = 1500;
  
}

void loop(){
  
  //check if autopilot is enabled/disabled
  AUX1_PH = pulseIn(AUX1_PIN, HIGH);
  
  if(AUX1_PH > 1750)
    AUTOPILOT = true;
  else
    AUTOPILOT = false;
  
  mySerial.print("AUX1_PH: ");
  mySerial.print(AUX1_PH);
  mySerial.println();
  
  if(AUTOPILOT){
  
     mySerial.print("AUTOPILOT: ENABLED");
     mySerial.println();
    
    //////////////////////////AUTOPILOT START//////////////////  
  
    for(int C=0;C&lt8;C++){
    
      byte bytes[2];
      uint162byte(rc_values[C],bytes);
  
      rc_send[C*2] = bytes[0];
      rc_send[(C*2)+1] = bytes[1];
  
    }
  
    mwSerialCommand(MSP_RAW_RC,rc_send,16);
    //////////////////////////AUTOPILOT END//////////////////
  
    delay(50);
  
  }else{
    
     mySerial.print("AUTOPILOT: DISABLED");
     mySerial.println();
  
    mwSerialRequest(MSP_RC);
  
    delay(50);
  
    readMWRCRequest();
    
    //update rc values
    rc_values[0] = ROLL;
    rc_values[1] = PITCH;
    rc_values[2] = YAW;
    rc_values[3] = THROTTLE;
    rc_values[4] = 1900;
    rc_values[5] = 1500;
    rc_values[6] = 1500;
    rc_values[7] = 1500;

  }
  
  delay(10);
  
}

void readMWRCRequest(){

    if(Serial.available()){
    
    rc_response[0] = Serial.read();
    rc_response[1] = Serial.read();
    rc_response[2] = Serial.read();
    rc_response[3] = Serial.read();
    rc_response[4] = Serial.read();
    rc_response[5] = Serial.read();
    rc_response[6] = Serial.read();
    rc_response[7] = Serial.read();
    rc_response[8] = Serial.read();
    rc_response[9] = Serial.read();
    rc_response[10] = Serial.read();
    rc_response[11] = Serial.read();
    rc_response[12] = Serial.read();
    rc_response[13] = Serial.read();
    rc_response[14] = Serial.read();
    rc_response[15] = Serial.read();
    rc_response[16] = Serial.read();
    rc_response[17] = Serial.read();
    rc_response[18] = Serial.read();
    rc_response[19] = Serial.read();
    rc_response[20] = Serial.read();
    rc_response[21] = Serial.read();
        
    ROLL = byte2uint16(rc_response[5],rc_response[6]);
    PITCH = byte2uint16(rc_response[7],rc_response[8]);
    YAW = byte2uint16(rc_response[9],rc_response[10]);
    THROTTLE = byte2uint16(rc_response[11],rc_response[12]);
    AUX1 = byte2uint16(rc_response[13],rc_response[14]);
    
    mySerial.print(ROLL);
    
    mySerial.print(",");
    mySerial.print(PITCH);
   
    mySerial.print(",");
    mySerial.print(YAW);
   
    mySerial.print(",");
    mySerial.print(THROTTLE);
    
    mySerial.print(",");
    mySerial.print(AUX1);
   
    mySerial.println(); 
          
   }else
    mySerial.println("n");  
    
}

void mwSerialRequest(int requestMSP){
  
  Serial.write('$');
  Serial.write('M');
  Serial.write('&lt');
  Serial.write((byte)0x00);
  Serial.write(requestMSP);
  Serial.write(requestMSP);

}

void mwSerialCommand(uint8_t opcode, uint8_t * data, uint8_t n_bytes) {
  uint8_t checksum = 0;
   
  // Send the MSP header and message length
  Serial.write((byte *)"$M&lt", 3);
  Serial.write(n_bytes);
  checksum ^= n_bytes;
 
  // Send the op-code
  Serial.write(opcode);
  checksum ^= opcode;
   
  // Send the data bytes
  for(int i = 0; i &lt n_bytes; i++) {
    Serial.write(data[i]);
    checksum ^= data[i];
  }
   
  // Send the checksum
  Serial.write(checksum);
}

int byte2uint16 (byte one,byte two){

  return (one&0xff) + ((two&0xff)&lt&lt8);

}

void uint162byte(uint16_t value,byte bytes[]){
    
  bytes[0] = value & 0xFF; //low
  bytes[1] = value >> 8; //high

}
</pre>
<p><br>Here you can see two videos about fixed AutoPilot while it's working:</p>
				<iframe width="700" height="450" src="https://www.youtube.com/embed/Lb-OYtB7LEA" frameborder="0" allowfullscreen></iframe>
				<iframe width="700" height="450" src="https://www.youtube.com/embed/CFXT9uVOnIE" frameborder="0" 
				allowfullscreen></iframe>

<ul class="lists"><li><br>As you can see, there's also another function that converts uint16 to byte, called <span class="redones">uint162byte</span>, in order to send RC data to MultiWii. I was satisfied of these tests, so I tried a <span class="redones">AutoPilot walls implementation</span>. This time there are alot of new functions and features:</li> 

	<li><span class="redones">distance values</span> are read with the exception of the top sonar sensor</li>
	<li>there's an <span class="redones">altitude check</span>, this because I wanted to activate the AutoPilot only when AAVOID is at <span class="redones">a certain height</span> and not on the ground</li>
	<li>there's a simple algorithm to <span class="redones">decide directions to take</span> depending on sonar readings</li>
	<li>there's a check about situation in which <span class="redones">obstacles are detected on more of one side</span>, and what to do accordingly (nothing if the sides are at the opposites, oblique direction otherwise)</li>
	<li>there are functions to <span class="redones">soft adjust remote control values</span></li>
	<li>the AutoPilot will not deactivate itself until AAVOID will be in a <span class="redones">safe position</span></li>
	<li>there's a function to <span class="redones">compensate the throttle</span> while AAVOID is moving</li>
	<li>the code is <span class="redones">completely configurable</span> to suit different needs (see code comments)</li>
	<li>there are functions that try to do some <span class="redones">data filtering</span> on all the sonar readings</li>
</ul> 

<p>The thing that is <span class="redones">missing</span> is a fully automatic <span class="redones">throttle adjustment</span>, by the readings of the bottom sonar. I was thinking to do this after I've reached the objective to show some simple avoidance tests. So the <span class="redones">AutoPilot will try follow the up/down movements</span> that AAVOID was following just before the AutoPilot autonomously switch itself on. Here's the code of the first <span class="redones">AutoPilot walls implementation</span>:</p>

<pre class="prettyprint lang-c">
#include &ltSoftwareSerial.h&gt
#define MSP_RC 105
#define MSP_RAW_RC 200

/////////////MISC VARS///////////////////

bool DEBUG,DEBUG1,DEBUG2;

int readingsCount;

SoftwareSerial mySerial(5,6); // RX, TX

long time1,time2;

bool OBSTACLE_DETECTED;

/////////////AUX1 VARS///////////////

int AUX1_PH; 
byte AUX1_PIN;

////////////AUTOPILOT VARS////////////

bool AUTOPILOT_JUST_STARTED;
bool AUTODISABLED;
bool IMPULSE;
bool AUTOPILOT;
long AUTOPILOT_LIFETIME;
long AUTOPILOT_START_TIME;

int HOVERING;
int FORWARD;
int BACKWARDS;
int LEFT;
int RIGHT;


/////////////SONARS///////////////

//higher = more stable readings but slower and vice-versa,only par values
#define NUM_READINGS 6

int HORIZONTAL_TRESHOLD_DISTANCE;
int MIN_ALTITUDE;

//FRONT
float frontVoltage, frontCm, frontReadings[NUM_READINGS];
bool frontDetected;

//REAR
float rearVoltage, rearCm, rearReadings[NUM_READINGS];
bool rearDetected;

//RIGHT
float rightVoltage, rightCm, rightReadings[NUM_READINGS];
bool rightDetected;

//LEFT
float leftVoltage, leftCm, leftReadings[NUM_READINGS];
bool leftDetected;

//DOWN
float downVoltage, downCm, downReadings[NUM_READINGS];

//////////RC VALUES///////////////////

int ROLL; 
int PITCH; 
int YAW; 
int THROTTLE;
int AUX1;

int ROLL_POSITION;
int PITCH_POSITION;
int YAW_POSITION;
int THROTTLE_POSITION;

int ROLL_MIDDLE;
int PITCH_MIDDLE;
int YAW_MIDDLE;
int THROTTLE_MIDDLE;
int AUX1_MIDDLE;

int MAX_HORIZONTAL_ADJUSTED;
int MIN_HORIZONTAL_ADJUSTED;

bool ADJUST_HORIZONTAL_THROTTLE;

int normalizeStep;
int adjustStep;

////////////MULTIWII COMMUNICATION VARS///////////////
byte rc_response[22];
byte rc_send[8];
uint16_t rc_values[8];

//////////////TEST VARS/////////////////////

//frontal test channel
int specificAdjust = 1; //exclude PITCH
//define specific adjustments for each channel
int specificAdjusts[4];

int THROTTLE_COMPENSATION;
int THROTTLE_HORIZONTAL_VALUE;

void setup(){
  
  ///DO NOT TOUCH THESE////////////////////

  THROTTLE_HORIZONTAL_VALUE = 1000;
  
  OBSTACLE_DETECTED = false;
  
  HOVERING = 0;
  FORWARD = 1;
  BACKWARDS = 2;
  LEFT = 3;
  RIGHT = 4;

  
  ROLL_POSITION = 0;
  PITCH_POSITION = 1;
  YAW_POSITION = 2;
  THROTTLE_POSITION = 3;
  
  AUTOPILOT_JUST_STARTED = true;
  AUTODISABLED = false;
  IMPULSE = false;
  
  AUTOPILOT = false;

  frontDetected = false;
  rearDetected = false;
  rightDetected = false;
  leftDetected = false;
 
  mySerial.begin(9600);
  Serial.begin(115200);
  
  AUX1_PIN = 10;
  pinMode(AUX1_PIN, INPUT);
  
  //defualt values for rcsend
  rc_values[0] = 1500;
  rc_values[1] = 1500;
  rc_values[2] = 1500;
  rc_values[3] = 1500;
  rc_values[4] = 1900;
  rc_values[5] = 1500;
  rc_values[6] = 1500;
  rc_values[7] = 1500;
  
  readingsCount = 0;

  //default values for sonars readings
  for(int C=0;C&ltNUM_READINGS;C++)  
    frontReadings[C] = 700;
  
  //values read from MultiWii
  ROLL = 1500; 
  PITCH = 1500; 
  YAW = 1500; 
  THROTTLE = 1000;
  AUX1 = 1000;

  ///WAIT FOR MULTIWII INIT
  delay(10000);
  
  //////////ADJUSTABLE VALUES/////////////
  
  //minimum rc step for reach hovering values
  normalizeStep = 1;
  //minimum rc step for reach adjusted values
  adjustStep = 15;
  
  //compensate throttle while moving horizontally?
  ADJUST_HORIZONTAL_THROTTLE = true;
  
  //test AUTOPILOT lifetime
  AUTOPILOT_LIFETIME = 800; //msec
  
  //values for hovering (here maybe is needed to read trimmered values)
  ROLL_MIDDLE = 1500;
  PITCH_MIDDLE = 1500;
  YAW_MIDDLE = 1500;
  THROTTLE_MIDDLE = 1500;
  AUX1_MIDDLE = 1500;
  
  //max/min values for ROLL and PITCH when AUTOPILOT is on
  MAX_HORIZONTAL_ADJUSTED = 1620;
  MIN_HORIZONTAL_ADJUSTED = 1380;
    
  //distance for detect obstacles
  HORIZONTAL_TRESHOLD_DISTANCE = 35; 
  //minimum distance to start obstacle avoidance (problems on the ground!)
  MIN_ALTITUDE = 40; 
  
  //test throttle compensation for horizontal movements
  THROTTLE_COMPENSATION = 20;
    
  DEBUG = false;  
  DEBUG1 = false;
  DEBUG2 = false;

}

void loop(){
  
  //benchmark for fine tuning
  if(DEBUG || DEBUG1 || DEBUG2)
    time1 = millis();
  
  //reset adjustments values
  specificAdjusts[ROLL_POSITION] = 0;
  specificAdjusts[PITCH_POSITION] = 0;
  specificAdjusts[YAW_POSITION] = 0;
  specificAdjusts[THROTTLE_POSITION] = 0;
  
  readSonarData();
  
  //check if autopilot is enabled/disabled
  AUX1_PH = pulseIn(AUX1_PIN, HIGH);
  
  if(DEBUG){

    mySerial.print("A");
    mySerial.print(AUX1_PH);
    mySerial.print(" ");
  
  }
  
  //check sensors data if min altitude is reached
  if(minAltitude(downReadings)){
       
    frontDetected = horizontalObstacleDetected(frontReadings);
    rearDetected = horizontalObstacleDetected(rearReadings);
    rightDetected = horizontalObstacleDetected(rightReadings);
    leftDetected = horizontalObstacleDetected(leftReadings);
    
    if((frontDetected != rearDetected) || (leftDetected != rightDetected)){
      
      OBSTACLE_DETECTED = true;
    
      if(frontDetected)//go back
        specificAdjusts[PITCH_POSITION] = BACKWARDS;
      else
      if(rearDetected)
        specificAdjusts[PITCH_POSITION] = FORWARD;
      
      if(leftDetected)//go right
        specificAdjusts[ROLL_POSITION] = RIGHT;
      else
      if(rightDetected)//go left
        specificAdjusts[ROLL_POSITION] = LEFT;
      
    }else
      OBSTACLE_DETECTED = false;
    
    
    if(DEBUG1){
     
      mySerial.print("AR ");
      
      mySerial.print("FD:");
      mySerial.print(frontDetected);
      mySerial.print(" RED:");
      mySerial.print(rearDetected);
      mySerial.print(" RID:");
      mySerial.print(rightDetected);
      mySerial.print(" LD:");
      mySerial.print(leftDetected);
      mySerial.print(" ");

    }
  
  }else
    if(DEBUG1)
      mySerial.print("ANR ");
      
  if(DEBUG1){   
      
    mySerial.print("OD:");
    mySerial.print(OBSTACLE_DETECTED);
    mySerial.print(" ");
    
  }
   
  //if(AUX1_PH > 1750 && !IMPULSE && !AUTODISABLED){
  if(AUX1_PH > 1750 && OBSTACLE_DETECTED){ 
    
    AUTOPILOT = true;
    //IMPULSE = true;
  
  }else{
  //if(AUX1_PH &lt= 1750 || !OBSTACLE_DETECTED){
    
    //IMPULSE = false;  
    //AUTODISABLED = false;    
    AUTOPILOT = false;
    AUTOPILOT_JUST_STARTED = true;
  
  }
  
  if(AUTOPILOT){

    if(DEBUG1){
         
      readMultiWiiRCData();
      mySerial.print("APE ");
    
    }
    
        //TEST AUTODISABLE AFTER A TIMEOUT, TAKES LAST THROTTLE VALUE
    if(AUTOPILOT_JUST_STARTED){
   
      //THROTTLE COMPENSATION 
      THROTTLE_HORIZONTAL_VALUE = THROTTLE + THROTTLE_COMPENSATION;
      
      AUTOPILOT_JUST_STARTED = false;
      AUTOPILOT_START_TIME = millis();
      
    }else
    if((millis()-AUTOPILOT_START_TIME) &gt AUTOPILOT_LIFETIME){
     
      //AUTOPILOT_JUST_STARTED = true;
      //AUTOPILOT = false;
      //AUTODISABLED = true;
    
    }
    //////////////////////////AUTOPILOT START//////////////////  
  
    //////////////AUTOMATICALLY ADJUST VALUES//////////////////////
    
    //////////////HOVERING ADJUSTMENTS (except throttle)////////////////
    hoveringAdjustments();
    
    //////////////SPECIFIC ADJUSTMENTS    
    moveHorizontal();
                
    //////////////WRITE VALUES//////////////////////
     writeMultiWiiRCData();
   
  //////////////////////////AUTOPILOT END//////////////////
  
  }else{
    
   if(DEBUG1)
    mySerial.print("APD ");
 
    readMultiWiiRCData();

  }
    
  //delay(10);
  
   //benchmark for fine tuning
 if(DEBUG2 || DEBUG1 || DEBUG){
   
  time2 = millis()-time1;
  mySerial.print("T");
  mySerial.print(time2);
  
  //one return for all
  mySerial.println(); 
  
 }
 
}

void readMWRCRequest(){

    if(Serial.available()){
    
    rc_response[0] = Serial.read();
    rc_response[1] = Serial.read();
    rc_response[2] = Serial.read();
    rc_response[3] = Serial.read();
    rc_response[4] = Serial.read();
    rc_response[5] = Serial.read();
    rc_response[6] = Serial.read();
    rc_response[7] = Serial.read();
    rc_response[8] = Serial.read();
    rc_response[9] = Serial.read();
    rc_response[10] = Serial.read();
    rc_response[11] = Serial.read();
    rc_response[12] = Serial.read();
    rc_response[13] = Serial.read();
    rc_response[14] = Serial.read();
    rc_response[15] = Serial.read();
    rc_response[16] = Serial.read();
    rc_response[17] = Serial.read();
    rc_response[18] = Serial.read();
    rc_response[19] = Serial.read();
    rc_response[20] = Serial.read();
    rc_response[21] = Serial.read();
        
    ROLL = byte2uint16(rc_response[5],rc_response[6]);
    PITCH = byte2uint16(rc_response[7],rc_response[8]);
    YAW = byte2uint16(rc_response[9],rc_response[10]);
    THROTTLE = byte2uint16(rc_response[11],rc_response[12]);
    AUX1 = byte2uint16(rc_response[13],rc_response[14]);
    
    //update rc values
    rc_values[0] = ROLL;
    rc_values[1] = PITCH;
    rc_values[2] = YAW;
    rc_values[3] = THROTTLE;
    rc_values[4] = 1900;
    rc_values[5] = 1500;
    rc_values[6] = 1500;
    rc_values[7] = 1500;
      
    if(DEBUG1){
    
      mySerial.print(ROLL);
      mySerial.print(",");
      mySerial.print(PITCH);
      mySerial.print(",");
      mySerial.print(YAW);
      mySerial.print(",");
      mySerial.print(THROTTLE);
      mySerial.print(",");
      mySerial.print(AUX1);
      mySerial.print(" ");
          
    }       
          
   }else
    if(DEBUG1)
      mySerial.print("n");  
    
}

void mwSerialRequest(int requestMSP){
  
  Serial.write('$');
  Serial.write('M');
  Serial.write('&lt');
  Serial.write((byte)0x00);
  Serial.write(requestMSP);
  Serial.write(requestMSP);

}

void mwSerialCommand(uint8_t opcode, uint8_t * data, uint8_t n_bytes) {
  uint8_t checksum = 0;
   
  // Send the MSP header and message length
  Serial.write((byte *)"$M&lt", 3);
  Serial.write(n_bytes);
  checksum ^= n_bytes;
 
  // Send the op-code
  Serial.write(opcode);
  checksum ^= opcode;
   
  // Send the data bytes
  for(int i = 0; i &lt n_bytes; i++) {
    Serial.write(data[i]);
    checksum ^= data[i];
  }
   
  // Send the checksum
  Serial.write(checksum);
}

int byte2uint16 (byte one,byte two){

  return (one&0xff) + ((two&0xff)&lt&lt8);

}

void uint162byte(uint16_t value,byte bytes[]){
    
  bytes[0] = value & 0xFF; //low
  bytes[1] = value >> 8; //high

}

bool horizontalObstacleDetected(float readings[]){

    int counter = 0;
  
   for(int C=0;C&ltNUM_READINGS;C++)
     if(readings[C] &lt= HORIZONTAL_TRESHOLD_DISTANCE)
       ++counter;
   
   if(counter &gt (NUM_READINGS/2) )
   return true;

  return false;

}

bool minAltitude(float readings[]){

   int counter = 0;
  
   for(int C=0;C&ltNUM_READINGS;C++)
     if(readings[C] &gt= MIN_ALTITUDE)
       ++counter;
   
   if(counter &gt (NUM_READINGS/2) )
     return true;

  return false;

}

void hoveringAdjustments(){

      if(specificAdjusts[ROLL_POSITION] == HOVERING)
      if((ROLL_MIDDLE-normalizeStep) &lt= rc_values[ROLL_POSITION] &lt= (ROLL_MIDDLE+normalizeStep))
        rc_values[ROLL_POSITION] = ROLL_MIDDLE;
      else
      if(rc_values[ROLL_POSITION] &lt ROLL_MIDDLE)
        rc_values[ROLL_POSITION] = rc_values[ROLL_POSITION] + normalizeStep;
      else
      if(rc_values[ROLL_POSITION] &gt ROLL_MIDDLE)
        rc_values[ROLL_POSITION] = rc_values[ROLL_POSITION] - normalizeStep;

    if(specificAdjusts[PITCH_POSITION] == HOVERING)
      if((PITCH_MIDDLE-normalizeStep) &lt= rc_values[PITCH_POSITION] &lt= (PITCH_MIDDLE+normalizeStep))
        rc_values[PITCH_POSITION] = PITCH_MIDDLE;
      else
      if(rc_values[PITCH_POSITION] &lt PITCH_MIDDLE)
        rc_values[PITCH_POSITION] = rc_values[PITCH_POSITION] + normalizeStep;
      else
      if(rc_values[PITCH_POSITION] &gt PITCH_MIDDLE)
        rc_values[PITCH_POSITION] = rc_values[PITCH_POSITION] - normalizeStep;
        
    if(specificAdjusts[YAW_POSITION] == HOVERING)
      if((YAW_MIDDLE-normalizeStep) &lt= rc_values[YAW_POSITION] &lt= (YAW_MIDDLE+normalizeStep))
        rc_values[YAW_POSITION] = YAW_MIDDLE;
      else
      if(rc_values[YAW_POSITION] &lt YAW_MIDDLE)
        rc_values[YAW_POSITION] = rc_values[YAW_POSITION] + normalizeStep;
      else
      if(rc_values[YAW_POSITION] &gt YAW_MIDDLE)
        rc_values[YAW_POSITION] = rc_values[YAW_POSITION] - normalizeStep;
        
    if(specificAdjusts[THROTTLE_POSITION] == HOVERING)
      if((THROTTLE_MIDDLE-normalizeStep) &lt= rc_values[THROTTLE_POSITION] &lt= (THROTTLE_MIDDLE+normalizeStep))
        rc_values[THROTTLE_POSITION] = THROTTLE_MIDDLE;
      else
      if(rc_values[THROTTLE_POSITION] &lt THROTTLE_MIDDLE)
        rc_values[THROTTLE_POSITION] = rc_values[THROTTLE_POSITION] + normalizeStep;
      else
      if(rc_values[THROTTLE_POSITION] &gt YAW_MIDDLE)
        rc_values[THROTTLE_POSITION] = rc_values[THROTTLE_POSITION] - normalizeStep;
        
}

void readMultiWiiRCData(){

    mwSerialRequest(MSP_RC);
  
    delay(50);

    readMWRCRequest();
  
}

void writeMultiWiiRCData(){

    for(int C=0;C&lt8;C++){
    
      byte bytes[2];
      uint162byte(rc_values[C],bytes);
  
      rc_send[C*2] = bytes[0];
      rc_send[(C*2)+1] = bytes[1];
  
    }
    
    //write rc values
    mwSerialCommand(MSP_RAW_RC,rc_send,16);

}

void readSonarData(){

    //read sensors values
  frontVoltage =  analogRead(A5); //FRONT
  rearVoltage =  analogRead(A4); //REAR
  downVoltage =  analogRead(A2); //DOWN
  leftVoltage =  analogRead(A1); //LEFT
  rightVoltage = analogRead(A0); //RIGHT

  //convert values
  frontCm = (frontVoltage/1024)*1000;
  frontReadings[readingsCount] = frontCm;
  
  rearCm = (rearVoltage/1024)*1000;
  rearReadings[readingsCount] = rearCm;
  
  rightCm = (rightVoltage/1024)*1000;
  rightReadings[readingsCount] = rightCm;
  
  leftCm = (leftVoltage/1024)*1000;
  leftReadings[readingsCount] = leftCm;
  
  downCm = (downVoltage/1024)*1000;
  downReadings[readingsCount] = downCm;
  
    ++readingsCount;
  if(readingsCount &lt= NUM_READINGS)
    readingsCount = 0;
  
    if(DEBUG){
  
    //send data to serial
    mySerial.print("F");
    mySerial.print(frontCm);
    mySerial.print(" ");
  
    mySerial.print("RE");
    mySerial.print(rearCm);
    mySerial.print(" ");
  
    mySerial.print("RI");
    mySerial.print(rightCm);
    mySerial.print(" ");
  
    mySerial.print("L");
    mySerial.print(leftCm);
    mySerial.print(" ");
  
    mySerial.print("D");
    mySerial.print(downCm);
    mySerial.print(" ");
 
  }

}

void moveHorizontal(){
  
  //ROLL RIGHT
  if(specificAdjusts[ROLL_POSITION] == RIGHT){
    
      if((MAX_HORIZONTAL_ADJUSTED-adjustStep) &lt= rc_values[ROLL_POSITION] &lt= (MAX_HORIZONTAL_ADJUSTED+adjustStep))
        rc_values[ROLL_POSITION] = MAX_HORIZONTAL_ADJUSTED;
      else
      if(rc_values[ROLL_POSITION] &lt MAX_HORIZONTAL_ADJUSTED)
        rc_values[ROLL_POSITION] = rc_values[ROLL_POSITION] + adjustStep;
      else
      if(rc_values[ROLL_POSITION] &gt MAX_HORIZONTAL_ADJUSTED)
        rc_values[ROLL_POSITION] = rc_values[ROLL_POSITION] - adjustStep;
      
  }else//ROLL LEFT
  if(specificAdjusts[ROLL_POSITION] == LEFT){
    
      if((MIN_HORIZONTAL_ADJUSTED-adjustStep) &lt= rc_values[ROLL_POSITION] &lt= (MIN_HORIZONTAL_ADJUSTED+adjustStep))
        rc_values[ROLL_POSITION] = MIN_HORIZONTAL_ADJUSTED;
      else
      if(rc_values[ROLL_POSITION] &lt MIN_HORIZONTAL_ADJUSTED)
        rc_values[ROLL_POSITION] = rc_values[ROLL_POSITION] + adjustStep;
      
      if(rc_values[ROLL_POSITION] > MIN_HORIZONTAL_ADJUSTED)
        rc_values[ROLL_POSITION] = rc_values[ROLL_POSITION] - adjustStep;     
    
  }
  
    //PITCH FORWARD
  if(specificAdjusts[PITCH_POSITION] == FORWARD){
    
      if((MAX_HORIZONTAL_ADJUSTED-adjustStep) &lt= rc_values[PITCH_POSITION] &lt= (MAX_HORIZONTAL_ADJUSTED+adjustStep))
        rc_values[PITCH_POSITION] = MAX_HORIZONTAL_ADJUSTED;
      else
      if(rc_values[PITCH_POSITION] &lt MAX_HORIZONTAL_ADJUSTED)
        rc_values[PITCH_POSITION] = rc_values[PITCH_POSITION] + adjustStep;
      else
      if(rc_values[PITCH_POSITION] &gt MAX_HORIZONTAL_ADJUSTED)
        rc_values[PITCH_POSITION] = rc_values[PITCH_POSITION] - adjustStep;
      
  }else//PITCH BACKWARDS
  if(specificAdjusts[PITCH_POSITION] == BACKWARDS){
    
      if((MIN_HORIZONTAL_ADJUSTED-adjustStep) &lt= rc_values[PITCH_POSITION] &lt= (MIN_HORIZONTAL_ADJUSTED+adjustStep))
        rc_values[PITCH_POSITION] = MIN_HORIZONTAL_ADJUSTED;
      else
      if(rc_values[PITCH_POSITION] &lt MIN_HORIZONTAL_ADJUSTED)
        rc_values[PITCH_POSITION] = rc_values[PITCH_POSITION] + adjustStep;
      
      if(rc_values[PITCH_POSITION] &gt MIN_HORIZONTAL_ADJUSTED)
        rc_values[PITCH_POSITION] = rc_values[PITCH_POSITION] - adjustStep;     
    
  }
   
      //YAW CLOCKWISE / COUNTER CLOCKWISE
      
      //THROTTLE COMPENSATION
      if((THROTTLE_HORIZONTAL_VALUE-adjustStep) &lt= rc_values[THROTTLE_POSITION] &lt= (THROTTLE_HORIZONTAL_VALUE+adjustStep))
        rc_values[THROTTLE_POSITION] = THROTTLE_HORIZONTAL_VALUE;
      else
      if(rc_values[THROTTLE_POSITION] &lt THROTTLE_HORIZONTAL_VALUE)
        rc_values[THROTTLE_POSITION] = rc_values[THROTTLE_POSITION] + adjustStep;
      
      if(rc_values[THROTTLE_POSITION] &gt THROTTLE_HORIZONTAL_VALUE)
        rc_values[THROTTLE_POSITION] = rc_values[THROTTLE_POSITION] - adjustStep;   
  
}
</pre>

				<p><br>As you can see from these videos, <span class="redones">on the ground it seemed to work very well</span>:</p>

				<iframe width="700" height="450" src="https://www.youtube.com/embed/rkOAylOlB6Q" frameborder="0" allowfullscreen></iframe>
				<iframe width="700" height="450" src="https://www.youtube.com/embed/bBcBNvNqBQ8" frameborder="0" allowfullscreen></iframe>
				<iframe width="700" height="450" src="https://www.youtube.com/embed/Jr37mSANPMQ" frameborder="0" allowfullscreen></iframe>

				<p><br>But this what happened, in a <span class="redones">longer and serious test</span>:</p>
				<iframe width="700" height="450" src="https://www.youtube.com/embed/ZSJ8vHIQEkM" frameborder="0" allowfullscreen></iframe>

				<p><br>During the night I discovered <span class="redones">what was the problem</span>. Due to <span class="redones">continuous readings errors from sonars</span>, the AutoPilot was <span class="redones">continuously and autonomously switched on and off</span>. This caused that it read as user throttle values, the <span class="redones">values that itself was injecting before</span>. Because of every time the AutoPilot switch on itself, it will compensate throttle by adding a little value, this was causing a continuously throttle increase. So, as you can see in the video, the throttle was slowly but continuously augmented, just before the crash.</p>	

				<ul class="lists"><li>Luckily at that time I <span class="redones">had the backup ready</span> and I was able to continue experimentations <span class="redones">without losing any time</span>. Anyway <span class="redones">time was running out</span>, so I've taken the decision to try at my best my last chances. <span class="redones">AAVOID will "avoid" something or will be destroyed on trying doing it!!</span> For the next try I decided to semplify all the above features, until I will reach the best <span class="redones">compromise in showing some avoid behaviours and staying safe as mush as possible</span>. So I <span class="redones">disabled alot</span> of the above functions. These the main differences:</li>
				<li>avoidance only from <span class="redones">one side</span></li>
				<li><span class="redones">disabled</span> altitude checking</li>
				<li>added an <span class="redones">AutoPilot life time</span>, a sort of timeout for auto disabling the autopilot</li>
				<li>I <span class="redones">increased values</span> for horizontal movements</li>
				<li>I need to <span class="redones">re-enable</span> the AutoPilot every time it was autonomously activated one time</li>
				</ul>
				<p>So here's the code for the fail safe <span class="redones">kick back AutoPilot implementation:</span></p>
<pre class="prettyprint lang-c">
#include &ltSoftwareSerial.h&gt
#define MSP_RC 105
#define MSP_RAW_RC 200

/////////////MISC VARS///////////////////

bool DEBUG,DEBUG1,DEBUG2;

int readingsCount;

SoftwareSerial mySerial(5,6); // RX, TX

long time1,time2;

bool OBSTACLE_DETECTED;

/////////////AUX1 VARS///////////////

int AUX1_PH; 
byte AUX1_PIN;

////////////AUTOPILOT VARS////////////

bool AUTOPILOT_JUST_STARTED;
bool AUTODISABLED;
bool IMPULSE;
bool AUTOPILOT;
long AUTOPILOT_LIFETIME;
long AUTOPILOT_START_TIME;

int HOVERING;
int FORWARD;
int BACKWARDS;
int LEFT;
int RIGHT;


/////////////SONARS///////////////

//higher = more stable readings but slower and vice-versa,only par values
#define NUM_READINGS 4

int HORIZONTAL_TRESHOLD_DISTANCE;
//int MIN_ALTITUDE;

//FRONT
float frontVoltage, frontCm, frontReadings[NUM_READINGS];
bool frontDetected;

//REAR
float rearVoltage, rearCm, rearReadings[NUM_READINGS];
bool rearDetected;

//RIGHT
float rightVoltage, rightCm, rightReadings[NUM_READINGS];
bool rightDetected;

//LEFT
float leftVoltage, leftCm, leftReadings[NUM_READINGS];
bool leftDetected;

//DOWN
//float downVoltage, downCm, downReadings[NUM_READINGS];

//////////RC VALUES///////////////////

int ROLL; 
int PITCH; 
int YAW; 
int THROTTLE;
int AUX1;

int ROLL_POSITION;
int PITCH_POSITION;
int YAW_POSITION;
int THROTTLE_POSITION;

int ROLL_MIDDLE;
int PITCH_MIDDLE;
int YAW_MIDDLE;
int THROTTLE_MIDDLE;
int AUX1_MIDDLE;

int MAX_HORIZONTAL_ADJUSTED;
int MIN_HORIZONTAL_ADJUSTED;

bool ADJUST_HORIZONTAL_THROTTLE;

int normalizeStep;
int adjustStep;

////////////MULTIWII COMMUNICATION VARS///////////////
byte rc_response[22];
byte rc_send[8];
uint16_t rc_values[8];

//////////////TEST VARS/////////////////////

//frontal test channel
int specificAdjust = 1; //exclude PITCH
//define specific adjustments for each channel
int specificAdjusts[4];

int THROTTLE_COMPENSATION;
int THROTTLE_HORIZONTAL_VALUE;

void setup(){
  
  ///DO NOT TOUCH THESE////////////////////

  THROTTLE_HORIZONTAL_VALUE = 1000;
  
  OBSTACLE_DETECTED = false;
  
  HOVERING = 0;
  FORWARD = 1;
  BACKWARDS = 2;
  LEFT = 3;
  RIGHT = 4;

  
  ROLL_POSITION = 0;
  PITCH_POSITION = 1;
  YAW_POSITION = 2;
  THROTTLE_POSITION = 3;
  
  AUTOPILOT_JUST_STARTED = true;
  AUTODISABLED = false;
  IMPULSE = false;
  
  AUTOPILOT = false;

  frontDetected = false;
  rearDetected = false;
  rightDetected = false;
  leftDetected = false;
 
  mySerial.begin(9600);
  Serial.begin(115200);
  
  AUX1_PIN = 10;
  pinMode(AUX1_PIN, INPUT);
  
  //defualt values for rcsend
  rc_values[0] = 1500;
  rc_values[1] = 1500;
  rc_values[2] = 1500;
  rc_values[3] = 1500;
  rc_values[4] = 1900;
  rc_values[5] = 1500;
  rc_values[6] = 1500;
  rc_values[7] = 1500;
  
  readingsCount = 0;

  //default values for sonars readings
  for(int C=0;C&ltNUM_READINGS;C++)  
    frontReadings[C] = 700;

  //values read from MultiWii
  ROLL = 1500; 
  PITCH = 1500; 
  YAW = 1500; 
  THROTTLE = 1000;
  AUX1 = 1000;

  ///WAIT FOR MULTIWII INIT
  delay(10000);
  
  //////////ADJUSTABLE VALUES/////////////
  
  //minimum rc step for reach hovering values
  normalizeStep = 1;
  //minimum rc step for reach adjusted values
  adjustStep = 15;
  
  //compensate throttle while moving horizontally?
  ADJUST_HORIZONTAL_THROTTLE = true;
  
  //test AUTOPILOT lifetime
  AUTOPILOT_LIFETIME = 800; //msec
  
  //values for hovering (here maybe is needed to read trimmered values)
  ROLL_MIDDLE = 1500;
  PITCH_MIDDLE = 1500;
  YAW_MIDDLE = 1500;
  THROTTLE_MIDDLE = 1500;
  AUX1_MIDDLE = 1500;
  
  //max/min values for ROLL and PITCH when AUTOPILOT is on
  MAX_HORIZONTAL_ADJUSTED = 1650;
  MIN_HORIZONTAL_ADJUSTED = 1350;
    
  //distance for detect obstacles
  HORIZONTAL_TRESHOLD_DISTANCE = 130; 
  //minimum distance to start obstacle avoidance (problems on the ground!)
  //MIN_ALTITUDE = 40; 
  
  //test throttle compensation for horizontal movements
  THROTTLE_COMPENSATION = 10;
    
  DEBUG = false;  
  DEBUG1 = false;
  DEBUG2 = false;

}

void loop(){
  
  //benchmark for fine tuning
  if(DEBUG || DEBUG1 || DEBUG2)
    time1 = millis();
  
  //reset adjustments values
  specificAdjusts[ROLL_POSITION] = 0;
  specificAdjusts[PITCH_POSITION] = 0;
  specificAdjusts[YAW_POSITION] = 0;
  specificAdjusts[THROTTLE_POSITION] = 0;
  
  readSonarData();
  
  //check if autopilot is enabled/disabled
  AUX1_PH = pulseIn(AUX1_PIN, HIGH);
  
  if(DEBUG){

    mySerial.print("A");
    mySerial.print(AUX1_PH);
    mySerial.print(" ");
  
  }
  
  //check sensors data if min altitude is reached
  //if(minAltitude(downReadings)){
  /*     
    frontDetected = horizontalObstacleDetected(frontReadings);
    rearDetected = horizontalObstacleDetected(rearReadings);
    rightDetected = horizontalObstacleDetected(rightReadings);
    leftDetected = horizontalObstacleDetected(leftReadings);
    
    if((frontDetected != rearDetected) || (leftDetected != rightDetected)){
      
      OBSTACLE_DETECTED = true;
    
      if(frontDetected)//go back
        specificAdjusts[PITCH_POSITION] = BACKWARDS;
      else
      if(rearDetected)
        specificAdjusts[PITCH_POSITION] = FORWARD;
      else
      if(leftDetected)//go right
        specificAdjusts[ROLL_POSITION] = RIGHT;
      else
      if(rightDetected)//go left
        specificAdjusts[ROLL_POSITION] = LEFT;
      
    }else
      OBSTACLE_DETECTED = false;
    
    
    if(DEBUG1){
     
      mySerial.print("AR ");
      
      mySerial.print("FD:");
      mySerial.print(frontDetected);
      mySerial.print(" RED:");
      mySerial.print(rearDetected);
      mySerial.print(" RID:");
      mySerial.print(rightDetected);
      mySerial.print(" LD:");
      mySerial.print(leftDetected);
      mySerial.print(" ");

    }
  */
  //}else
    //if(DEBUG1)
      //mySerial.print("ANR ");
      
   //test kick
      
  //if(DEBUG1){   
      
   // mySerial.print("OD:");
   // mySerial.print(OBSTACLE_DETECTED);
   // mySerial.print(" ");
    
 // }
   
   leftDetected = horizontalObstacleDetected(leftReadings);
   specificAdjusts[ROLL_POSITION] = RIGHT;
   
  if(leftDetected && AUX1_PH > 1750 && !IMPULSE){
  //if(AUX1_PH > 1750 && OBSTACLE_DETECTED){ 
    
    AUTOPILOT_JUST_STARTED = true;
    AUTOPILOT = true;
    IMPULSE = true;
  
  }else//{
  //if(AUX1_PH &lt= 1750 || !OBSTACLE_DETECTED){
  if(AUX1_PH &lt= 1750){
    
    IMPULSE = false;  
    AUTOPILOT = false;
    AUTOPILOT_START_TIME = 0;
  
  }
  
  if(AUTOPILOT){

    if(DEBUG1){
         
      readMultiWiiRCData();
      mySerial.print("APE ");
    
    }
        
        //TEST AUTODISABLE AFTER A TIMEOUT, TAKES LAST THROTTLE VALUE
    if(AUTOPILOT_JUST_STARTED){
   
      //THROTTLE COMPENSATION 
      //THROTTLE_HORIZONTAL_VALUE = THROTTLE + THROTTLE_COMPENSATION;
      THROTTLE_HORIZONTAL_VALUE = THROTTLE;
      
      AUTOPILOT_JUST_STARTED = false;
      AUTOPILOT_START_TIME = millis();
      
    }else
    if((millis()-AUTOPILOT_START_TIME) &gt AUTOPILOT_LIFETIME){
     
      AUTOPILOT_JUST_STARTED = true;
      AUTOPILOT = false;
    
    }
    
    //////////////////////////AUTOPILOT START//////////////////  
  
    //////////////AUTOMATICALLY ADJUST VALUES//////////////////////
    
    //////////////HOVERING ADJUSTMENTS (except throttle)////////////////
    hoveringAdjustments();
    
    //////////////SPECIFIC ADJUSTMENTS    
    moveHorizontal();
                
    //////////////WRITE VALUES//////////////////////
     writeMultiWiiRCData();
   
  //////////////////////////AUTOPILOT END//////////////////
 
  
  }else{
    
   if(DEBUG1)
    mySerial.print("APD ");
 
    readMultiWiiRCData();

  }
    
  //delay(10);
  
   //benchmark for fine tuning
 if(DEBUG2 || DEBUG1 || DEBUG){
   
  time2 = millis()-time1;
  mySerial.print("T");
  mySerial.print(time2);
  
  //one return for all
  mySerial.println(); 
  
 }
 
}

void readMWRCRequest(){

    if(Serial.available()){
    
    rc_response[0] = Serial.read();
    rc_response[1] = Serial.read();
    rc_response[2] = Serial.read();
    rc_response[3] = Serial.read();
    rc_response[4] = Serial.read();
    rc_response[5] = Serial.read();
    rc_response[6] = Serial.read();
    rc_response[7] = Serial.read();
    rc_response[8] = Serial.read();
    rc_response[9] = Serial.read();
    rc_response[10] = Serial.read();
    rc_response[11] = Serial.read();
    rc_response[12] = Serial.read();
    rc_response[13] = Serial.read();
    rc_response[14] = Serial.read();
    rc_response[15] = Serial.read();
    rc_response[16] = Serial.read();
    rc_response[17] = Serial.read();
    rc_response[18] = Serial.read();
    rc_response[19] = Serial.read();
    rc_response[20] = Serial.read();
    rc_response[21] = Serial.read();
        
    ROLL = byte2uint16(rc_response[5],rc_response[6]);
    PITCH = byte2uint16(rc_response[7],rc_response[8]);
    YAW = byte2uint16(rc_response[9],rc_response[10]);
    THROTTLE = byte2uint16(rc_response[11],rc_response[12]);
    AUX1 = byte2uint16(rc_response[13],rc_response[14]);
    
    //update rc values
    rc_values[0] = ROLL;
    rc_values[1] = PITCH;
    rc_values[2] = YAW;
    rc_values[3] = THROTTLE;
    rc_values[4] = 1900;
    rc_values[5] = 1500;
    rc_values[6] = 1500;
    rc_values[7] = 1500;
      
    if(DEBUG1){
    
      mySerial.print(ROLL);
      mySerial.print(",");
      mySerial.print(PITCH);
      mySerial.print(",");
      mySerial.print(YAW);
      mySerial.print(",");
      mySerial.print(THROTTLE);
      mySerial.print(",");
      mySerial.print(AUX1);
      mySerial.print(" ");
          
    }       
          
   }else
    if(DEBUG1)
      mySerial.print("n");  
    
}

void mwSerialRequest(int requestMSP){
  
  Serial.write('$');
  Serial.write('M');
  Serial.write('&lt');
  Serial.write((byte)0x00);
  Serial.write(requestMSP);
  Serial.write(requestMSP);

}

void mwSerialCommand(uint8_t opcode, uint8_t * data, uint8_t n_bytes) {
  uint8_t checksum = 0;
   
  // Send the MSP header and message length
  Serial.write((byte *)"$M&lt", 3);
  Serial.write(n_bytes);
  checksum ^= n_bytes;
 
  // Send the op-code
  Serial.write(opcode);
  checksum ^= opcode;
   
  // Send the data bytes
  for(int i = 0; i &lt n_bytes; i++) {
    Serial.write(data[i]);
    checksum ^= data[i];
  }
   
  // Send the checksum
  Serial.write(checksum);
}

int byte2uint16 (byte one,byte two){

  return (one&0xff) + ((two&0xff)&lt&lt8);

}

void uint162byte(uint16_t value,byte bytes[]){
    
  bytes[0] = value & 0xFF; //low
  bytes[1] = value &gt&gt 8; //high

}

bool horizontalObstacleDetected(float readings[]){

    int counter = 0;
  
   for(int C=0;C&ltNUM_READINGS;C++)
     if(readings[C] &lt= HORIZONTAL_TRESHOLD_DISTANCE)
       ++counter;
   
   if(counter > (NUM_READINGS/2) )
   return true;

  return false;

}

/*
bool minAltitude(float readings[]){

   int counter = 0;
  
   for(int C=0;C&ltNUM_READINGS;C++)
     if(readings[C] >= MIN_ALTITUDE)
       ++counter;
   
   if(counter > (NUM_READINGS/2) )
     return true;

  return false;

}*/

void hoveringAdjustments(){

      if(specificAdjusts[ROLL_POSITION] == HOVERING)
      if((ROLL_MIDDLE-normalizeStep) &lt= rc_values[ROLL_POSITION] &lt= (ROLL_MIDDLE+normalizeStep))
        rc_values[ROLL_POSITION] = ROLL_MIDDLE;
      else
      if(rc_values[ROLL_POSITION] &lt ROLL_MIDDLE)
        rc_values[ROLL_POSITION] = rc_values[ROLL_POSITION] + normalizeStep;
      else
      if(rc_values[ROLL_POSITION] &gt ROLL_MIDDLE)
        rc_values[ROLL_POSITION] = rc_values[ROLL_POSITION] - normalizeStep;

    if(specificAdjusts[PITCH_POSITION] == HOVERING)
      if((PITCH_MIDDLE-normalizeStep) &lt= rc_values[PITCH_POSITION] &lt= (PITCH_MIDDLE+normalizeStep))
        rc_values[PITCH_POSITION] = PITCH_MIDDLE;
      else
      if(rc_values[PITCH_POSITION] &lt PITCH_MIDDLE)
        rc_values[PITCH_POSITION] = rc_values[PITCH_POSITION] + normalizeStep;
      else
      if(rc_values[PITCH_POSITION] &gt PITCH_MIDDLE)
        rc_values[PITCH_POSITION] = rc_values[PITCH_POSITION] - normalizeStep;
        
    if(specificAdjusts[YAW_POSITION] == HOVERING)
      if((YAW_MIDDLE-normalizeStep) &lt= rc_values[YAW_POSITION] &lt= (YAW_MIDDLE+normalizeStep))
        rc_values[YAW_POSITION] = YAW_MIDDLE;
      else
      if(rc_values[YAW_POSITION] &lt YAW_MIDDLE)
        rc_values[YAW_POSITION] = rc_values[YAW_POSITION] + normalizeStep;
      else
      if(rc_values[YAW_POSITION] &gt YAW_MIDDLE)
        rc_values[YAW_POSITION] = rc_values[YAW_POSITION] - normalizeStep;
        
    if(specificAdjusts[THROTTLE_POSITION] == HOVERING)
      if((THROTTLE_MIDDLE-normalizeStep) &lt= rc_values[THROTTLE_POSITION] &lt= (THROTTLE_MIDDLE+normalizeStep))
        rc_values[THROTTLE_POSITION] = THROTTLE_MIDDLE;
      else
      if(rc_values[THROTTLE_POSITION] &lt THROTTLE_MIDDLE)
        rc_values[THROTTLE_POSITION] = rc_values[THROTTLE_POSITION] + normalizeStep;
      else
      if(rc_values[THROTTLE_POSITION] &gt YAW_MIDDLE)
        rc_values[THROTTLE_POSITION] = rc_values[THROTTLE_POSITION] - normalizeStep;
        
}

void readMultiWiiRCData(){

    mwSerialRequest(MSP_RC);
  
    delay(50);

    readMWRCRequest();
  
}

void writeMultiWiiRCData(){

    for(int C=0;C&lt8;C++){
    
      byte bytes[2];
      uint162byte(rc_values[C],bytes);
  
      rc_send[C*2] = bytes[0];
      rc_send[(C*2)+1] = bytes[1];
  
    }
    
    //write rc values
    mwSerialCommand(MSP_RAW_RC,rc_send,16);

}

void readSonarData(){

    //read sensors values
  frontVoltage =  analogRead(A5); //FRONT
  rearVoltage =  analogRead(A4); //REAR
  //downVoltage =  analogRead(A2); //DOWN
  leftVoltage =  analogRead(A1); //LEFT
  rightVoltage = analogRead(A0); //RIGHT

  //convert values
  frontCm = (frontVoltage/1024)*1000;
  frontReadings[readingsCount] = frontCm;
  
  rearCm = (rearVoltage/1024)*1000;
  rearReadings[readingsCount] = rearCm;
  
  rightCm = (rightVoltage/1024)*1000;
  rightReadings[readingsCount] = rightCm;
  
  leftCm = (leftVoltage/1024)*1000;
  leftReadings[readingsCount] = leftCm;
  
  //downCm = (downVoltage/1024)*1000;
  //downReadings[readingsCount] = downCm;
  
    ++readingsCount;
  if(readingsCount &gt= NUM_READINGS)
    readingsCount = 0;
  
    if(DEBUG){
  
    //send data to serial
    mySerial.print("F");
    mySerial.print(frontCm);
    mySerial.print(" ");
  
    mySerial.print("RE");
    mySerial.print(rearCm);
    mySerial.print(" ");
  
    mySerial.print("RI");
    mySerial.print(rightCm);
    mySerial.print(" ");
  
    mySerial.print("L");
    mySerial.print(leftCm);
    mySerial.print(" ");
  
    //mySerial.print("D");
    //mySerial.print(downCm);
    //mySerial.print(" ");
 
  }

}

void moveHorizontal(){
  
  //ROLL RIGHT
  if(specificAdjusts[ROLL_POSITION] == RIGHT){
    
      if((MAX_HORIZONTAL_ADJUSTED-adjustStep) &lt= rc_values[ROLL_POSITION] &lt= (MAX_HORIZONTAL_ADJUSTED+adjustStep))
        rc_values[ROLL_POSITION] = MAX_HORIZONTAL_ADJUSTED;
      else
      if(rc_values[ROLL_POSITION] &lt MAX_HORIZONTAL_ADJUSTED)
        rc_values[ROLL_POSITION] = rc_values[ROLL_POSITION] + adjustStep;
      else
      if(rc_values[ROLL_POSITION] &gt MAX_HORIZONTAL_ADJUSTED)
        rc_values[ROLL_POSITION] = rc_values[ROLL_POSITION] - adjustStep;
      
  }else//ROLL LEFT
  if(specificAdjusts[ROLL_POSITION] == LEFT){
    
      if((MIN_HORIZONTAL_ADJUSTED-adjustStep) &lt= rc_values[ROLL_POSITION] &lt= (MIN_HORIZONTAL_ADJUSTED+adjustStep))
        rc_values[ROLL_POSITION] = MIN_HORIZONTAL_ADJUSTED;
      else
      if(rc_values[ROLL_POSITION] &lt MIN_HORIZONTAL_ADJUSTED)
        rc_values[ROLL_POSITION] = rc_values[ROLL_POSITION] + adjustStep;
      
      if(rc_values[ROLL_POSITION] &gt MIN_HORIZONTAL_ADJUSTED)
        rc_values[ROLL_POSITION] = rc_values[ROLL_POSITION] - adjustStep;     
    
  }
  
    //PITCH FORWARD
  if(specificAdjusts[PITCH_POSITION] == FORWARD){
    
      if((MAX_HORIZONTAL_ADJUSTED-adjustStep) &lt= rc_values[PITCH_POSITION] &lt= (MAX_HORIZONTAL_ADJUSTED+adjustStep))
        rc_values[PITCH_POSITION] = MAX_HORIZONTAL_ADJUSTED;
      else
      if(rc_values[PITCH_POSITION] &lt MAX_HORIZONTAL_ADJUSTED)
        rc_values[PITCH_POSITION] = rc_values[PITCH_POSITION] + adjustStep;
      else
      if(rc_values[PITCH_POSITION] &gt MAX_HORIZONTAL_ADJUSTED)
        rc_values[PITCH_POSITION] = rc_values[PITCH_POSITION] - adjustStep;
      
  }else//PITCH BACKWARDS
  if(specificAdjusts[PITCH_POSITION] == BACKWARDS){
    
      if((MIN_HORIZONTAL_ADJUSTED-adjustStep) &lt= rc_values[PITCH_POSITION] &lt= (MIN_HORIZONTAL_ADJUSTED+adjustStep))
        rc_values[PITCH_POSITION] = MIN_HORIZONTAL_ADJUSTED;
      else
      if(rc_values[PITCH_POSITION] &lt MIN_HORIZONTAL_ADJUSTED)
        rc_values[PITCH_POSITION] = rc_values[PITCH_POSITION] + adjustStep;
      
      if(rc_values[PITCH_POSITION] &gt MIN_HORIZONTAL_ADJUSTED)
        rc_values[PITCH_POSITION] = rc_values[PITCH_POSITION] - adjustStep;     
    
  }
   
      //YAW CLOCKWISE / COUNTER CLOCKWISE
      
      //THROTTLE COMPENSATION
      if((THROTTLE_HORIZONTAL_VALUE-adjustStep) &lt= rc_values[THROTTLE_POSITION] &lt= (THROTTLE_HORIZONTAL_VALUE+adjustStep))
        rc_values[THROTTLE_POSITION] = THROTTLE_HORIZONTAL_VALUE;
      else
      if(rc_values[THROTTLE_POSITION] &lt THROTTLE_HORIZONTAL_VALUE)
        rc_values[THROTTLE_POSITION] = rc_values[THROTTLE_POSITION] + adjustStep;
      
      if(rc_values[THROTTLE_POSITION] &gt THROTTLE_HORIZONTAL_VALUE)
        rc_values[THROTTLE_POSITION] = rc_values[THROTTLE_POSITION] - adjustStep;   
  
}
</pre>
<p><br>Finally, this fail safe AutoPilot <span class="redones">worked very well</span>, and I was able to show some <span class="redones">good avoidance tests</span> that worked also with a single person as an obstacle. Here you can see some videos about:</p>
<iframe width="700" height="450" src="https://www.youtube.com/embed/2-0g-2ahOy4" frameborder="0" allowfullscreen></iframe>
<iframe width="700" height="450" src="https://www.youtube.com/embed/5KyV0pZupyg" frameborder="0" allowfullscreen></iframe>
<p><br>Even if I hadn't the time to test it, and due to my work schedulation, I had ready also an<span class="redones"> AutoPilot version that could be able to circumnavigate some simple obstacles</span>, instead of going away from them. I want to write here the code for who eventually wants to continue my work in the future. I called this version <span class="redones">pillars AutoPilot</span>:</p>
<pre class="prettyprint lang-c">
#include &ltSoftwareSerial.h&gt
#define MSP_RC 105
#define MSP_RAW_RC 200

/////////////MISC VARS///////////////////

bool DEBUG,DEBUG1,DEBUG2;

int readingsCount;

SoftwareSerial mySerial(5,6); // RX, TX

long time1,time2;

bool OBSTACLE_DETECTED;

/////////////AUX1 VARS///////////////

int AUX1_PH; 
byte AUX1_PIN;

////////////AUTOPILOT VARS////////////

bool AUTOPILOT_JUST_STARTED;
bool AUTODISABLED;
bool IMPULSE;
bool AUTOPILOT;
long AUTOPILOT_LIFETIME;
long AUTOPILOT_START_TIME;

int HOVERING;
int FORWARD;
int BACKWARDS;
int LEFT;
int RIGHT;


/////////////SONARS///////////////

//higher = more stable readings but slower and vice-versa,only par values
#define NUM_READINGS 12

int HORIZONTAL_TRESHOLD_DISTANCE;
int MIN_ALTITUDE;

//FRONT
float frontVoltage, frontCm, frontReadings[NUM_READINGS];
bool frontDetected;

//REAR
float rearVoltage, rearCm, rearReadings[NUM_READINGS];
bool rearDetected;

//RIGHT
float rightVoltage, rightCm, rightReadings[NUM_READINGS];
bool rightDetected;

//LEFT
float leftVoltage, leftCm, leftReadings[NUM_READINGS];
bool leftDetected;

//DOWN
float downVoltage, downCm, downReadings[NUM_READINGS];

//////////RC VALUES///////////////////

int ROLL; 
int PITCH; 
int YAW; 
int THROTTLE;
int AUX1;

int ROLL_POSITION;
int PITCH_POSITION;
int YAW_POSITION;
int THROTTLE_POSITION;

int ROLL_MIDDLE;
int PITCH_MIDDLE;
int YAW_MIDDLE;
int THROTTLE_MIDDLE;
int AUX1_MIDDLE;

int MAX_HORIZONTAL_ADJUSTED;
int MIN_HORIZONTAL_ADJUSTED;

bool ADJUST_HORIZONTAL_THROTTLE;

int normalizeStep;
int adjustStep;

////////////MULTIWII COMMUNICATION VARS///////////////
byte rc_response[22];
byte rc_send[8];
uint16_t rc_values[8];

//////////////TEST VARS/////////////////////


//frontal test channel
int specificAdjust = 1; //exclude PITCH
//define specific adjustments for each channel
int specificAdjusts[4];

int THROTTLE_COMPENSATION;
int THROTTLE_HORIZONTAL_VALUE;

int rightCounter; 
int forwardCounter = 5;
int tempCounter1 = 0;
int tempCounter2 = 0;

void setup(){
  
  ///DO NOT TOUCH THESE////////////////////

  THROTTLE_HORIZONTAL_VALUE = 1000;
  
  OBSTACLE_DETECTED = false;
  
  HOVERING = 0;
  FORWARD = 1;
  BACKWARDS = 2;
  LEFT = 3;
  RIGHT = 4;

  
  ROLL_POSITION = 0;
  PITCH_POSITION = 1;
  YAW_POSITION = 2;
  THROTTLE_POSITION = 3;
  
  AUTOPILOT_JUST_STARTED = true;
  AUTODISABLED = false;
  IMPULSE = false;
  
  AUTOPILOT = false;

  frontDetected = false;
  rearDetected = false;
  rightDetected = false;
  leftDetected = false;
 
  mySerial.begin(9600);
  Serial.begin(115200);
  
  AUX1_PIN = 10;
  pinMode(AUX1_PIN, INPUT);
  
  //defualt values for rcsend
  rc_values[0] = 1500;
  rc_values[1] = 1500;
  rc_values[2] = 1500;
  rc_values[3] = 1500;
  rc_values[4] = 1900;
  rc_values[5] = 1500;
  rc_values[6] = 1500;
  rc_values[7] = 1500;
  
  readingsCount = 0;

  //default values for sonars readings
  for(int C=0;C&ltNUM_READINGS;C++)  
    frontReadings[C] = 700;

    
  
  
  //values read from MultiWii
  ROLL = 1500; 
  PITCH = 1500; 
  YAW = 1500; 
  THROTTLE = 1000;
  AUX1 = 1000;

  ///WAIT FOR MULTIWII INIT
  delay(10000);
  
  //////////ADJUSTABLE VALUES/////////////
  
  //minimum rc step for reach hovering values
  normalizeStep = 1;
  //minimum rc step for reach adjusted values
  adjustStep = 15;
  
  //compensate throttle while moving horizontally?
  ADJUST_HORIZONTAL_THROTTLE = true;
  
  //test AUTOPILOT lifetime
  AUTOPILOT_LIFETIME = 1000; //msec
  
  //values for hovering (here maybe is needed to read trimmered values)
  ROLL_MIDDLE = 1500;
  PITCH_MIDDLE = 1500;
  YAW_MIDDLE = 1500;
  THROTTLE_MIDDLE = 1500;
  AUX1_MIDDLE = 1500;
  
  //max/min values for ROLL and PITCH when AUTOPILOT is on
  MAX_HORIZONTAL_ADJUSTED = 1560;
  MIN_HORIZONTAL_ADJUSTED = 1440;
    
  //distance for detect obstacles
  HORIZONTAL_TRESHOLD_DISTANCE = 35; 
  //minimum distance to start obstacle avoidance (problems on the ground!)
  MIN_ALTITUDE = 40; 
  
  //test throttle compensation for horizontal movements
  THROTTLE_COMPENSATION = 20;
    
  DEBUG = false;  
  DEBUG1 = false;
  DEBUG2 = false;

}

void loop(){
  
  //benchmark for fine tuning
  if(DEBUG || DEBUG1 || DEBUG2)
    time1 = millis();
  
  //reset adjustments values
  specificAdjusts[ROLL_POSITION] = 0;
  specificAdjusts[PITCH_POSITION] = 0;
  specificAdjusts[YAW_POSITION] = 0;
  specificAdjusts[THROTTLE_POSITION] = 0;
  
  readSonarData();
  
  //check if autopilot is enabled/disabled
  AUX1_PH = pulseIn(AUX1_PIN, HIGH);
  
  if(DEBUG){

    mySerial.print("A");
    mySerial.print(AUX1_PH);
    mySerial.print(" ");
  
  }
  
  //check sensors data if min altitude is reached
  if(minAltitude(downReadings)){
       
    frontDetected = horizontalObstacleDetected(frontReadings);
    rearDetected = horizontalObstacleDetected(rearReadings);
    rightDetected = horizontalObstacleDetected(rightReadings);
    leftDetected = horizontalObstacleDetected(leftReadings);
    
    if(frontDetected && !OBSTACLE_DETECTED){
    
      OBSTACLE_DETECTED = true;
      specificAdjusts[ROLL_POSITION] = RIGHT;
      ++tempCounter1;
    
    }else
    if(frontDetected && OBSTACLE_DETECTED){
    
      specificAdjusts[ROLL_POSITION] = RIGHT;
      ++tempCounter1;
    
    }else
    if(!frontDetected && OBSTACLE_DETECTED && tempCounter2 &lt10){
    
      specificAdjusts[PITCH_POSITION] = FORWARD;
      ++tempCounter2;
      
    }else
    if(!frontDetected && leftDetected && OBSTACLE_DETECTED){
    
      specificAdjusts[PITCH_POSITION] = FORWARD;
      
    }else
    if(!frontDetected && !leftDetected && OBSTACLE_DETECTED){
    
      specificAdjusts[ROLL_POSITION] = LEFT;
      
      ++rightCounter;
      
      if(tempCounter1 == rightCounter)
        OBSTACLE_DETECTED = false;
      
    }
    

      //OBSTACLE_DETECTED = false;
    
    
    if(DEBUG1){
     
      mySerial.print("AR ");
      
      mySerial.print("FD:");
      mySerial.print(frontDetected);
      mySerial.print(" RED:");
      mySerial.print(rearDetected);
      mySerial.print(" RID:");
      mySerial.print(rightDetected);
      mySerial.print(" LD:");
      mySerial.print(leftDetected);
      mySerial.print(" ");

    }
  
  }else
    if(DEBUG1)
      mySerial.print("ANR ");
      
  if(DEBUG1){   
      
    mySerial.print("OD:");
    mySerial.print(OBSTACLE_DETECTED);
    mySerial.print(" ");
    
  }
   
  //if(AUX1_PH &gt 1750 && !IMPULSE && !AUTODISABLED){
  if(AUX1_PH &gt 1750 && OBSTACLE_DETECTED){ 
    
    AUTOPILOT = true;
    //IMPULSE = true;
  
  }else{
  //if(AUX1_PH &lt= 1750 || !OBSTACLE_DETECTED){
    
    //IMPULSE = false;  
    //AUTODISABLED = false;    
    AUTOPILOT = false;
    AUTOPILOT_JUST_STARTED = true;
  
  }
  
  if(AUTOPILOT){

    if(DEBUG1){
         
      readMultiWiiRCData();
      mySerial.print("APE ");
    
    }
    
        //TEST AUTODISABLE AFTER A TIMEOUT, TAKES LAST THROTTLE VALUE
    if(AUTOPILOT_JUST_STARTED){
   
      //THROTTLE COMPENSATION 
      THROTTLE_HORIZONTAL_VALUE = THROTTLE + THROTTLE_COMPENSATION;
      
      AUTOPILOT_JUST_STARTED = false;
      AUTOPILOT_START_TIME = millis();
      
    }else
    if((millis()-AUTOPILOT_START_TIME) &gt AUTOPILOT_LIFETIME){
     
      //AUTOPILOT_JUST_STARTED = true;
      //AUTOPILOT = false;
      //AUTODISABLED = true;
    
    }
    //////////////////////////AUTOPILOT START//////////////////  
  
    //////////////AUTOMATICALLY ADJUST VALUES//////////////////////
    
    //////////////HOVERING ADJUSTMENTS (except throttle)////////////////
    hoveringAdjustments();
    
    //////////////SPECIFIC ADJUSTMENTS    
    moveHorizontal();
                
    //////////////WRITE VALUES//////////////////////
     writeMultiWiiRCData();
   
  //////////////////////////AUTOPILOT END//////////////////
  
  }else{
    
   if(DEBUG1)
    mySerial.print("APD ");
 
    readMultiWiiRCData();

  }
    
  //delay(10);
  
   //benchmark for fine tuning
 if(DEBUG2 || DEBUG1 || DEBUG){
   
  time2 = millis()-time1;
  mySerial.print("T");
  mySerial.print(time2);
  
  //one return for all
  mySerial.println(); 
  
 }
 
}

void readMWRCRequest(){

    if(Serial.available()){
    
    rc_response[0] = Serial.read();
    rc_response[1] = Serial.read();
    rc_response[2] = Serial.read();
    rc_response[3] = Serial.read();
    rc_response[4] = Serial.read();
    rc_response[5] = Serial.read();
    rc_response[6] = Serial.read();
    rc_response[7] = Serial.read();
    rc_response[8] = Serial.read();
    rc_response[9] = Serial.read();
    rc_response[10] = Serial.read();
    rc_response[11] = Serial.read();
    rc_response[12] = Serial.read();
    rc_response[13] = Serial.read();
    rc_response[14] = Serial.read();
    rc_response[15] = Serial.read();
    rc_response[16] = Serial.read();
    rc_response[17] = Serial.read();
    rc_response[18] = Serial.read();
    rc_response[19] = Serial.read();
    rc_response[20] = Serial.read();
    rc_response[21] = Serial.read();
        
    ROLL = byte2uint16(rc_response[5],rc_response[6]);
    PITCH = byte2uint16(rc_response[7],rc_response[8]);
    YAW = byte2uint16(rc_response[9],rc_response[10]);
    THROTTLE = byte2uint16(rc_response[11],rc_response[12]);
    AUX1 = byte2uint16(rc_response[13],rc_response[14]);
    
    //update rc values
    rc_values[0] = ROLL;
    rc_values[1] = PITCH;
    rc_values[2] = YAW;
    rc_values[3] = THROTTLE;
    rc_values[4] = 1900;
    rc_values[5] = 1500;
    rc_values[6] = 1500;
    rc_values[7] = 1500;
      
    if(DEBUG1){
    
      mySerial.print(ROLL);
      mySerial.print(",");
      mySerial.print(PITCH);
      mySerial.print(",");
      mySerial.print(YAW);
      mySerial.print(",");
      mySerial.print(THROTTLE);
      mySerial.print(",");
      mySerial.print(AUX1);
      mySerial.print(" ");
          
    }       
          
   }else
    if(DEBUG1)
      mySerial.print("n");  
    
}

void mwSerialRequest(int requestMSP){
  
  Serial.write('$');
  Serial.write('M');
  Serial.write('&lt');
  Serial.write((byte)0x00);
  Serial.write(requestMSP);
  Serial.write(requestMSP);

}

void mwSerialCommand(uint8_t opcode, uint8_t * data, uint8_t n_bytes) {
  uint8_t checksum = 0;
   
  // Send the MSP header and message length
  Serial.write((byte *)"$M&lt", 3);
  Serial.write(n_bytes);
  checksum ^= n_bytes;
 
  // Send the op-code
  Serial.write(opcode);
  checksum ^= opcode;
   
  // Send the data bytes
  for(int i = 0; i &lt n_bytes; i++) {
    Serial.write(data[i]);
    checksum ^= data[i];
  }
   
  // Send the checksum
  Serial.write(checksum);
}

int byte2uint16 (byte one,byte two){

  return (one&0xff) + ((two&0xff)&lt&lt8);

}

void uint162byte(uint16_t value,byte bytes[]){
    
  bytes[0] = value & 0xFF; //low
  bytes[1] = value &gt&gt 8; //high

}

bool horizontalObstacleDetected(float readings[]){

    int counter = 0;
  
   for(int C=0;C&ltNUM_READINGS;C++)
     if(readings[C] &lt= HORIZONTAL_TRESHOLD_DISTANCE)
       ++counter;
   
   if(counter &gt (NUM_READINGS/2) )
   return true;

  return false;

}

bool minAltitude(float readings[]){

   int counter = 0;
  
   for(int C=0;C&ltNUM_READINGS;C++)
     if(readings[C] &gt= MIN_ALTITUDE)
       ++counter;
   
   if(counter &gt (NUM_READINGS/2) )
     return true;

  return false;

}

void hoveringAdjustments(){

      if(specificAdjusts[ROLL_POSITION] == HOVERING)
      if((ROLL_MIDDLE-normalizeStep) &lt= rc_values[ROLL_POSITION] &lt= (ROLL_MIDDLE+normalizeStep))
        rc_values[ROLL_POSITION] = ROLL_MIDDLE;
      else
      if(rc_values[ROLL_POSITION] &lt ROLL_MIDDLE)
        rc_values[ROLL_POSITION] = rc_values[ROLL_POSITION] + normalizeStep;
      else
      if(rc_values[ROLL_POSITION] &gt ROLL_MIDDLE)
        rc_values[ROLL_POSITION] = rc_values[ROLL_POSITION] - normalizeStep;

    if(specificAdjusts[PITCH_POSITION] == HOVERING)
      if((PITCH_MIDDLE-normalizeStep) &lt= rc_values[PITCH_POSITION] &lt= (PITCH_MIDDLE+normalizeStep))
        rc_values[PITCH_POSITION] = PITCH_MIDDLE;
      else
      if(rc_values[PITCH_POSITION] &lt PITCH_MIDDLE)
        rc_values[PITCH_POSITION] = rc_values[PITCH_POSITION] + normalizeStep;
      else
      if(rc_values[PITCH_POSITION] &gt PITCH_MIDDLE)
        rc_values[PITCH_POSITION] = rc_values[PITCH_POSITION] - normalizeStep;
        
    if(specificAdjusts[YAW_POSITION] == HOVERING)
      if((YAW_MIDDLE-normalizeStep) &lt= rc_values[YAW_POSITION] &lt= (YAW_MIDDLE+normalizeStep))
        rc_values[YAW_POSITION] = YAW_MIDDLE;
      else
      if(rc_values[YAW_POSITION] &lt YAW_MIDDLE)
        rc_values[YAW_POSITION] = rc_values[YAW_POSITION] + normalizeStep;
      else
      if(rc_values[YAW_POSITION] &gt YAW_MIDDLE)
        rc_values[YAW_POSITION] = rc_values[YAW_POSITION] - normalizeStep;
        
    if(specificAdjusts[THROTTLE_POSITION] == HOVERING)
      if((THROTTLE_MIDDLE-normalizeStep) &lt= rc_values[THROTTLE_POSITION] &lt= (THROTTLE_MIDDLE+normalizeStep))
        rc_values[THROTTLE_POSITION] = THROTTLE_MIDDLE;
      else
      if(rc_values[THROTTLE_POSITION] &lt THROTTLE_MIDDLE)
        rc_values[THROTTLE_POSITION] = rc_values[THROTTLE_POSITION] + normalizeStep;
      else
      if(rc_values[THROTTLE_POSITION] &gt YAW_MIDDLE)
        rc_values[THROTTLE_POSITION] = rc_values[THROTTLE_POSITION] - normalizeStep;
        
}

void readMultiWiiRCData(){

    mwSerialRequest(MSP_RC);
  
    delay(50);

    readMWRCRequest();
  
}

void writeMultiWiiRCData(){

    for(int C=0;C&lt8;C++){
    
      byte bytes[2];
      uint162byte(rc_values[C],bytes);
  
      rc_send[C*2] = bytes[0];
      rc_send[(C*2)+1] = bytes[1];
  
    }
    
    //write rc values
    mwSerialCommand(MSP_RAW_RC,rc_send,16);

}

void readSonarData(){

    //read sensors values
  frontVoltage =  analogRead(A5); //FRONT
  rearVoltage =  analogRead(A4); //REAR
  downVoltage =  analogRead(A2); //DOWN
  leftVoltage =  analogRead(A1); //LEFT
  rightVoltage = analogRead(A0); //RIGHT

  //convert values
  frontCm = (frontVoltage/1024)*1000;
  frontReadings[readingsCount] = frontCm;
  
  rearCm = (rearVoltage/1024)*1000;
  rearReadings[readingsCount] = rearCm;
  
  rightCm = (rightVoltage/1024)*1000;
  rightReadings[readingsCount] = rightCm;
  
  leftCm = (leftVoltage/1024)*1000;
  leftReadings[readingsCount] = leftCm;
  
  downCm = (downVoltage/1024)*1000;
  downReadings[readingsCount] = downCm;
  
    ++readingsCount;
  if(readingsCount &gt= NUM_READINGS)
    readingsCount = 0;
  
    if(DEBUG){
  
    //send data to serial
    mySerial.print("F");
    mySerial.print(frontCm);
    mySerial.print(" ");
  
    mySerial.print("RE");
    mySerial.print(rearCm);
    mySerial.print(" ");
  
    mySerial.print("RI");
    mySerial.print(rightCm);
    mySerial.print(" ");
  
    mySerial.print("L");
    mySerial.print(leftCm);
    mySerial.print(" ");
  
    mySerial.print("D");
    mySerial.print(downCm);
    mySerial.print(" ");
 
  }

}

void moveHorizontal(){
  
  //ROLL RIGHT
  if(specificAdjusts[ROLL_POSITION] == RIGHT){
    
      if((MAX_HORIZONTAL_ADJUSTED-adjustStep) &lt= rc_values[ROLL_POSITION] &lt= (MAX_HORIZONTAL_ADJUSTED+adjustStep))
        rc_values[ROLL_POSITION] = MAX_HORIZONTAL_ADJUSTED;
      else
      if(rc_values[ROLL_POSITION] &lt MAX_HORIZONTAL_ADJUSTED)
        rc_values[ROLL_POSITION] = rc_values[ROLL_POSITION] + adjustStep;
      else
      if(rc_values[ROLL_POSITION] &gt MAX_HORIZONTAL_ADJUSTED)
        rc_values[ROLL_POSITION] = rc_values[ROLL_POSITION] - adjustStep;
      
  }else//ROLL LEFT
  if(specificAdjusts[ROLL_POSITION] == LEFT){
    
      if((MIN_HORIZONTAL_ADJUSTED-adjustStep) &lt= rc_values[ROLL_POSITION] &lt= (MIN_HORIZONTAL_ADJUSTED+adjustStep))
        rc_values[ROLL_POSITION] = MIN_HORIZONTAL_ADJUSTED;
      else
      if(rc_values[ROLL_POSITION] &lt MIN_HORIZONTAL_ADJUSTED)
        rc_values[ROLL_POSITION] = rc_values[ROLL_POSITION] + adjustStep;
      
      if(rc_values[ROLL_POSITION] &gt MIN_HORIZONTAL_ADJUSTED)
        rc_values[ROLL_POSITION] = rc_values[ROLL_POSITION] - adjustStep;     
    
  }
  
    //PITCH FORWARD
  if(specificAdjusts[PITCH_POSITION] == FORWARD){
    
      if((MAX_HORIZONTAL_ADJUSTED-adjustStep) &lt= rc_values[PITCH_POSITION] &lt= (MAX_HORIZONTAL_ADJUSTED+adjustStep))
        rc_values[PITCH_POSITION] = MAX_HORIZONTAL_ADJUSTED;
      else
      if(rc_values[PITCH_POSITION] &lt MAX_HORIZONTAL_ADJUSTED)
        rc_values[PITCH_POSITION] = rc_values[PITCH_POSITION] + adjustStep;
      else
      if(rc_values[PITCH_POSITION] &gt MAX_HORIZONTAL_ADJUSTED)
        rc_values[PITCH_POSITION] = rc_values[PITCH_POSITION] - adjustStep;
      
  }else//PITCH BACKWARDS
  if(specificAdjusts[PITCH_POSITION] == BACKWARDS){
    
      if((MIN_HORIZONTAL_ADJUSTED-adjustStep) &lt= rc_values[PITCH_POSITION] &lt= (MIN_HORIZONTAL_ADJUSTED+adjustStep))
        rc_values[PITCH_POSITION] = MIN_HORIZONTAL_ADJUSTED;
      else
      if(rc_values[PITCH_POSITION] &lt MIN_HORIZONTAL_ADJUSTED)
        rc_values[PITCH_POSITION] = rc_values[PITCH_POSITION] + adjustStep;
      
      if(rc_values[PITCH_POSITION] &gt MIN_HORIZONTAL_ADJUSTED)
        rc_values[PITCH_POSITION] = rc_values[PITCH_POSITION] - adjustStep;     
    
  }
   
      //YAW CLOCKWISE / COUNTER CLOCKWISE
      
      //THROTTLE COMPENSATION
      if((THROTTLE_HORIZONTAL_VALUE-adjustStep) &lt= rc_values[THROTTLE_POSITION] &lt= (THROTTLE_HORIZONTAL_VALUE+adjustStep))
        rc_values[THROTTLE_POSITION] = THROTTLE_HORIZONTAL_VALUE;
      else
      if(rc_values[THROTTLE_POSITION] &lt THROTTLE_HORIZONTAL_VALUE)
        rc_values[THROTTLE_POSITION] = rc_values[THROTTLE_POSITION] + adjustStep;
      
      if(rc_values[THROTTLE_POSITION] &gt THROTTLE_HORIZONTAL_VALUE)
        rc_values[THROTTLE_POSITION] = rc_values[THROTTLE_POSITION] - adjustStep;   
  
}
</pre>

<p><br>Here you can dowload all the AutoPilot versions I've talked about: <a href="other/autopilots.rar"><span class="redones-link">download</span></a>.</p>
			</div>
		</section>

		<section id= "project15" class="row">
			<div class="photo-grid">
				<p>In this final project section we'll see how AAVOID v3 could be considered as a <span class="redones">"Thing" of an IoT system</span>. With the objective of giving to AAVOID v3 <span class="redones">an high level, deliberative AutoPilot system</span>, one of its scheduled and to be implemented features was to be able to get an <span class="redones">Android smartphone onboard</span>. Smartphone onboard means that non only the smartphone is physically onboard of the quadcopter, but also, that is connected and it <span class="redones">interacts with AAVOID v3 board</span>. To clear things a bit, here's <span class="redones">AAVOID hardware architecture</span>, in which you can see how the smartphone will communicate with the AutoPilot board:</p>

				<img class="images-default" style="width: 65%" src="img/final_project/AAVOID_CU.png">

				<p>Due to the need of the <span class="redones">hardware serial</span> in order to quickly communicate with MultiWii, the only chance to communicate with the smartphone was <span class="redones">software serial</span> through an hardware brigde made with an <span class="redones">FTDI usb cable followed by an OTG usb cable</span>. With this bridge, the use of <a href="https://github.com/ksksue/PhysicaloidLibrary"><span class="redones-link">PhysicaloidLibrary</span></a>, and a <span class="redones">maximum baud rate of 9600</span>, I was able to establish the communication <span class="redones">between the AAVOID Autopilot microcontroller and the Android smartphone</span>. Obviously the Android smartphone must support <span class="redones">hardware OTG</span>. USB power from OTG is welcome, but not strictly required, as the Autopilot microcontroller was powered from one of the ESCs BEC.</p> 

				<p>Having onboard an <span class="redones">internet connected</span>, Android smartphone, that can also communicate with the <span class="redones">AutoPilot microcontroller</span>, which in turn can <span class="redones">direct control AAVOID movements</span>, clears me how <span class="redones">AAVOID can be low level controlled directly from internet</span>. Also, with the use of a in-the-middle server, it can <span class="redones">communicate with other "Things"</span>, or even with <span class="redones">other AAVOID quadcopters</span>, no matter where they are in the world. Let's get details of <span class="redones">AAVOID IoT system</span>. Here's <span class="redones">AAVOID software architecture</span>:</p>
				
				<img class="images-default" style="width: 65%" src="img/final_project/6.5/AAVOID_SA.jpg">
				
				<p>As you can see, onboard and starting from the lowest level, you can find <span class="redones">MultiWii software followed by the AutoPilot</span>. These two softwares are implemented to run directly on the two microcontrollers of AAVOID v3 board. On the Android smartphone runs an Android app with <span class="redones">PRACTIONISTDroid</span>. PRACTIONISTDroid is my <span class="redones">Android port</span> of <a href="http://practionist.eng.it/"><span class="redones-link">PRACTIcal resONIng sySTem</span></a>. PRACTIONIST is our company's <a href="https://en.wikipedia.org/wiki/Belief%E2%80%93desire%E2%80%93intention_software_model"><span class="redones-link">Michael Bratman BDI theory<span></a> inspired <span class="redones">Multiple Agent System</span> we've developed in order to implement high level, complex and cooperation capable agent behaviours. To avoid bandwidth waste and try to use something that will be as much near as possbile to a real-time protocol, I chose to use <span class="redones">Websocket</span>. So I implemented a simple <span class="redones">Websocket Java server</span>, that continuously receives data from an <span class="redones">Websocket client</span>, embedded in PRACTIONISTDroid app. Websocket java server, other than receiving data from AAVOID, expose it to internet for any client that wants to retrieve it, such as the <span class="redones">PC</span> in the schema (but could be also another smartphone). PC serves also as <span class="redones">serial console</span> for debugging purposes.</p>
				
				<p>It's time to read some code. To develop I used <a href=""><span class="redones-link">Eclipse IDE</span></a> (Kepler version), with Android plugin installed. I will talk here of the <span class="redones">main parts</span>, if you want it all, you can download it at bottom of the page. As already said, as Android serial library I used <a href="https://github.com/ksksue/PhysicaloidLibrary"><span class="redones-link">PhysicaloidLibrary</span></a>. Due to the name of AAVOID, I called the PRACTIONISTDroid app <span class="redones">PRACTIONISTVoid</span>. The smartphone used is an Asus ZenFone 4, one of the cheapest and smallest smartphone with built-in OTG hardware support. Here you can read the <span class="redones">Android activity</span> of PRACTIONISTVoid:</p>				
				<pre class="prettyprint lang-c">
package org.practionist.aavoid;

import java.util.concurrent.ArrayBlockingQueue;

import org.practionist.Constants;
import org.practionist.container.message.RemoteManagementReceiverMessage;
import org.practionist.container.message.ThreadMessage;
import org.practionist.container.utility.StartContainer;
import org.practionist.container.utility.SyncBoolean;

import android.app.Activity;
import android.os.AsyncTask;
import android.os.Bundle;
import android.widget.TextView;

import com.physicaloid.lib.Physicaloid;


public class AAVOID_Activity extends Activity {
    
    private  TextView tvRead;
    private SyncBoolean remoteOk = new SyncBoolean(false);
    private RemoteManagementReceiverMessage remoteManagementReceiverMessage;
    private ArrayBlockingQueue&ltThreadMessage&gt commands = new ArrayBlockingQueue&ltThreadMessage&gt(100, true);
    private StartContainer startContainer = new StartContainer(commands, remoteOk);
    
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_tutorial1);

        
        tvRead  = (TextView) findViewById(R.id.tvRead);

        PRACTIONISTVoidConstants.SERIAL = new Physicaloid(this);
        PRACTIONISTVoidConstants.SERIAL.open();
        
        
    	try{
        	
    		startContainer.start();
    	
    		remoteManagementReceiverMessage = new RemoteManagementReceiverMessage();
        	remoteManagementReceiverMessage.setTextMessage("c1");
    		commands.put(remoteManagementReceiverMessage);
    		
			remoteManagementReceiverMessage = new RemoteManagementReceiverMessage();
			remoteManagementReceiverMessage.setTextMessage
			("addAgent org.practionist.aavoid.agent.AAVOIDAgent AAVOIDAgent");
			commands.put(remoteManagementReceiverMessage);
			
			remoteManagementReceiverMessage = new RemoteManagementReceiverMessage();
			remoteManagementReceiverMessage.setTextMessage("setStandAlone true");
			commands.put(remoteManagementReceiverMessage);
			
			remoteManagementReceiverMessage = new RemoteManagementReceiverMessage();
			remoteManagementReceiverMessage.setTextMessage("startContainer");
			commands.put(remoteManagementReceiverMessage);
			
			remoteManagementReceiverMessage = new RemoteManagementReceiverMessage();
			remoteManagementReceiverMessage.setTextMessage("getContainerStatus");
			commands.put(remoteManagementReceiverMessage);
    		    		
    	}catch (InterruptedException e){
    		
    		e.printStackTrace();
    	
    	}	
        
        new UpdateLog().execute();
        
    }

    
    private class UpdateLog extends AsyncTask&ltObject, String, Object&gt {

		 private String log;
		 private boolean exit;
		 private int lineCounter = 0;
		 
		 
		 protected Long doInBackground(Object... urls) {

			 while(!exit){
				 
				 try {
						
					 log = Constants.ANDROID_LOGS.take();
					 publishProgress(log);
					
				} catch (InterruptedException e) {
					
					e.printStackTrace();
				
				} 
				 
			 }
			 
	         return null;
	         
		 }
		 
	     protected void onProgressUpdate(String... logs) {
	    	 
	    	 tvRead.append(logs[0]);
	    	 
	    	 ++lineCounter;
	    	 
	    	 if(lineCounter > 8){
	    		 tvRead.setText("");
	    		 lineCounter = 0;
	    	 }
	    	 	    	 
	     }

	     protected void onPostExecute(Object result) {
	         
	     }
	 }

}				</pre>
				
				<p><br> And here's the <span class="redones">start plan of the PRACTIONISTDroid agent</span>, that in turn uses a shared utility method, in order to read data from serial:</p>
				
				<pre class="prettyprint lang-c">
package org.practionist.aavoid.agent.plan;

import org.practionist.Constants;
import org.practionist.aavoid.PRACTIONISTVoidConstants;
import org.practionist.aavoid.PRACTIONISTVoidUtils;
import org.practionist.container.utility.Logger;
import org.practionist.plan.PlanExecutionException;
import org.practionist.plan.library.StartPlan;

public class ReadSensorsData extends StartPlan{

	private boolean exit = false;
	
	@Override
	protected void body() throws PlanExecutionException {
		
		Logger.putLog(getClass().getName()+" PRACTICAL");
		String read;
		
		while(!exit){
			
			read = PRACTIONISTVoidUtils.readSerial();
			
			if(read!=null)
			try {
				
				Constants.ANDROID_LOGS.put(read);
				
				try{
					
					PRACTIONISTVoidConstants.REALTIME_DATA_QUEUE.add(read);

				}catch(IllegalStateException e){
					
					Constants.ANDROID_LOGS.put("WARNING: REALTIME_DATA_QUEUE is full");
					
				}
							
			} catch (InterruptedException e1) {
				
				e1.printStackTrace();
			
			}
			
            try {
                
            	Thread.sleep(50);
            
            } catch (InterruptedException e) {
                
            	e.printStackTrace();
            
            }
			
		}
		
	}

}				</pre>
<pre class="prettyprint lang-c">
package org.practionist.aavoid;

import java.io.UnsupportedEncodingException;

public class PRACTIONISTVoidUtils {
	
	public static String readSerial(){
		
        byte[] buf = new byte[256];
        int readSize=0;
		
        readSize = PRACTIONISTVoidConstants.SERIAL.read(buf);
        
        if(readSize>0) {
            String str;
            try {
            	
                str = new String(buf, "UTF-8");
                
                return str;
                
            } catch (UnsupportedEncodingException e) {}
        
            
            
        }
		
        return null;
        
	}
	
}
</pre>
		<p><br>In the first test I've made, I used one of the sketches from <a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project13').innerHTML,'project13')"><span class="redones-link">6.3 Input devices: sonars tests</span></a>. From this sketch, uploaded onto AutoPilot microcontroller, is coming data read from the above start plan, to be sent to the Java Websocket server:</p>
	<pre class="prettyprint lang-c">
//REAR
const int rearPwPin = 8;
long rearPulse, rearCm;

const int BAUD_RATE = 9600;
const int SAMPLE_RATE = 10;

void setup() {
 
  //init serial
  Serial.begin(BAUD_RATE);
  
    //set pin modes
  pinMode(rearPwPin, INPUT);
  
}

void loop() {

  //read sensors values
  rearPulse = pulseIn(rearPwPin, HIGH);
  
  //convert values
  rearCm = rearPulse/58;
  
  //send data to serial
  Serial.print("RE");
  Serial.print(rearCm);
    
  Serial.println();
  
  delay(SAMPLE_RATE);
 
} 	</pre>	

	<p><br>As Websocket library on Android and on the server I used <a href="https://tyrus.java.net/"><span class="redones-link">tyrus</span></a>. You can use tyrus on Android as stated on this <a href="https://blogs.oracle.com/PavelBucek/entry/websocket_client_on_android_tyrus"><span class="redones-link">blog</span></a>. So, to send data from the Android app, I used the following, very simple, <span class="redones">Websocket client</span>:</p>
	<pre class="prettyprint lang-c">
package org.practionist.aavoid.websocket;


import java.io.IOException;

import javax.websocket.ClientEndpoint;
import javax.websocket.CloseReason;
import javax.websocket.OnClose;
import javax.websocket.OnMessage;
import javax.websocket.OnOpen;
import javax.websocket.Session;
 
@ClientEndpoint
public class WebSocketClient {
 
    @OnOpen
    public void onOpen(Session session) {
        
        try {
        
        	session.getBasicRemote().sendText("PRACTIONISTVoid connected");
        
        } catch (IOException e) {
        	
            throw new RuntimeException(e);
        
        }
        
    }
 
    @OnMessage
    public void onMessage(String message, Session session) {
    	
    }
 
    @OnClose
    public void onClose(Session session, CloseReason closeReason) {
        
    }
 
 
}
	</pre>
	<p><br>This client is used by a <span class="redones">separate thread</span>, which is in charge of send the data. This thread communicates with the agent's start plan, via an <span class="redones">ArrayBlockingQueue</span>, a thread safe FIFO, buffer:</p>
<pre class="prettyprint lang-c">
package org.practionist.aavoid.thread;

import java.io.IOException;
import java.net.URI;
import java.net.URISyntaxException;

import javax.websocket.DeploymentException;
import javax.websocket.Session;

import org.glassfish.tyrus.client.ClientManager;
import org.practionist.Constants;
import org.practionist.aavoid.PRACTIONISTVoidConstants;
import org.practionist.container.utility.Logger;

import org.practionist.aavoid.websocket.WebSocketClient;

public class SendRealTimeData extends Thread{
	private boolean exit = false;
	
	@Override
	public void run(){
		
		Logger.putLog(getClass().getName()+" STARTED");
		
		Object bufferObject;
		
		while(!exit){//try to reconnect to websocket
		
		//connect via websocket
		try {
		
			Session session = new ClientManager()
			.connectToServer(WebSocketClient.class,
			 new URI(PRACTIONISTVoidConstants.WEBSOCKET_URI));
		
			try {
				Constants.ANDROID_LOGS.put("Connected to remote websocket");
			} catch (InterruptedException e1) {
				// TODO Auto-generated catch block
				e1.printStackTrace();
			}
			
			while(!exit){
				
				 try {
						
					 bufferObject = PRACTIONISTVoidConstants.REALTIME_DATA_QUEUE.take();
					 
					 //identify object
					 if(bufferObject instanceof java.lang.String){
						 
						 session.getBasicRemote()
						 .sendText("i "+(String)bufferObject); 
						 
					 }
					 
					 
				} catch (InterruptedException e) {
					
					e.printStackTrace();
				
				} 
				
	            try {
	                
	            	Thread.sleep(50);
	            
	            } catch (InterruptedException e) {
	                
	            	e.printStackTrace();
	            
	            }
				
			}
		
		} catch (DeploymentException e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
		} catch (IOException e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
		} catch (URISyntaxException e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
		}
		
        try {
            
        	Thread.sleep(500);
        
        } catch (InterruptedException e) {
            
        	e.printStackTrace();
        
        }
		
	}
		
	}

}
</pre>

				<p><br>Talking about the <span class="redones">Websocket Java server</span>, same as PRACTIONISTVoid app, it uses tyrus as Java Websocket implementation. The server is a Linux Mint machine, that runs in my personal room inside my home. So, here's the server endpoint class:</p>
<pre class="prettyprint lang-c">
package practionist.aavoid.server.endpoints;

import javax.websocket.CloseReason;
import javax.websocket.OnClose;
import javax.websocket.OnMessage;
import javax.websocket.OnOpen;
import javax.websocket.Session;
import javax.websocket.server.ServerEndpoint;

import practionist.aavoid.server.ServerConstants;
import practionist.aavoid.server.uitl.ClientDataSender;

@ServerEndpoint(value = "/data")
public class DataEndpoint {

	
	
    @OnOpen
    public void onOpen(Session session) {
    	
        ServerConstants.LOGGER.info("connected " + session.getId());
    
    }

    @OnMessage
    public String onMessage(String message, Session session) {
    	
    	ServerConstants.LOGGER.info("string received: " + message);
    	
    	//check is an input, or a request
    	
    	String data[] = message.split(" ");
    	
    	if(data.length >0){
    		
    		if(data[0].equals(ServerConstants.INPUT_REQUEST)){
    			
    	    	try{
    	        	
    	        	ServerConstants.DATA_BUFFER.add(data[1]);
    	        	
    	        	return "OK";
    	        	
    	        	}catch(IllegalStateException e){
    	        		
    	        		ServerConstants.LOGGER.info("WARNING: DATA BUFFER is full");
    	        		
    	        		try {
    	    				
    	        			ServerConstants.DATA_BUFFER.take();
    	    				
    	    			} catch (InterruptedException e1) {
    	    				// TODO Auto-generated catch block
    	    				e1.printStackTrace();
    	    			}
    	        		
    	        		ServerConstants.DATA_BUFFER.add(data[1]);
    	        		return "OK";
    	        	}
    			
    		}else
    		if(data[0].equals(ServerConstants.OUTPUT_REQUEST)){
    		
    			//send data to front end client
    			new ClientDataSender(session).start();
    		
    		}
    		
    	}
    	
    	return "";
    	
    }
    
    @OnClose
    public void onClose(Session session, CloseReason closeReason) {
    	
    	ServerConstants.LOGGER.info(String.format("session %s closed because of %s", session.getId(), closeReason));

    }
    
}
</pre>
<p><br>As you can see, again I used Java ArrayBlockingQueue, and the server is able to distinguish two different kinds of messages: <span class="redones">INPUT_REQUEST</span> and <span class="redones">OUTPUT_REQUEST</span>. INPUT_REQUEST is used from the PRACTIONISTVoid client to send data to the server, while  OUTPUT_REQUEST is used by external clients that want to retrieve data. Also the server has its own thread to send data to external clients:</p>
<pre class="prettyprint lang-c">
package practionist.aavoid.server.uitl;

import java.io.IOException;

import javax.websocket.Session;

import practionist.aavoid.server.ServerConstants;

public class ClientDataSender extends Thread{
	
	private Session session;
	private boolean exit = false;
	
	public ClientDataSender(Session s){
		
		session = s;
		
	}
	
	public void run(){
		
		
		while(!exit){
		
			try {
				
				session.getBasicRemote().sendText((String)ServerConstants.DATA_BUFFER.take()+"");
				
			} catch (InterruptedException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
				
			} catch (IOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		
		
		}
				
		
	}

}
</pre>

<p><br>To show all this system working <span class="redones">I did two tests</span>. <span class="redones">The first test</span> is using the above sketch, and as PC Websocket client I used <a href="https://chrome.google.com/webstore/detail/simple-websocket-client/pfdhoblngboilpfeibdedpjgfnlcodoo"><span class="redones-link">Simple Web Socket for Chrome</span></a>. Here's a video about:</p>

				<iframe width="700" height="450" src="https://www.youtube.com/embed/xfCqPxrfgQI" frameborder="0" allowfullscreen></iframe>

<p><br>The second test I did, is using another sketch from <a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project13').innerHTML,'project13')"><span class="redones-link">6.3 Input devices: sonars tests</span></a>:</p>
<pre class="prettyprint lang-c">
//FRONT
const int frontPwPin = 8;
long frontPulse, frontCm;

//REAR
const int rearPwPin = 9;
long rearPulse, rearCm;

//RIGHT
const int rightPwPin = 10;
long rightPulse, rightCm;

//LEFT
const int leftPwPin = 11;
long leftPulse, leftCm;

//UP
const int upPwPin = 12;
long upPulse, upCm;

//DOWN
const int downPwPin = 13;
long downPulse, downCm;

const int BAUD_RATE = 9600;
const int SAMPLE_RATE = 10;

void setup() {
 
  //init serial
  Serial.begin(BAUD_RATE);
  
    //set pin modes
  pinMode(frontPwPin, INPUT);
  pinMode(rearPwPin, INPUT);
  pinMode(rightPwPin, INPUT);
  pinMode(leftPwPin, INPUT);
  pinMode(upPwPin, INPUT);
  pinMode(downPwPin, INPUT);
  
}

void loop() {

  //read sensors values
  frontPulse = pulseIn(frontPwPin, HIGH);
  rearPulse = pulseIn(rearPwPin, HIGH);
  rightPulse = pulseIn(rightPwPin, HIGH);
  leftPulse = pulseIn(leftPwPin, HIGH);
  downPulse = pulseIn(downPwPin, HIGH);
  upPulse = pulseIn(upPwPin, HIGH);
  
  //convert values
  frontCm = frontPulse/58;
  rearCm = rearPulse/58;
  rightCm = rightPulse/58;
  leftCm = leftPulse/58;
  downCm = downPulse/58;
  upCm = upPulse/58;
  
  //send data to serial
  Serial.print("F");
  Serial.print(frontCm);
  Serial.print(",");
  
  Serial.print("RE");
  Serial.print(rearCm);
  Serial.print(",");
  
  Serial.print("RI");
  Serial.print(rightCm);
  Serial.print(",");
  
  Serial.print("L");
  Serial.print(leftCm);
  Serial.print(",");
  
  Serial.print("D");
  Serial.print(downCm);
  Serial.print(",");
  
  Serial.print("U");
  Serial.print(upCm);
  
  Serial.println();
  
  delay(SAMPLE_RATE);
 
} 
</pre>
<p><br>And also I used another kind of Websocket client, because of I wanted to do the test outside. So this time there was an Android Websocket client: <a href="https://play.google.com/store/apps/details?id=com.quaksire.websocket&hl=it"><span class="redones-link">WebSockets app</span></a>. In this case another smarthone is retrieving the data. So finally, here's the video of all the system while is working in flight:</p>
<iframe width="700" height="450" src="https://www.youtube.com/embed/dUcz4klzBwY" frameborder="0" allowfullscreen></iframe>

	<p><br>Here you can download all the code I've made for this section: <a href="other/AAVOID_IOT.rar"><span class="redones-link">AAVOID_IOT</span></a>.</p>

			</div>
		</section>

		<section id= "middle" class="row">
			<div class="col-full">
			</div>
		</section>

		<section id= "exercises" class="row">
			<div class="photo-grid">
				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('week1').innerHTML,'week1')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">1. principles and practices, project management</span></a>

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('week2').innerHTML,'week2')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">2. computer-aided design</span></a>

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('week3').innerHTML,'week3')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">3. computer-controlled cutting</span></a>

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('week4').innerHTML,'week4')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">4. electronics production</span></a>

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('week5').innerHTML,'week5')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">5. 3D scanning and printing</span></a>
				

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('week6').innerHTML,'week6')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">6. electronics design</span></a>
				

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('week7').innerHTML,'week7')" rel="lightbox" class="col-2" style="font-weight: bold;"><span class="redones">7. embedded programming</span></a>

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('week8').innerHTML,'week8')" rel="lightbox" class="col-2" style="font-weight: bold;"><span class="redones">8. computer-controlled machining</span></a>


				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('week9').innerHTML,'week9')" rel="lightbox" class="col-2" style="font-weight: bold;"><span class="redones">9. molding and casting</span></a>
				

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('week10').innerHTML,'week10')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">10. input devices</span></a>
				
				
				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('week11').innerHTML,'week11')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">11. output devices</span></a>
				
				
				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('week12').innerHTML,'week12')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">12. composites</span></a>
				
				
				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('week13').innerHTML,'week13')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">13. networking and communications</span></a>
				
				
				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('week14').innerHTML,'week14')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">14. interface and application programming</span></a>

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('project3').innerHTML,'project3')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">15. applications and implications</span></a>
				

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('final_project').innerHTML,'final_project')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">16. project development</span></a>

				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('week16').innerHTML,'week16')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">17. mechanical design, machine design</span></a>
			
				
				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('week17').innerHTML,'week17')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">18. invention, intellectual property, and income</span></a>
				
				<a href="javascript:ReplaceContentInContainer('middle',document.getElementById('week19').innerHTML,'week19')" rel="lightbox" class="col-2"><span class="redones" style="font-weight: bold;">19. project presentation</span></a>

			</div>
		</section>

		<section class="row">
			
			<canvas id="cv" width=640 height=480>
				It seems you are using an outdated browser that does not support canvas :-(
			</canvas>
			<canvas id="cv1" width=640 height=480>
				It seems you are using an outdated browser that does not support canvas :-(
			</canvas>
			<canvas id="cv2" width=640 height=480>
				It seems you are using an outdated browser that does not support canvas :-(
			</canvas>
			<canvas id="cv3" width=640 height=480>
				It seems you are using an outdated browser that does not support canvas :-(
			</canvas>
			<canvas id="cv4" width=640 height=480>
				It seems you are using an outdated browser that does not support canvas :-(
			</canvas>
			<canvas id="cv5" width=640 height=480>
				It seems you are using an outdated browser that does not support canvas :-(
			</canvas>
			<p></p>
			<div class="col-full">
				<p>
					Source code is licensed under the terms of the GNU Lesser General Public License v2.1 (<a  class="redones-link" href="http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html">LGPL</a>). Projects, drawings, images and videos are licensed under Attribution-NonCommercial-ShareAlike 4.0 International (<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="redones-link">CC BY-NC-SA 4.0</a>). <span class="redones">Daniele Ingrassia 2015</span>.
				</p>
			</div>
		</section>
 
	</div>

	<script>
	if (!window.jQuery) 
	{
	    document.write('<script src="js/vendor/jquery.1.11.min.js"><\/script>');
	}
	</script>

	<script type="text/javascript" src="js/vendor/jquery.fluidbox.min.js"></script>
	<script type="text/javascript" src="js/run_prettify.js"></script>
	<script type="text/javascript" src="js/main.js"></script>
	

	<script type="text/javascript">
		

		window.onload = function () { 


					
					var canvas = document.getElementById('cv');
					canvas.style.display="none";
					var canvas1 = document.getElementById('cv1');
					canvas1.style.display="none";
					var canvas2 = document.getElementById('cv2');
					canvas2.style.display="none";
					var canvas3 = document.getElementById('cv3');
					canvas3.style.display="none";
					var canvas4 = document.getElementById('cv4');
					canvas4.style.display="none";
					var canvas5 = document.getElementById('cv5');
					canvas5.style.display="none";


					//ReplaceContentInContainer('middle',document.getElementById('about').innerHTML)
					//document.getElementById('ab').style.color = '#ced9e0';

					ReplaceContentInContainer('middle',document.getElementById('project0').innerHTML)
					document.getElementById('project0').style.color = '#ced9e0';

		 }


		function ReplaceContentInContainer(id,content,endId) {

			//$("#week2").insertBefore("#cv1");

			var canvas = document.getElementById('cv');
			canvas.style.display="none";
			var canvas1 = document.getElementById('cv1');
			canvas1.style.display="none";
			var canvas2 = document.getElementById('cv2');
			canvas2.style.display="none";
			var canvas3 = document.getElementById('cv3');
			canvas3.style.display="none";
			var canvas4 = document.getElementById('cv4');
			canvas4.style.display="none";
			var canvas5 = document.getElementById('cv5');
			canvas5.style.display="none";

			var container = document.getElementById(id);
			container.innerHTML = content;

			document.getElementById('ex').style.color = '#e85151';
			document.getElementById('ab').style.color = '#e85151';
			document.getElementById('co').style.color = '#e85151';
			document.getElementById('fp').style.color = '#e85151';

			if(endId=='exercises'){
				document.getElementById('ex').style.color = '#ced9e0';
			}else
			if(endId=='about'){
				document.getElementById('ab').style.color = '#ced9e0';
			}else
			if(endId=='contact'){
				document.getElementById('co').style.color = '#ced9e0';
			}else
			if(endId=='final_project'){
				document.getElementById('fp').style.color = '#ced9e0';
			}else
			if(endId=='week2'){
				
				var canvas = document.getElementById('cv');
			    var viewer = new JSC3D.Viewer(canvas);
			    viewer.setParameter('SceneUrl','drawings/cubic_frame.obj');
			    viewer.setParameter('ModelColor','#FFFFFF');
			    viewer.setParameter('BackgroundColor1','##CCCCA3');
			    viewer.setParameter('BackgroundColor2','##CCCCA3');
			    viewer.setParameter('RenderMode','flat');
			    viewer.setParameter('MipMapping','on');
			    viewer.setParameter('Definition','high');
			    viewer.setParameter('Renderer','webgl');
			    viewer.init();
			    viewer.update();

			    canvas.style.display="block";

			}else
			if(endId=='week5'){
				
				var canvas1 = document.getElementById('cv1');
			    var viewer = new JSC3D.Viewer(canvas1);
			    viewer.setParameter('SceneUrl','drawings/week5/spheres.obj');
			    viewer.setParameter('ModelColor','#FFFFFF');
			    viewer.setParameter('BackgroundColor1','##CCCCA3');
			    viewer.setParameter('BackgroundColor2','##CCCCA3');
			    viewer.setParameter('RenderMode','flat');
			    viewer.setParameter('MipMapping','on');
			    viewer.setParameter('Definition','high');
			    viewer.setParameter('Renderer','webgl');
			    viewer.init();
			    viewer.update();

			    canvas1.style.display="block";

			    var canvas2 = document.getElementById('cv2');
			    var viewer = new JSC3D.Viewer(canvas2);
			    viewer.setParameter('SceneUrl','drawings/week5/fractal_tube.obj');
			    viewer.setParameter('ModelColor','#FFFFFF');
			    viewer.setParameter('BackgroundColor1','##CCCCA3');
			    viewer.setParameter('BackgroundColor2','##CCCCA3');
			    viewer.setParameter('RenderMode','flat');
			    viewer.setParameter('MipMapping','on');
			    viewer.setParameter('Definition','high');
			    viewer.setParameter('Renderer','webgl');
			    viewer.init();
			    viewer.update();

			    canvas2.style.display="block";

			 	var canvas3 = document.getElementById('cv3');
			    var viewer = new JSC3D.Viewer(canvas3);
			    viewer.setParameter('SceneUrl','drawings/week5/scan.obj');
			    viewer.setParameter('ModelColor','#FFFFFF');
			    viewer.setParameter('BackgroundColor1','##CCCCA3');
			    viewer.setParameter('BackgroundColor2','##CCCCA3');
			    viewer.setParameter('RenderMode','flat');
			    viewer.setParameter('MipMapping','on');
			    viewer.setParameter('Definition','high');
			    viewer.setParameter('Renderer','webgl');
			    viewer.init();
			    viewer.update();

			    canvas3.style.display="block";

			}else
			if(endId=='week8'){
				
				var canvas4 = document.getElementById('cv4');
			    var viewer = new JSC3D.Viewer(canvas4);
			    viewer.setParameter('SceneUrl','drawings/week8/work_table.obj');
			    viewer.setParameter('ModelColor','#FFFFFF');
			    viewer.setParameter('BackgroundColor1','##CCCCA3');
			    viewer.setParameter('BackgroundColor2','##CCCCA3');
			    viewer.setParameter('RenderMode','flat');
			    viewer.setParameter('MipMapping','on');
			    viewer.setParameter('Definition','high');
			    viewer.setParameter('Renderer','webgl');
			    viewer.init();
			    viewer.update();

			    canvas4.style.display="block";

			}else
			if(endId=='week9'){
				
				var canvas4 = document.getElementById('cv5');
			    var viewer = new JSC3D.Viewer(canvas5);
			    viewer.setParameter('SceneUrl','drawings/week9/spirals.stl');
			    viewer.setParameter('ModelColor','#FFFFFF');
			    viewer.setParameter('BackgroundColor1','##CCCCA3');
			    viewer.setParameter('BackgroundColor2','##CCCCA3');
			    viewer.setParameter('RenderMode','flat');
			    viewer.setParameter('MipMapping','on');
			    viewer.setParameter('Definition','high');
			    viewer.setParameter('Renderer','webgl');
			    viewer.init();
			    viewer.update();

			    canvas4.style.display="block";

			}

		}
	</script>




</body>
</html>

