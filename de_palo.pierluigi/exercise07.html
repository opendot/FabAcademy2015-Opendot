<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Pierluigi De Palo">
    <link rel="icon" href="media/favicon.ico">

    <title>Fab Academy 2015 -Pierluigi De Palo</title>

    <!-- Bootstrap core CSS -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">

      <link href="media/Pierluigi.css" rel="stylesheet">
      
    <!-- Custom styles for this template -->
    <link href="media/fabacademy.css" rel="stylesheet">
      <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro:200,300,400,500,600,700,900' rel='stylesheet' type='text/css'>
      <link href="media/Pierluigi.css" rel="stylesheet">
      
    <!-- 3D files viewer -->
    <script type="text/javascript" src="media/jsc3d_ie.min.js"></script>
	<script type="text/javascript" src="media/jsc3d.min.js"></script>
    <script type="text/javascript" src="media/jsc3d.webgl.js"></script>
    <script type="text/javascript" src="media/jsc3d.touch.js"></script>

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="bootstrap/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="bootstrap/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <!-- Load the menu file -->
    <script>
	function menu() {
					  $('#cclicense').load("license.html");
					  }
	</script>

  </head>

  <body onload="menu()">

    <!-- Static navbar -->
    <nav class="navbar navbar-default navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">Home</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="about.html">About</a></li>
            <li class="dropdown">
        <a href="exercises-menu.html">Log Book</a>
              
            </li>
            <li>
        <a href="project-menu.html">Final Project</a>
            </li>
              <li><a href="extra.html">Extra</a></li>
        </ul>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">

	<!-- Insert your content here below! -->

<p>****************************************************************************************************************</p>
          
        <ul class="pager statusINC">
    
        <li class="previous"><a href="exercise06.html">← </a></li> 
    
        <li class="next"><a href="exercise08.html"> →</a></li>
    
        <h2>Week 7 - Embedded Programming -</h2>

        </ul>
        

<br>
        <h4>ASSIGNMENT: READ A MICROCONTROLLER DATA SHEET // PROGRAM YOUR BOARD TO DO SOMETHING, WITH AS MANY DIFFERENT PROGRAMMING LANGUAGES AND PROGRAMMING ENVIRONMENTS AS POSSIBLE</h4>
        <h4>PROJECT: PROGRAM THE HELLO WORLD BOARD AND EMBEDDED PROGRAM WITH FAB ISP
        </h4>
        <br>
        <h4>Soft: Mac Os Terminal</h4>
        <h4>Tutorial: <a href="http://fabacademy.org/archives/2012/students/menichinelli.massimo/index.html#"> Massimo Menichinelli Fab Academy 2012 Exercise: Embedded Erogramming</a> // <a href=" http://computers.tutsplus.com/tutorials/40-terminal-tips-and-tricks-you-never-thought-you-needed--mac-51192"> Terminal </a></h4>
       <h4>Datasheet: <a href="http://www.atmel.com/Images/doc8183.pdf"> Attiny 44</a></h4>
        <h4>DOWNLOAD: <a href="download/w7_steadyled.zip"><button type="button" class="btn btn-primary btn-lg">Steadyled.zip</button></a> 
	</h4>
        
         <p>****************************************************************************************************************</p>
     <br>
 
        <p class="pic">
                <img src="Images/w7_Embedded_logo.jpg">
	
            </p>
        <br>
         
         <h4>-----</h4>
        <br>
        
        <p class="pic">
        <img src="Images/w7_pin_config_attiny44.jpg">
            <legend>Attiny Pin Out</legend>
        </p>
        
        <br>
        
        <p> The Makefile is used to automate the programming</p>
        
        <div class="code">
            PROJECT=steadyled
SOURCES=$(PROJECT).c
MMCU=attiny44
F_CPU = 20000000

CFLAGS=-mmcu=$(MMCU) -Wall -Os -DF_CPU=$(F_CPU)

$(PROJECT).hex: $(PROJECT).out
	avr-objcopy -O ihex $(PROJECT).out $(PROJECT).c.hex;\
	avr-size --mcu=$(MMCU) --format=avr $(PROJECT).out
 
$(PROJECT).out: $(SOURCES)
	avr-gcc $(CFLAGS) -I./ -o $(PROJECT).out $(SOURCES)
 
program-bsd: $(PROJECT).hex
	avrdude -p t44 -c bsd -U flash:w:$(PROJECT).c.hex

program-dasa: $(PROJECT).hex
	avrdude -p t44 -P /dev/ttyUSB0 -c dasa -U flash:w:$(PROJECT).c.hex

program-avrisp2: $(PROJECT).hex
	avrdude -p t44 -P usb -c avrisp2 -U flash:w:$(PROJECT).c.hex

program-avrisp2-fuses: $(PROJECT).hex
	avrdude -p t44 -P usb -c avrisp2 -U lfuse:w:0x5E:m

program-usbtiny: $(PROJECT).hex
	avrdude -p t44 -P usb -c usbtiny -U flash:w:$(PROJECT).c.hex

program-usbtiny-fuses: $(PROJECT).hex
	avrdude -p t44 -P usb -c usbtiny -U lfuse:w:0x5E:m

program-dragon: $(PROJECT).hex
  avrdude -p t44 -P usb -c dragon_isp -U flash:w:$(PROJECT).c.hex
        </div>
        
	<legend>The Makefile Report</legend>
 
        
        
        
<p>The file steadyled.c which is the program</p>

        
          
         <div class="code">
             
#include <avr/io.h>
#include <inttypes.h>
#include <util/delay.h>
                
                
void delay_ms(uint16_t ms);
void init_io();
int button_is_pressed();
void toggle_led();

#define F_CPU 20000000UL         /* 20MHz crystal oscillator */

#define BUTTON_PORT PORTA       /* PORTx - register for button output */
#define BUTTON_PIN PINA         /* PINx - register for button input */
#define BUTTON_BIT PA3          /* bit for button input/output */

#define LED_PORT PORTA          /* PORTx - register for LED output */
#define LED_BIT PA7             /* bit for button input/output */
#define LED_DDR DDRA            /* LED data direction register */

#define DEBOUNCE_TIME 25        /* time to wait while "de-bouncing" button */
#define LOCK_INPUT_TIME 250     /* time to wait after a button press */

int 
main (void)
{
        init_io();

        while (1)                       
        {
                if (button_is_pressed())
                {
                        toggle_led();
                       
                }
        }
}

void delay_ms(uint16_t ms) {
        while ( ms )
        {
                _delay_ms(1);
                ms--;
        }
}

void 
init_io() 
{
        /* set LED pin as digital output */
        LED_DDR = _BV (LED_BIT); 

        /* led is OFF initially (set pin high) */         
        LED_PORT |= _BV(LED_BIT);

        /* turn on internal pull-up resistor for the switch */
        BUTTON_PORT |= _BV(BUTTON_BIT);
}

int 
button_is_pressed()
{
        /* the button is pressed when BUTTON_BIT is clear */
        if (bit_is_clear(BUTTON_PIN, BUTTON_BIT))
        {
                delay_ms(DEBOUNCE_TIME);
                if (bit_is_clear(BUTTON_PIN, BUTTON_BIT)) return 1;
        }

        return 0;
}

void
toggle_led()
{
        LED_PORT ^= _BV(LED_BIT);
                }
        
           </div> 
             
<legend>The file steadyled.c</legend>
        
       <br>
             
        <p>Once downloaded file, I changed the number of pins where are connected the button and the LED (in the file above, pins are already modified) using the button for PA3 and PA7 for Led.

After that, I connected the FabISP and the board to the PC, and connected each other with the rainbow cable.</p>
             
       <br>
         
  <p>After connecting the two boards, open the terminal and enter the directory of the program "steadyled":</p><
             
 
<br>             
             
             
             
        <h4>COMMAND : MAKE </h4>
        <br>
             
        <p>After This modification, i can use "Make command" for compile the code </p>
        
        <br>
             
        <div class="code">
            MacBook-Pro-de-Luigi-3:~ Pierluigi$ cd Downloads/steadyled 
            MacBook-Pro-de-Luigi-3:steadyled Pierluigi$
             </div>
        
             <p>After that, we have to type the command "make" in order to create the excecute the Makefile. The Makefile create by default the hexadecimal file (steadyled.c.hex).</p>
             
         <div class="code">   
            MacBook-Pro-de-Luigi-3:embedding PierluigiS make
avr-objcopy -0 ihex hello_world_blinking_by_massimo.out hello_world_blinking_by_massimo.c.hex:\ 
     avr-size --mcu=attiny44 --format=avr hello_world_blinking_by_massimo.out
AVR Memory Usage

Device: attiny44

Program: 140 bytes (3.4% Full)
(.text + data + .bootloader)

Data:     0 bytes (0.0% Full)
(.data + .bss + .noinit)

             </div> 
             
             <legend>Make Command</legend>
            
      
          
        <br>
        
         <h4>COMMAND : MAKE PROGRAM USBTINY FUSE</h4>
             
        <br> 
             
        <p>Whith "Make program usbtiny command" we reset the microcontroller and prepare it to recive the "Hello Led Board" code</p>
             
        <br>
        
    
        
        <p>Finally we have to do the "make program-usbtiny" to program the board:</p>
             
        <br>
        
        <div class="code">
        MacBook Pro de Luigi 3:embedding PierluigiS make program usbtiny.fuses
avr-objcopy -0 ihex helloworld_bl inking_ by mass Imo .out helloyorldblinking_bymassimo.c.hex:,
         avr size  mcu attiny44 -format avr hello world blinking by mass)mo.out
AVR Memory Usage

Device: attiny44

Program:      140 bytes (3.4% Full)
(.text • data      .bootloaden

Data:           0 bytes (0.0% Full>
.data - .bss • .noinit)


avrdude p t44 P usb -c usbt)ny U lfuse:w:Ox5E:m

avrdude: AVR device initialized and ready to accept instructions

Reading | ################################################## | 100% 0.00s

avrdude: Device signature - 0x1e9207
avrdude: reading input file "OxSE"
avrdude: writing lfuse      bytes):

Writing | ################################################## | 100% 0.00$

avrdude: 1 bytes of lfuse written
avrdude: verifying I fuse memory against OxSE:
avrdude: load data lfuse data from input file OxSE: 
avrdude: input file Ox5E contains 1 bytes
avrdude: reading on chip lfuse data:

Reading | ################################################## | 100% 0.00s

avrdude: verifying ...
avrdude: 1 bytes of lfuse verified

avrdude: safemode: Fuses OK (H:FF. E:DF. L:SE) 

avrdude done. Thank you.

        </div>
        
        
	<legend>Make program usbtiny fuses</legend>
           
        
        <br>
             
         <h4>COMMAND : MAKE PROGRAM USBTINY</h4>
             
        <br>
             
        <p>Whith "Make Program Usbitiny" we upload the code </p>
             
        <br>
        
        <div class="code">
             MacBook-Pro-de-Lutgl-3:embedding PierluigiS make program-usbtfny
avr-objcopy -0 thex helloworld_blinking_by_massimo.out hello_world_blinking_by_massimo.c.hex:\ 
          avr-size --mcu=attiny44 --format=avr hello_world_blinking_by_massimo.out
AYR Memory Usage
----------------
Device: attiny44

Program:       140 bytes (3.4% Full)
(.text + data + .bootloader)

Data:            0 bytes (o.es Full)
(.data + .bss + .noinit)


avrdude -p l44 -P usb -c usbtiny -U flash:whello_world_blinking_by_massimo.c.hex 

avrdude: AYR device initialized and ready to accept instructions

Reading | ################################################## | 166% 0.66s

avrdude: Device signature . 6x1e9207
avrdude: NOTE: "flash" memory has been specified, an erase cycle will be performed 
          To disable this feature. specify the -D option.
avrdude: erasing chip
avrdude: reading input file "helloworldblinking_by_massimo.c.hex"
avrdude: input file hello_world_blinking_by_massimo.c.hex auto detected as Intel Hex 
avrdude: writing flash (140 bytes):

Writing | ################################################## | 100% 0.20s

avrdude:  140 bytes of flash written
avrdude:  verifying flash memory against hello_world_blinking_by_massimo.c.hex:
avrdude:  load data flash data from input file hello_world_blinking_by_massimo.c.hex: 
avrdude:  input file hello_world_blinking_by massimo. c.hex auto detected as Intel flex 
avrdude:  input file hello worldla inking by massimo.c.hex contains 140 bytes
avrdude:  reading on chip Ilash data:

Reading | ################################################## | 0.27s

avrdude: verifying ...
avrdude: 140 bytes of flash verified

avrdude: salemode: Fuses OK (H:FF. E:OF. L:SE) 

avrdude done. Thank you.

             </div>

	<legend>Report of well done process :Make Program Usbitiny </legend>
        
      <br>
         
<h4>TEST: WOW!! IT'S WORK!!!</h4>
        
        
<p class="pic">
<img src="Images/w7_led_board_blink.jpg">
	<legend>EUREKA! The Led Blink</legend>
            </p>
             
        <br>
             
      <div> 
          <br>
        <p class="pic">
                <iframe width="960" height="540" src="https://www.youtube.com/embed/7ToEiiS-JHw?rel=0" frameborder="2" allowfullscreen></iframe>
	</p></div>
          <br> 
        
    <!-- End of your content -->

    </div> <!-- /container -->

	<!-- footer -->
    
    <footer id="footer">
        <p id="cclicense">
                </p>
        <p class="license">
        Theme: <a href="https://github.com/openp2pdesign/FabAcademy_Template">Fab Academy Template</a> by <a href="http://openp2pdesign.org">Massimo Menichinelli</a> <br>
        Based on <a href="http://getbootstrap.com/">Twitter Bootstrap</a>+<a href="http://jquery.com/">JQuery</a>+<a href="https://code.google.com/p/google-code-prettify/">google-code-prettify</a>+<a href="http://jmblog.github.io/color-themes-for-google-code-prettify/github/">GitHub theme for google-code-prettify</a>+<a href="https://code.google.com/p/jsc3d/">JSC3D</a>+<a href="https://github.com/thegrubbsian/jquery.ganttView">jquery.ganttView</a>.
        </p>
    </footer>
    
      
      <div class="container">
      <!-- Static navbar -->
    
      </div>
      
	<!-- Do not touch this! -->
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="media/jquery-1.9.1.min.js"></script>
    
    <!-- Syntax Highlighter -->
    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js">
    </script>
    <!-- From https://github.com/jmblog/color-themes-for-google-code-prettify -->
    <link href="media/github.css" type="text/css" rel="stylesheet">
	<script type="text/javascript">
	  !function ($) {
		$(function(){
		  window.prettyPrint && prettyPrint()   
		})
	  }(window.jQuery)
	</script>
	
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="bootstrap/js/ie10-viewport-bug-workaround.js"></script>

  </body>
</html>
